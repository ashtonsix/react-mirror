{"version":3,"file":"index.js","sources":["src/cursor/cursor_naive.js","src/utils/createCursorAPI.js","src/utils/generateStoreId.js","src/utils/Enum.js","src/utils/streams/combineEnum.js","src/utils/streams/eventSource.js","src/utils/streams/filterUnchanged.js","src/backend/backend.js","src/backend/index.js","src/utils/shallowEqual.js","src/bindings/react.js","src/utils/handleActions.js","src/utils/streams/combine.js","src/utils/streams/combineActionsWith.js","src/utils/streams/combineNested.js","src/utils/streams/combineSimple.js","src/index.js"],"sourcesContent":["const traverse = (tree, onVisit) => {\r\n  const q = [tree]\r\n\r\n  while (q.length) {\r\n    const node = q.shift()\r\n    q.push(...Object.values(node.children))\r\n    onVisit(node)\r\n  }\r\n}\r\n\r\nconst getChildren = node => {\r\n  const children = []\r\n  traverse(node, node => children.push(node))\r\n  return children\r\n}\r\n\r\nconst getParents = node => {\r\n  const parents = []\r\n  while (node.parent) {\r\n    node = node.parent\r\n    parents.push(node)\r\n  }\r\n  return parents\r\n}\r\n\r\nconst testFilter = (node, filter) => {\r\n  if (\r\n    !filter ||\r\n    filter === node.id ||\r\n    filter === node.component ||\r\n    node.identifiers.includes(filter)\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst runQuery = (tree, originIds, query) => {\r\n  if (!query.length) return originIds\r\n\r\n  let operator\r\n  ;[operator, ...query] = query\r\n\r\n  if (operator.op === 'root') return runQuery(tree, [tree.id], query)\r\n\r\n  const originNodes = []\r\n  traverse(tree, node => {\r\n    if (originIds.includes(node.id)) {\r\n      originNodes.push(node)\r\n    }\r\n  })\r\n\r\n  const result = (() => {\r\n    let result = originNodes.map(node => {\r\n      const getMatches = operator.op === 'children' ? getChildren : getParents\r\n      let matches = getMatches(node)\r\n      matches = matches.filter(node => testFilter(node, operator.filter))\r\n      matches = matches.slice(0, operator.maxStores)\r\n      matches = matches.map(node => node.id)\r\n      return matches\r\n    })\r\n    result = [].concat(...result)\r\n    result = Array.from(new Set(result))\r\n    return result\r\n  })()\r\n\r\n  return runQuery(tree, result, query.slice(1))\r\n}\r\n\r\nconst createCursorBackend = () => {\r\n  let prevTree\r\n\r\n  return {\r\n    query(origin, query) {\r\n      return runQuery(prevTree, [origin], query)\r\n    },\r\n    updateNode(tree, op) {\r\n      prevTree = tree\r\n      const results = {}\r\n      traverse(tree, node => {\r\n        results[node.id] = node.queries.map(query => {\r\n          return runQuery(tree, [node.id], query)\r\n        })\r\n      })\r\n      return results\r\n    }\r\n  }\r\n}\r\n\r\nexport default createCursorBackend\r\n","const createCursorAPI = (enhancer, query = []) => {\r\n  const cursorMethods = {\r\n    root() {\r\n      query = [{op: 'root'}]\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    parents(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      query = query.concat({op: 'parents', filter, maxStores})\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    children(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      query = query.concat({op: 'children', filter, maxStores})\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    all(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      query = [{op: 'root'}, {op: 'children', filter, maxStores}]\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    one(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      query = [{op: 'root'}, {op: 'children', filter, maxStores: 1}]\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    parent(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      query = query.concat({op: 'parents', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    child(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      query = query.concat({op: 'children', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, query)\r\n    }\r\n  }\r\n  return enhancer(cursorMethods, query)\r\n}\r\n\r\nexport default createCursorAPI\r\n","/*\r\n  Store ids should:\r\n\r\n    * Be easy to read / recognise\r\n    * Not conflict with filters\r\n    * Communicate how many components have been mounted during session\r\n*/\r\nconst ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\r\n\r\nconst counter = [0, -1]\r\n\r\nconst generateStoreId = () => {\r\n  for (let i = counter.length - 1; i >= 0; i--) {\r\n    if (counter[i] === 25) {\r\n      counter[i] = 0\r\n      if (!i) counter.unshift(0)\r\n    } else {\r\n      counter[i] += 1\r\n      break\r\n    }\r\n  }\r\n  return counter.map(char => ALPHABET[char]).join('')\r\n}\r\n\r\nexport const couldBeStoreId = RegExp.prototype.test.bind(/^[A-Z]{2,12}$/)\r\n\r\nexport default generateStoreId\r\n","class Enum extends Array {\r\n  constructor(obj = {}) {\r\n    const keys = Object.keys(obj)\r\n    const values = keys.map(key => obj[key])\r\n    super(...values)\r\n    Object.defineProperty(this, 'keys', {value: keys})\r\n    keys.forEach(key => Object.defineProperty(this, key, {value: obj[key]}))\r\n  }\r\n  map(f) {\r\n    const obj = {}\r\n    this.forEach(function map(value, index, key, arr) {\r\n      obj[key] = f(value, index, key, arr)\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  filter(f) {\r\n    const obj = {}\r\n    this.forEach(function filter(value, index, key, arr) {\r\n      if (f(value, index, key, arr)) {\r\n        obj[key] = value\r\n      }\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  forEach(f) {\r\n    return super.forEach(function forEach(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  every(f) {\r\n    return super.every(function every(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  find(f) {\r\n    return super.find(function find(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  findIndex(f) {\r\n    return super.findIndex(function findIndex(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  some(f) {\r\n    return super.some(function some(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduce(f) {\r\n    return super.reduce(function reduce(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduceRight(f) {\r\n    return super.reduceRight(function reduceRight(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n}\r\n\r\nexport default Enum\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\n/*\r\n  Combines streams of normal values into a stream of Enums\r\n*/\r\nconst combineEnum = (streams, ids) => {\r\n  if (!streams.length) return most.of(new Enum())\r\n  return most.combineArray(\r\n    (...values) => {\r\n      const result = {}\r\n      values.forEach((value, i) => {\r\n        if (value !== SKIP_TOKEN) result[ids[i]] = value\r\n      })\r\n      return new Enum(result)\r\n    },\r\n    streams.map($stream => {\r\n      const $start = most.of([SKIP_TOKEN]).until($stream)\r\n      return $start.concat($stream)\r\n    })\r\n  )\r\n}\r\n\r\nexport default combineEnum\r\n","import * as most from 'most'\r\n\r\nconst eventSource = () => {\r\n  let syncBuffer = []\r\n  let push = event => syncBuffer.push(event)\r\n  function* eventGenerator() {\r\n    while (syncBuffer.length) {\r\n      yield Promise.resolve(syncBuffer.shift())\r\n    }\r\n    const setPush = resolve => (push = resolve)\r\n    while (true) {\r\n      yield new Promise(setPush)\r\n    }\r\n  }\r\n  return {\r\n    push: event => push(event),\r\n    end: () => eventGenerator.return(),\r\n    $stream: most.generate(eventGenerator)\r\n  }\r\n}\r\n\r\nexport default eventSource\r\n","const SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst filterUnchanged = (equalityCheck, $stream) => {\r\n  return $stream\r\n    .loop((prevValue, value) => {\r\n      const isEqual = equalityCheck(prevValue, value)\r\n      if (isEqual) return {seed: value, value: SKIP_TOKEN}\r\n      return {seed: value, value}\r\n    }, undefined)\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nconst keyArrayEqual = ({oldKeyArray, oldKeySet}, keyArray) => {\r\n  if (oldKeyArray === keyArray) return true\r\n  if (oldKeyArray === undefined) return false\r\n\r\n  for (let i in keyArray) {\r\n    if (!oldKeySet.has(keyArray[i])) return false\r\n  }\r\n\r\n  return keyArray.length === oldKeyArray.length\r\n}\r\n\r\nexport const filterUnchangedKeyArrays = $stream => {\r\n  return $stream\r\n    .loop((seed, keyArray) => {\r\n      let isEqual = keyArrayEqual(seed, keyArray)\r\n      if (isEqual) return {seed, value: SKIP_TOKEN}\r\n      return {\r\n        seed: {oldKeyArray: keyArray, oldKeySet: new Set(keyArray)},\r\n        value: keyArray\r\n      }\r\n    }, {})\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nexport default filterUnchanged\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport warning from 'warning'\r\nimport createCursorBackend from '../cursor'\r\nimport createCursorAPI from '../utils/createCursorAPI'\r\nimport generateStoreId, {couldBeStoreId} from '../utils/generateStoreId'\r\nimport combineEnum from '../utils/streams/combineEnum'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport {filterUnchangedKeyArrays} from '../utils/streams/filterUnchanged'\r\n\r\nconst createMirrorBackend = () => {\r\n  let root\r\n  const storeMap = {}\r\n  const cursorBackend = createCursorBackend()\r\n\r\n  const {push: onStoreUpdated, $stream: $storeUpdated} = createEventSource()\r\n\r\n  const $queryResults = $storeUpdated.map(({store, op}) => {\r\n    return cursorBackend.updateNode(root, {path: store.path, op})\r\n  })\r\n\r\n  const updateStore = (\r\n    store,\r\n    {requesting = [], streams, identifiers = [], metadata = {}}\r\n  ) => {\r\n    Object.assign(store, {identifiers, metadata})\r\n\r\n    invariant(\r\n      !identifiers.some(couldBeStoreId),\r\n      'Cannot use all-uppercase identifiers (\"%s\") because they could conflict with internally-used IDs',\r\n      identifiers.find(couldBeStoreId)\r\n    )\r\n\r\n    const $storeDeleted = $queryResults.filter(() => !storeMap[store.id])\r\n\r\n    let ADD_STREAMS_ASYNC\r\n\r\n    store.mirror = createCursorAPI((cursorMethods, query) => {\r\n      const cursor = {}\r\n      requesting.concat('$actions').forEach(streamName => {\r\n        Object.defineProperty(cursor, streamName, {\r\n          get() {\r\n            const queryIndex = store.queries.length\r\n            store.queries.push(query)\r\n            store.queryTypes.push(streamName)\r\n            store.queryResults.push([])\r\n            if (ADD_STREAMS_ASYNC) {\r\n              warning(\r\n                false,\r\n                'Accessing \"mirror.%s\" after a store has been added is ineffcient, you can batch queries with `updateStore` to improve performance'\r\n              )\r\n              onStoreUpdated({store, op: 'update'})\r\n            }\r\n\r\n            return $queryResults\r\n              .map(queryResults => {\r\n                return queryResults[store.id] ? queryResults[store.id][queryIndex] : []\r\n              })\r\n              .thru(filterUnchangedKeyArrays)\r\n              .map(stores => {\r\n                store.queryResults[queryIndex] = stores\r\n                return (streamName === '$actions' ? most.mergeArray : combineEnum)(\r\n                  stores\r\n                    .map(id => {\r\n                      if (id === store.id && query.length && streamName === '$state') {\r\n                        return undefined\r\n                      }\r\n                      let $stream = storeMap[id] && storeMap[id].streams[streamName]\r\n                      if ($stream && storeMap[id] && storeMap[id].tails[streamName]) {\r\n                        $stream = $stream.startWith(storeMap[id].tails[streamName])\r\n                      }\r\n                      return $stream\r\n                    })\r\n                    .filter(s => s),\r\n                  stores\r\n                )\r\n              })\r\n              .switchLatest()\r\n          }\r\n        })\r\n      })\r\n      Object.defineProperty(cursor, '$stores', {\r\n        get() {\r\n          return $queryResults\r\n            .map(() => ({\r\n              cursor: cursorBackend.query(store.id, query),\r\n              store\r\n            }))\r\n            .until($storeDeleted)\r\n        }\r\n      })\r\n      Object.assign(cursor, cursorMethods)\r\n      return cursor\r\n    })\r\n\r\n    store.dispatch = createCursorAPI((cursorMethods, query) => {\r\n      const dispatch = (type, payload, retryIfSelectionEmpty = true) => {\r\n        invariant(\r\n          storeMap[store.id],\r\n          'Cannot dispatch actions (\"%s\") from a store (\"%s\") that does not exist',\r\n          type,\r\n          store.id\r\n        )\r\n        const stores = cursorBackend.query(store.id, query)\r\n        if (stores.length || !retryIfSelectionEmpty) {\r\n          stores.forEach(id => {\r\n            storeMap[id] && storeMap[id].streams.$actions.push({type, payload, store: id})\r\n          })\r\n          return\r\n        }\r\n\r\n        $queryResults\r\n          .until(\r\n            $storeDeleted.tap(() => {\r\n              warning(\r\n                false,\r\n                'No store matched an action (\"%s\"), & the dispatcher (\"%s\") was removed. We\\'ve discarded the action. You could try dispatching the action via a proxy.',\r\n                type,\r\n                store.id\r\n              )\r\n            })\r\n          )\r\n          .map(() => cursorBackend.query(store.id, query))\r\n          .filter(stores => stores.length)\r\n          .take(1)\r\n          .observe(stores => {\r\n            stores.forEach(id => {\r\n              if (storeMap[id]) {\r\n                storeMap[id].streams.$actions.push({type, payload, store: id})\r\n              }\r\n            })\r\n          })\r\n      }\r\n      Object.assign(dispatch, cursorMethods)\r\n      return dispatch\r\n    })\r\n\r\n    if (!store.streams.$actions) {\r\n      const {push: dispatch, $stream: $actions} = createEventSource()\r\n      store.streams.$actions = $actions.until($storeDeleted).multicast()\r\n      store.streams.$actions.push = dispatch\r\n    }\r\n\r\n    if (streams) {\r\n      const _streams = streams(store.mirror, store.dispatch)\r\n      Object.keys(_streams).forEach(streamName => {\r\n        _streams[streamName] = _streams[streamName]\r\n          .tap(evt => (store.tails[streamName] = evt))\r\n          .multicast()\r\n      })\r\n      store.streams = Object.assign(_streams, {\r\n        $actions: store.streams.$actions\r\n      })\r\n    }\r\n\r\n    ADD_STREAMS_ASYNC = true\r\n  }\r\n\r\n  const backend = {\r\n    addStore(parentId, {requesting, streams, identifiers, metadata}) {\r\n      if (!parentId) parentId = root && root.id\r\n      const parent = storeMap[parentId]\r\n      invariant(\r\n        parent || !root,\r\n        'Cannot add store as a child of \"%s\", because \"%s\" does not exist',\r\n        parentId,\r\n        parentId\r\n      )\r\n\r\n      const store = {\r\n        id: generateStoreId(),\r\n        path: root ? parent.path.concat(parentId) : [],\r\n        streams: {},\r\n        tails: {},\r\n        queries: [],\r\n        queryTypes: [],\r\n        queryResults: [],\r\n        children: {},\r\n        parent\r\n      }\r\n\r\n      if (store.parent) store.parent.children[store.id] = store\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      storeMap[store.id] = store\r\n      onStoreUpdated({store, op: 'add'})\r\n      store.dispatch('INITIALIZE')\r\n\r\n      return store\r\n    },\r\n    removeStore(storeId) {\r\n      const store = storeMap[storeId]\r\n      invariant(store, 'Cannot remove a store (\"%s\") that does not exist', storeId)\r\n      invariant(store !== root, 'Cannot remove root store')\r\n\r\n      const traverse = store => {\r\n        store.children.forEach(traverse)\r\n        // TODO: test dispatch in response to TEARDOWN\r\n        store.dispatch('TEARDOWN')\r\n        delete storeMap[store.id]\r\n        onStoreUpdated({store, op: 'remove'})\r\n      }\r\n      traverse(store)\r\n\r\n      if (store && store.parent) {\r\n        delete store.parent.children[storeId]\r\n      }\r\n    },\r\n    updateStore(storeId, {requesting, streams, identifiers, metadata}) {\r\n      const store = storeMap[storeId]\r\n      invariant(store, 'Cannot update a store (\"%s\") that does not exist', storeId)\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      onStoreUpdated({store, op: 'update'})\r\n\r\n      return store\r\n    },\r\n    query: createCursorAPI((cursorMethods, query) => {\r\n      const runQuery = () => cursorBackend.query(root.id, query)\r\n      Object.assign(runQuery, cursorMethods)\r\n      return runQuery\r\n    }),\r\n    stores: storeMap\r\n  }\r\n\r\n  backend.root = root = backend.addStore(null, {\r\n    identifiers: ['MIRROR/root'],\r\n    metadata: {root: true}\r\n  })\r\n\r\n  return backend\r\n}\r\n\r\nexport default createMirrorBackend\r\n","import createMirrorBackend from './backend'\r\n\r\nconst MirrorBackend = createMirrorBackend()\r\n\r\nexport default MirrorBackend\r\n","const hasOwn = Object.prototype.hasOwnProperty\r\n\r\nconst shallowEqual = (a, b) => {\r\n  if (a === b) return true\r\n\r\n  let countA = 0\r\n  let countB = 0\r\n\r\n  for (let key in a) {\r\n    if (hasOwn.call(a, key) && a[key] !== b[key]) return false\r\n    countA++\r\n  }\r\n\r\n  for (let key in b) {\r\n    if (hasOwn.call(b, key)) countB++\r\n  }\r\n\r\n  return countA === countB\r\n}\r\n\r\nexport default shallowEqual\r\n","import * as most from 'most'\r\nimport React from 'react'\r\nimport warning from 'warning'\r\nimport invariant from 'invariant'\r\nimport MirrorBackend from '../backend'\r\nimport shallowEqual from '../utils/shallowEqual'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport filterUnchanged from '../utils/streams/filterUnchanged'\r\n\r\nconst instantiseMapToProps = mapToProps => {\r\n  let CALLED_ONCE\r\n  const instantisedMapToProps = (state, props) => {\r\n    let result = mapToProps(state, props)\r\n    if (!CALLED_ONCE && typeof result === 'function') {\r\n      mapToProps = result\r\n      result = mapToProps(state, props)\r\n    }\r\n    CALLED_ONCE = true\r\n    return result\r\n  }\r\n  return instantisedMapToProps\r\n}\r\n\r\nfunction createMirrorDecorator(config = {}) {\r\n  return function decorateWithMirror(WrappedComponent) {\r\n    let {name = [], state, mapToProps, pure} = config\r\n    if (!(name instanceof Array)) name = [name]\r\n    if (typeof mapToProps !== 'function') {\r\n      mapToProps = (state, props) => ({...props, ...state})\r\n    }\r\n    if (!pure) pure = {propsEqual() {}, stateEqual() {}, propsStateEqual() {}}\r\n    if (pure === true) pure = {}\r\n    Object.assign(\r\n      {\r\n        propsEqual: shallowEqual,\r\n        shallowEqual: shallowEqual,\r\n        propsStateEqual: shallowEqual\r\n      },\r\n      pure\r\n    )\r\n\r\n    if (!WrappedComponent) {\r\n      WrappedComponent = function Noop() {\r\n        return null\r\n      }\r\n    }\r\n    const _name = WrappedComponent.displayName || WrappedComponent.name || 'Component'\r\n\r\n    class Mirror extends React.Component {\r\n      constructor(props, context) {\r\n        super()\r\n        this.state = {updateCount: 0, props: undefined}\r\n\r\n        let {\r\n          push: onReceivedProps,\r\n          end: endReceivedPropsEventSource,\r\n          $stream: $props\r\n        } = createEventSource()\r\n        Object.assign(this, {onReceivedProps, endReceivedPropsEventSource})\r\n        const $stateEnd = most.fromPromise(\r\n          new Promise(resolve => (this.onStateEnd = resolve))\r\n        )\r\n\r\n        const {id, mirror, dispatch, streams} = MirrorBackend.addStore(context.id, {\r\n          requesting: ['$state', '$props'],\r\n          identifiers: [...name, Mirror.__COMPONENT_IDENTIFIER__],\r\n          streams: (mirror, dispatch) => {\r\n            $props = filterUnchanged(pure.propsEqual.bind(this), $props.startWith(props))\r\n            let $state = state && state.call(this, mirror, dispatch)\r\n            warning(\r\n              !state || ($state && $state.subscribe),\r\n              '`state` should return a stream, did you forget a \"return\" statement? (at \"%s\")',\r\n              [_name].concat(name.filter(name => typeof name === 'string').join(', '))\r\n            )\r\n            if (!state || !$state) return {$props}\r\n            $state = filterUnchanged(pure.stateEqual.bind(this), $state)\r\n              .filter(state => state !== undefined)\r\n              .until($stateEnd)\r\n            return {$state, $props}\r\n          },\r\n          metadata: {\r\n            instance: this\r\n          }\r\n        })\r\n        Object.assign(this, {id, mirror, dispatch})\r\n\r\n        filterUnchanged(\r\n          pure.propsStateEqual.bind(this),\r\n          most.combine(\r\n            instantiseMapToProps(mapToProps).bind(this),\r\n            streams.$state,\r\n            streams.$props\r\n          )\r\n        ).observe(propsState => {\r\n          this.setState(({updateCount}) => ({updateCount: updateCount + 1, propsState}))\r\n        })\r\n      }\r\n      getWrappedInstance() {\r\n        return this.wrappedInstance\r\n      }\r\n      getChildContext() {\r\n        return {id: this.id}\r\n      }\r\n      componentWillReceiveProps(nextProps) {\r\n        this.onReceivedProps(nextProps)\r\n      }\r\n      shouldComponentUpdate(nextProps, nextState) {\r\n        return nextState.updateCount > this.state.updateCount\r\n      }\r\n      componentWillUnmount() {\r\n        this.endReceivedPropsEventSource()\r\n        this.onStateEnd()\r\n        MirrorBackend.removeStore(this.id)\r\n      }\r\n      render() {\r\n        if (this.state.updateCount === 0 && state) {\r\n          return null\r\n        }\r\n\r\n        return React.createElement(WrappedComponent, {\r\n          ...this.state.propsState,\r\n          ref: ref => (this.wrappedInstance = ref),\r\n          dispatch: this.dispatch\r\n        })\r\n      }\r\n    }\r\n\r\n    Mirror.displayName = `Mirror(${_name})`\r\n    Mirror.contextTypes = {id() {}}\r\n    Mirror.childContextTypes = {id() {}}\r\n    Mirror.__COMPONENT_IDENTIFIER__ = Mirror\r\n\r\n    const createStaticCursors = () => {\r\n      delete Mirror.mirror\r\n      delete Mirror.dispatch\r\n      if (Mirror !== Mirror.__COMPONENT_IDENTIFIER__) {\r\n        Mirror.mirror = Mirror.__COMPONENT_IDENTIFIER__.mirror\r\n        Mirror.dispatch = Mirror.__COMPONENT_IDENTIFIER__.dispatch\r\n        return\r\n      }\r\n\r\n      const {mirror, dispatch} = MirrorBackend.addStore(null, {\r\n        identifiers: ['MIRROR/static', `MIRROR/static/${_name}`],\r\n        metadata: {\r\n          static: Mirror\r\n        }\r\n      })\r\n\r\n      Object.assign(Mirror, {\r\n        mirror: mirror.all(Mirror),\r\n        dispatch: dispatch.all(Mirror)\r\n      })\r\n    }\r\n\r\n    Object.defineProperties(Mirror, {\r\n      mirror: {get: () => (createStaticCursors(), Mirror.mirror)},\r\n      dispatch: {get: () => (createStaticCursors(), Mirror.dispatch)}\r\n    })\r\n\r\n    if (Mirror === Mirror.__COMPONENT_IDENTIFIER__) {\r\n      Mirror.__WITH_NAME_CACHE__ = {\r\n        root: new Map(),\r\n        get(key, node = this.root) {\r\n          if (!key.length || !node) return node && node.get('__WITH_NAME_CACHE_LEAF__')\r\n          return this.get(key.slice(1), node.get(key[0]))\r\n        },\r\n        set(key, value, node = this.root) {\r\n          if (!key.length) return node.set('__WITH_NAME_CACHE_LEAF__', value)\r\n          if (!node[key[0]]) node.set(key[0], new Map())\r\n          return this.set(key.slice(1), value, node.get(key[0]))\r\n        }\r\n      }\r\n    }\r\n\r\n    const withNameCache = Mirror.__COMPONENT_IDENTIFIER__.__WITH_NAME_CACHE__\r\n    Mirror.withName = function withName(...withName) {\r\n      withName = name.concat(...withName)\r\n      const cachedComponent = withNameCache.get(withName)\r\n      if (cachedComponent) return cachedComponent\r\n\r\n      const renamedComponent = createMirrorDecorator({...config, name})(WrappedComponent)\r\n      renamedComponent.__COMPONENT_IDENTIFIER__ = Mirror.__COMPONENT_IDENTIFIER__\r\n      if (withName.length) withNameCache.set(withName, renamedComponent)\r\n      return renamedComponent\r\n    }\r\n\r\n    return Mirror\r\n  }\r\n}\r\n\r\nexport default createMirrorDecorator\r\n","const isAction = action => {\r\n  if (\r\n    action &&\r\n    typeof action.type === 'string' &&\r\n    action.hasOwnProperty('payload') &&\r\n    typeof action.store === 'string'\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst findAction = args => {\r\n  let i = args.length\r\n  while (i--) {\r\n    if (isAction(args[i])) return args[i]\r\n    if (args[i] && isAction(args[i].action)) return args[i].action\r\n  }\r\n  return null\r\n}\r\n\r\nconst handleActions = (handlers, initialState) => (...args) => {\r\n  let action = findAction(args)\r\n  const state = args[0] === undefined ? initialState : args[0]\r\n\r\n  if (!action || !handlers[action.type]) return state\r\n  if (initialState) return handlers[action.type](state, action)\r\n  return handlers[action.type](action)\r\n}\r\n\r\nexport default handleActions\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst combine = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        result[key] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combine\r\n","import * as most from 'most'\r\n\r\nconst SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst combineActionsWithDefault = (actionStream, otherStream) => {\r\n  return most\r\n    .combine((action, other) => ({action, other}))\r\n    .loop(\r\n      ({prevAction, before}, {action, other: after}) => ({\r\n        seed: {\r\n          prevAction: action,\r\n          before: prevAction === action ? SKIP_TOKEN : after\r\n        },\r\n        value: before === SKIP_TOKEN ? {before, action, after} : SKIP_TOKEN\r\n      }),\r\n      {}\r\n    )\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nconst combineActionsWithBefore = (actionStream, otherStream) => {\r\n  return actionStream.sample((action, other) => ({before: other, action}), otherStream)\r\n}\r\n\r\nconst combineActionsWithAfter = (actionStream, otherStream) => {\r\n  return combineActionsWithDefault(actionStream, otherStream).map(value => {\r\n    delete value.before\r\n    return value\r\n  })\r\n}\r\n\r\nconst combineActionsWithNothing = actionStream => {\r\n  return actionStream.map(action => ({action}))\r\n}\r\n\r\nconst combineActionsWith = (\r\n  actionStream,\r\n  otherStream,\r\n  options = {before: true, after: true}\r\n) => {\r\n  if (options.before && options.after) {\r\n    return combineActionsWithDefault(actionStream, otherStream)\r\n  } else if (options.before) {\r\n    return combineActionsWithBefore(actionStream, otherStream)\r\n  } else if (options.after) {\r\n    return combineActionsWithAfter(actionStream, otherStream)\r\n  }\r\n\r\n  return combineActionsWithNothing(actionStream)\r\n}\r\n\r\nexport default combineActionsWith\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst combineNested = streamMap => {\r\n  const keys = Object.keys(streamMap)\r\n  const streams = keys.map(key => streamMap[key])\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        if (!result[key]) result[key] = result[key]\r\n        result[key][keys[i]] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combineNested\r\n","import * as most from 'most'\r\n\r\nconst combineSimple = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  return most.combineArray((...values) => [...values], streams)\r\n}\r\n\r\nexport default combineSimple\r\n","import 'regenerator-runtime/runtime'\r\nimport MirrorBackend from './backend'\r\nimport Mirror from './bindings'\r\nimport Enum from './utils/Enum'\r\nimport handleActions from './utils/handleActions'\r\nimport shallowEqual from './utils/shallowEqual'\r\nimport combine from './utils/streams/combine'\r\nimport combineActionsWith from './utils/streams/combineActionsWith'\r\nimport combineNested from './utils/streams/combineNested'\r\nimport combineSimple from './utils/streams/combineSimple'\r\nimport filterUnchanged from './utils/streams/filterUnchanged'\r\n\r\nconst {addStore, removeStore, updateStore, query, root, stores} = MirrorBackend\r\n\r\nexport {addStore, removeStore, updateStore, query, root, stores}\r\nexport {handleActions, Enum, shallowEqual}\r\nexport {combine, combineActionsWith, combineNested, combineSimple, filterUnchanged}\r\nexport default Mirror\r\n"],"names":["traverse","tree","onVisit","q","length","node","shift","push","Object","values","children","getChildren","getParents","parents","parent","testFilter","filter","id","component","identifiers","includes","runQuery","originIds","query","operator","op","originNodes","result","map","getMatches","matches","slice","maxStores","concat","Array","from","Set","createCursorBackend","prevTree","origin","results","queries","createCursorAPI","enhancer","cursorMethods","Infinity","__COMPONENT_IDENTIFIER__","ALPHABET","counter","generateStoreId","i","unshift","char","join","couldBeStoreId","RegExp","prototype","test","bind","Enum","obj","keys","key","defineProperty","value","forEach","f","index","arr","every","find","findIndex","some","reduce","prev","reduceRight","SKIP_TOKEN","combineEnum","streams","ids","most","$start","until","$stream","eventSource","eventGenerator","syncBuffer","event","Promise","resolve","setPush","return","filterUnchanged","equalityCheck","loop","prevValue","isEqual","seed","undefined","keyArrayEqual","keyArray","oldKeyArray","oldKeySet","has","filterUnchangedKeyArrays","createMirrorBackend","root","storeMap","cursorBackend","createEventSource","onStoreUpdated","$storeUpdated","$queryResults","store","updateNode","path","updateStore","requesting","metadata","assign","$storeDeleted","ADD_STREAMS_ASYNC","mirror","cursor","streamName","queryIndex","queryTypes","queryResults","thru","stores","tails","startWith","s","switchLatest","dispatch","type","payload","retryIfSelectionEmpty","$actions","tap","take","observe","multicast","_streams","evt","backend","parentId","storeId","addStore","MirrorBackend","hasOwn","hasOwnProperty","shallowEqual","a","b","countA","countB","call","instantiseMapToProps","CALLED_ONCE","instantisedMapToProps","state","props","mapToProps","createMirrorDecorator","config","decorateWithMirror","WrappedComponent","name","pure","Noop","_name","displayName","Mirror","context","updateCount","onReceivedProps","endReceivedPropsEventSource","end","$props","$stateEnd","onStateEnd","propsEqual","$state","subscribe","stateEqual","propsStateEqual","setState","propsState","wrappedInstance","nextProps","nextState","removeStore","React","createElement","ref","Component","contextTypes","childContextTypes","createStaticCursors","all","defineProperties","get","__WITH_NAME_CACHE__","Map","set","withNameCache","withName","cachedComponent","renamedComponent","isAction","action","findAction","args","handleActions","handlers","initialState","combine","enumCollection","combineActionsWithDefault","actionStream","otherStream","other","prevAction","before","after","combineActionsWithBefore","sample","combineActionsWithAfter","combineActionsWithNothing","combineActionsWith","options","combineNested","streamMap","combineSimple"],"mappings":"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"}