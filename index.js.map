{"version":3,"file":"index.js","sources":["src/cursor/cursor_naive.js","src/utils/createCursorAPI.js","src/utils/generateStoreId.js","src/utils/Enum.js","src/utils/streams/combineEnum.js","src/utils/streams/eventSource.js","src/utils/streams/filterWithPrevious.js","src/backend/backend.js","src/backend/index.js","src/utils/shallowEqual.js","src/bindings/react.js","src/utils/handleActions.js","src/utils/streams/combine.js","src/utils/streams/combineEventsWith.js","src/utils/streams/combineNested.js","src/utils/streams/combineSimple.js","src/index.js"],"sourcesContent":["const traverse = (tree, onVisit) => {\r\n  const q = [tree]\r\n\r\n  while (q.length) {\r\n    const node = q.shift()\r\n    q.push(...Object.values(node.children))\r\n    onVisit(node)\r\n  }\r\n}\r\n\r\nconst getChildren = node => {\r\n  const children = []\r\n  traverse(node, node => children.push(node))\r\n  return children\r\n}\r\n\r\nconst getParents = node => {\r\n  const parents = []\r\n  while (node.parent) {\r\n    node = node.parent\r\n    parents.push(node)\r\n  }\r\n  return parents\r\n}\r\n\r\nconst testFilter = (node, filter) => {\r\n  if (\r\n    !filter ||\r\n    filter === node.id ||\r\n    filter === node.component ||\r\n    node.identifiers.includes(filter)\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst runQuery = (tree, originIds, query) => {\r\n  if (!query.length) return originIds\r\n\r\n  let operator\r\n  ;[operator, ...query] = query\r\n\r\n  if (operator.op === 'root') return runQuery(tree, [tree.id], query)\r\n\r\n  const originNodes = []\r\n  traverse(tree, node => {\r\n    if (originIds.includes(node.id)) {\r\n      originNodes.push(node)\r\n    }\r\n  })\r\n\r\n  const result = (() => {\r\n    let result = originNodes.map(node => {\r\n      const getMatches = operator.op === 'children' ? getChildren : getParents\r\n      let matches = getMatches(node)\r\n      matches = matches.filter(node => testFilter(node, operator.filter))\r\n      matches = matches.slice(0, operator.maxStores)\r\n      matches = matches.map(node => node.id)\r\n      return matches\r\n    })\r\n    result = [].concat(...result)\r\n    result = Array.from(new Set(result))\r\n    return result\r\n  })()\r\n\r\n  return runQuery(tree, result, query)\r\n}\r\n\r\nconst createCursorBackend = () => {\r\n  let prevTree\r\n\r\n  return {\r\n    query(origin, query) {\r\n      return runQuery(prevTree, [origin], query)\r\n    },\r\n    updateNode(tree, op) {\r\n      prevTree = tree\r\n      const results = {}\r\n      traverse(tree, node => {\r\n        results[node.id] = node.queries.map(query => {\r\n          return runQuery(tree, [node.id], query)\r\n        })\r\n      })\r\n      return results\r\n    }\r\n  }\r\n}\r\n\r\nexport default createCursorBackend\r\n","const createCursorAPI = (enhancer, query = []) => {\r\n  const cursorMethods = {\r\n    root() {\r\n      const newQuery = [{op: 'root'}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    parents(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'parents', filter, maxStores})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    children(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'children', filter, maxStores})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    all(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = [{op: 'root'}, {op: 'children', filter, maxStores}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    one(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = [{op: 'root'}, {op: 'children', filter, maxStores: 1}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    parent(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'parents', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    child(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'children', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    }\r\n  }\r\n  return enhancer(cursorMethods, query)\r\n}\r\n\r\nexport default createCursorAPI\r\n","/*\r\n  Store ids should:\r\n\r\n    * Be easy to read / recognise\r\n    * Not conflict with filters\r\n    * Communicate how many components have been mounted during session\r\n*/\r\nconst ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\r\n\r\nconst counter = [0, -1]\r\n\r\nconst generateStoreId = () => {\r\n  for (let i = counter.length - 1; i >= 0; i--) {\r\n    if (counter[i] === 25) {\r\n      counter[i] = 0\r\n      if (!i) counter.unshift(0)\r\n    } else {\r\n      counter[i] += 1\r\n      break\r\n    }\r\n  }\r\n  return '_' + counter.map(char => ALPHABET[char]).join('')\r\n}\r\n\r\nexport const couldBeStoreId = RegExp.prototype.test.bind(/^_[A-Z]{2,12}$/)\r\n\r\nexport default generateStoreId\r\n","class Enum extends Array {\r\n  constructor(obj = {}) {\r\n    const keys = Object.keys(obj)\r\n    const values = keys.map(key => obj[key])\r\n    super()\r\n    super.push(...values)\r\n    Object.defineProperty(this, 'keys', {value: keys})\r\n    Object.defineProperty(this, 'indexes', {\r\n      value: new Array(values.length).fill().map((v, i) => i)\r\n    })\r\n    keys.forEach(key => Object.defineProperty(this, key, {value: obj[key]}))\r\n  }\r\n  map(f) {\r\n    const obj = {}\r\n    this.forEach(function map(value, index, key, arr) {\r\n      obj[key] = f(value, index, key, arr)\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  filter(f) {\r\n    const obj = {}\r\n    this.forEach(function filter(value, index, key, arr) {\r\n      if (f(value, index, key, arr)) {\r\n        obj[key] = value\r\n      }\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  forEach(f) {\r\n    return super.forEach(function forEach(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  every(f) {\r\n    return super.every(function every(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  find(f) {\r\n    return super.find(function find(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  findIndex(f) {\r\n    return super.findIndex(function findIndex(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  some(f) {\r\n    return super.some(function some(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduce(f) {\r\n    return super.reduce(function reduce(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduceRight(f) {\r\n    return super.reduceRight(function reduceRight(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n}\r\n\r\nexport default Enum\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\n/*\r\n  Combines streams of normal values into a stream of Enums\r\n\r\n  Emits values immediately, w/o waiting for input streams to emit their first value\r\n*/\r\nconst combineEnum = (streams, ids) => {\r\n  if (!streams.length) return most.of(new Enum())\r\n  return most.combineArray(\r\n    (...values) => {\r\n      const result = {}\r\n      values.forEach((value, i) => {\r\n        if (value !== SKIP_TOKEN) result[ids[i]] = value\r\n      })\r\n      return new Enum(result)\r\n    },\r\n    streams.map($stream => {\r\n      const $start = most.of(SKIP_TOKEN).until($stream)\r\n      return $start.concat($stream)\r\n    })\r\n  )\r\n}\r\n\r\nexport default combineEnum\r\n","import * as most from 'most'\r\n\r\nconst eventSource = () => {\r\n  let buffer = []\r\n  let next\r\n  let push = event => {\r\n    if (next) {\r\n      next(event)\r\n      next = null\r\n    } else {\r\n      buffer.push(event)\r\n    }\r\n  }\r\n  const setResolve = (resolve, reject) => (next = resolve)\r\n  function* eventGenerator() {\r\n    while (true) {\r\n      if (buffer.length) yield Promise.resolve(buffer.shift())\r\n      else yield new Promise(setResolve)\r\n    }\r\n  }\r\n  return {\r\n    push,\r\n    $stream: most.generate(eventGenerator)\r\n  }\r\n}\r\n\r\nexport default eventSource\r\n","const SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst filterWithPreviousBase = (reverse, f, $stream) => {\r\n  return $stream\r\n    .loop((prevValue, value) => {\r\n      let include = f(prevValue, value)\r\n      if (reverse) include = !include\r\n      if (include) return {seed: value, value}\r\n      return {seed: value, value: SKIP_TOKEN}\r\n    }, undefined)\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nconst filterUnchanged = filterWithPreviousBase.bind(null, true)\r\nconst filterWithPrevious = filterWithPreviousBase.bind(null, false)\r\n\r\nconst keyArrayEqual = ({oldKeyArray, oldKeySet}, keyArray) => {\r\n  if (oldKeyArray === keyArray) return true\r\n  if (oldKeyArray === undefined) return false\r\n\r\n  for (let i in keyArray) {\r\n    if (!oldKeySet.has(keyArray[i])) return false\r\n  }\r\n\r\n  return keyArray.length === oldKeyArray.length\r\n}\r\n\r\nconst filterUnchangedKeyArrays = $stream => {\r\n  return $stream\r\n    .loop((seed, keyArray) => {\r\n      let isEqual = keyArrayEqual(seed, keyArray)\r\n      if (isEqual) return {seed, value: SKIP_TOKEN}\r\n      return {\r\n        seed: {oldKeyArray: keyArray, oldKeySet: new Set(keyArray)},\r\n        value: keyArray\r\n      }\r\n    }, {})\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nexport {filterUnchanged, filterUnchangedKeyArrays}\r\nexport default filterWithPrevious\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport warning from 'warning'\r\nimport createCursorBackend from '../cursor'\r\nimport createCursorAPI from '../utils/createCursorAPI'\r\nimport generateStoreId, {couldBeStoreId} from '../utils/generateStoreId'\r\nimport combineEnum from '../utils/streams/combineEnum'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport {filterUnchangedKeyArrays} from '../utils/streams/filterWithPrevious'\r\n\r\nconst createMirrorBackend = () => {\r\n  let root\r\n  const storeMap = {}\r\n  const cursorBackend = createCursorBackend()\r\n\r\n  const {push: onStoreUpdated, $stream: $storeUpdated} = createEventSource()\r\n\r\n  const $queryResults = $storeUpdated\r\n    .map(({store, op}) => {\r\n      return cursorBackend.updateNode(root, {path: store.path, op})\r\n    })\r\n    .multicast()\r\n\r\n  const updateStore = (\r\n    store,\r\n    {requesting = [], streams, identifiers = [], metadata = {}}\r\n  ) => {\r\n    Object.assign(store, {identifiers, metadata})\r\n\r\n    invariant(\r\n      !identifiers.some(couldBeStoreId),\r\n      'Cannot precede all-uppercase identifiers with \"_\" (\"%s\") because they could conflict with internally-used IDs',\r\n      identifiers.find(couldBeStoreId)\r\n    )\r\n\r\n    const $storeDeleted = $queryResults.filter(() => !storeMap[store.id])\r\n\r\n    let ADD_STREAMS_ASYNC\r\n\r\n    store.mirror = createCursorAPI((cursorMethods, query) => {\r\n      const cursor = {}\r\n      requesting.concat('$actions').forEach(streamName => {\r\n        Object.defineProperty(cursor, streamName, {\r\n          get() {\r\n            const queryIndex = store.queries.length\r\n            store.queries.push(query)\r\n            store.queryTypes.push(streamName)\r\n            store.queryResults.push([])\r\n            if (ADD_STREAMS_ASYNC) {\r\n              warning(\r\n                false,\r\n                'Accessing \"mirror.%s\" after a store has been added is ineffcient, you can batch queries with `updateStore` to improve performance',\r\n                streamName\r\n              )\r\n              onStoreUpdated({store, op: 'update'})\r\n            }\r\n\r\n            return $queryResults\r\n              .map(queryResults => {\r\n                return queryResults[store.id] ? queryResults[store.id][queryIndex] : []\r\n              })\r\n              .thru(filterUnchangedKeyArrays)\r\n              .map(stores => {\r\n                store.queryResults[queryIndex] = stores\r\n                return (streamName === '$actions' ? most.mergeArray : combineEnum)(\r\n                  stores\r\n                    .map(id => {\r\n                      if (id === store.id && query.length && streamName === '$state') {\r\n                        return undefined\r\n                      }\r\n                      let $stream = storeMap[id] && storeMap[id].streams[streamName]\r\n                      if ($stream && storeMap[id] && storeMap[id].tails[streamName]) {\r\n                        $stream = $stream.startWith(storeMap[id].tails[streamName])\r\n                      }\r\n                      return $stream\r\n                    })\r\n                    .filter(s => s),\r\n                  stores\r\n                )\r\n              })\r\n              .switchLatest()\r\n              .until($storeDeleted)\r\n          }\r\n        })\r\n      })\r\n      Object.defineProperty(cursor, '$stores', {\r\n        get() {\r\n          return $queryResults\r\n            .map(() => ({\r\n              cursor: cursorBackend.query(store.id, query),\r\n              store\r\n            }))\r\n            .until($storeDeleted)\r\n        }\r\n      })\r\n      Object.assign(cursor, cursorMethods)\r\n      return cursor\r\n    })\r\n\r\n    store.dispatch = createCursorAPI((cursorMethods, query) => {\r\n      const dispatch = (type, payload, retryIfSelectionEmpty = true) => {\r\n        invariant(\r\n          storeMap[store.id],\r\n          'Cannot dispatch actions (\"%s\") from a store (\"%s\") that does not exist',\r\n          type,\r\n          store.id\r\n        )\r\n        const stores = cursorBackend.query(store.id, query)\r\n        if (stores.length || !retryIfSelectionEmpty) {\r\n          stores.forEach(id => {\r\n            storeMap[id] && storeMap[id].streams.$actions.push({type, payload, store: id})\r\n          })\r\n          return\r\n        }\r\n\r\n        $queryResults\r\n          .until(\r\n            $storeDeleted.tap(() => {\r\n              warning(\r\n                false,\r\n                'No store matched an action (\"%s\"), & the dispatcher (\"%s\") was removed. We\\'ve discarded the action. You could try dispatching the action via a proxy.',\r\n                type,\r\n                store.id\r\n              )\r\n            })\r\n          )\r\n          .map(() => cursorBackend.query(store.id, query))\r\n          .filter(stores => stores.length)\r\n          .take(1)\r\n          .observe(stores => {\r\n            stores.forEach(id => {\r\n              if (storeMap[id]) {\r\n                storeMap[id].streams.$actions.push({type, payload, store: id})\r\n              }\r\n            })\r\n          })\r\n      }\r\n      Object.assign(dispatch, cursorMethods)\r\n      return dispatch\r\n    })\r\n\r\n    if (!store.streams.$actions) {\r\n      const {push: dispatch, $stream: $actions} = createEventSource()\r\n      store.streams.$actions = $actions.until($storeDeleted).multicast()\r\n      store.streams.$actions.push = dispatch\r\n    }\r\n\r\n    if (streams) {\r\n      const _streams = streams(store.mirror, store.dispatch)\r\n      Object.keys(_streams).forEach(streamName => {\r\n        _streams[streamName] = _streams[streamName]\r\n          .tap(evt => (store.tails[streamName] = evt))\r\n          .multicast()\r\n      })\r\n      store.streams = Object.assign(_streams, {\r\n        $actions: store.streams.$actions\r\n      })\r\n    }\r\n\r\n    ADD_STREAMS_ASYNC = true\r\n  }\r\n\r\n  const backend = {\r\n    addStore(parentId, {requesting, streams, identifiers, metadata}) {\r\n      if (!parentId) parentId = root && root.id\r\n      const parent = storeMap[parentId]\r\n      invariant(\r\n        parent || !root,\r\n        'Cannot add store as a child of \"%s\", because \"%s\" does not exist',\r\n        parentId,\r\n        parentId\r\n      )\r\n\r\n      const store = {\r\n        id: generateStoreId(),\r\n        path: root ? parent.path.concat(parentId) : [],\r\n        streams: {},\r\n        tails: {},\r\n        queries: [],\r\n        queryTypes: [],\r\n        queryResults: [],\r\n        children: {},\r\n        parent\r\n      }\r\n\r\n      if (store.parent) store.parent.children[store.id] = store\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      storeMap[store.id] = store\r\n      onStoreUpdated({store, op: 'add'})\r\n      store.dispatch('INITIALIZE')\r\n\r\n      return store\r\n    },\r\n    removeStore(storeId) {\r\n      const store = storeMap[storeId]\r\n      if (!store) return\r\n      invariant(store !== root, 'Cannot remove root store')\r\n\r\n      const traverse = store => {\r\n        Object.values(store.children).forEach(traverse)\r\n        store.dispatch('TEARDOWN')\r\n        delete storeMap[store.id]\r\n        onStoreUpdated({store, op: 'remove'})\r\n      }\r\n      traverse(store)\r\n\r\n      if (store && store.parent) {\r\n        delete store.parent.children[storeId]\r\n      }\r\n    },\r\n    updateStore(storeId, {requesting, streams, identifiers, metadata}) {\r\n      const store = storeMap[storeId]\r\n      invariant(store, 'Cannot update a store (\"%s\") that does not exist', storeId)\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      onStoreUpdated({store, op: 'update'})\r\n\r\n      return store\r\n    },\r\n    query: createCursorAPI((cursorMethods, query) => {\r\n      const runQuery = () => cursorBackend.query(root.id, query)\r\n      Object.assign(runQuery, cursorMethods)\r\n      return runQuery\r\n    }),\r\n    stores: storeMap\r\n  }\r\n\r\n  backend.root = root = backend.addStore(null, {\r\n    identifiers: ['MIRROR/root'],\r\n    metadata: {root: true}\r\n  })\r\n\r\n  return backend\r\n}\r\n\r\nexport default createMirrorBackend\r\n","import createMirrorBackend from './backend'\r\n\r\nconst MirrorBackend = createMirrorBackend()\r\n\r\nexport default MirrorBackend\r\n","const hasOwn = Object.prototype.hasOwnProperty\r\n\r\nconst shallowEqual = (a, b) => {\r\n  if (a === b) return true\r\n  if (typeof a !== 'object' || typeof b !== 'object' || !a !== !b) return false\r\n\r\n  let countA = 0\r\n  let countB = 0\r\n\r\n  for (let key in a) {\r\n    if (hasOwn.call(a, key) && a[key] !== b[key]) return false\r\n    countA++\r\n  }\r\n\r\n  for (let key in b) {\r\n    if (hasOwn.call(b, key)) countB++\r\n  }\r\n\r\n  return countA === countB\r\n}\r\n\r\nexport default shallowEqual\r\n","import * as most from 'most'\r\nimport React from 'react'\r\nimport warning from 'warning'\r\nimport invariant from 'invariant'\r\nimport MirrorBackend from '../backend'\r\nimport shallowEqual from '../utils/shallowEqual'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport {filterUnchanged} from '../utils/streams/filterWithPrevious'\r\n\r\nconst instantiseMapToProps = mapToProps => {\r\n  let CALLED_ONCE\r\n  const instantisedMapToProps = (state, props) => {\r\n    let result = mapToProps(state, props)\r\n    if (!CALLED_ONCE && typeof result === 'function') {\r\n      mapToProps = result\r\n      result = mapToProps(state, props)\r\n    }\r\n    CALLED_ONCE = true\r\n    return result\r\n  }\r\n  return instantisedMapToProps\r\n}\r\n\r\nfunction createMirrorDecorator(config = {}) {\r\n  return function decorateWithMirror(WrappedComponent) {\r\n    let {name = [], state, mapToProps, pure = true} = config\r\n    if (!(name instanceof Array)) name = [name]\r\n    if (typeof mapToProps !== 'function') {\r\n      mapToProps = (state, {withName, ...props}) => ({...props, ...state})\r\n    }\r\n    if (!pure) pure = {propsEqual() {}, stateEqual() {}, propsStateEqual() {}}\r\n    if (pure === true) pure = {}\r\n    pure = Object.assign(\r\n      {\r\n        propsEqual: shallowEqual,\r\n        stateEqual: shallowEqual,\r\n        propsStateEqual: shallowEqual\r\n      },\r\n      pure\r\n    )\r\n\r\n    if (!WrappedComponent) {\r\n      WrappedComponent = function Noop() {\r\n        return null\r\n      }\r\n    }\r\n    const _name = WrappedComponent.displayName || WrappedComponent.name || 'Component'\r\n    const stateless = !WrappedComponent.prototype.render\r\n    invariant(\r\n      name.every(name => typeof name === 'string'),\r\n      '`name` should be a string or array of strings (at \"%s\")',\r\n      _name\r\n    )\r\n\r\n    const getPropNames = (name = []) => {\r\n      if (!(name instanceof Array)) name = [name]\r\n      return name.filter(name => typeof name === 'string').sort()\r\n    }\r\n\r\n    class Mirror extends React.Component {\r\n      constructor(props, context) {\r\n        super()\r\n        this.props = props\r\n        this.state = {updateCount: 0, props: undefined}\r\n\r\n        let {push: onReceivedProps, $stream: $props} = createEventSource()\r\n        Object.assign(this, {onReceivedProps})\r\n\r\n        const {id, mirror, dispatch, streams} = MirrorBackend.addStore(context.id, {\r\n          requesting: ['$state', '$props'],\r\n          identifiers: [\r\n            ...name,\r\n            ...getPropNames(this.props.withName),\r\n            Mirror.__COMPONENT_IDENTIFIER__\r\n          ],\r\n          streams: (mirror, dispatch) => {\r\n            $props = filterUnchanged(pure.propsEqual.bind(this), $props.startWith(props))\r\n            let $state = typeof state === 'function' && state.call(this, mirror, dispatch)\r\n            warning(\r\n              !state || ($state && $state.subscribe),\r\n              '`state` should return a stream, did you forget a \"return\" statement? (at \"%s\")',\r\n              [_name].concat(name.filter(name => typeof name === 'string').join(', '))\r\n            )\r\n            if (!state || !$state || !$state.subscribe) return {$props}\r\n            $state = filterUnchanged(pure.stateEqual.bind(this), $state).filter(\r\n              state => state !== undefined\r\n            )\r\n            return {$state, $props}\r\n          },\r\n          metadata: {\r\n            instance: this\r\n          }\r\n        })\r\n        Object.assign(this, {id, mirror, dispatch})\r\n\r\n        const $propsState = streams.$state\r\n          ? most.combine(\r\n              instantiseMapToProps(mapToProps.bind(this)),\r\n              streams.$state,\r\n              streams.$props\r\n            )\r\n          : streams.$props.map(instantiseMapToProps(mapToProps.bind(this, undefined)))\r\n\r\n        filterUnchanged(\r\n          pure.propsStateEqual.bind(this),\r\n          $propsState\r\n        ).observe(propsState => {\r\n          this.setState(({updateCount}) => ({updateCount: updateCount + 1, propsState}))\r\n        })\r\n      }\r\n      getWrappedInstance() {\r\n        invariant(\r\n          !stateless,\r\n          \"Stateless components (eg, `() => {}`) don't have refs, and therefore can't be unwrapped.\"\r\n        )\r\n        return this.wrappedInstance\r\n      }\r\n      getChildContext() {\r\n        return {id: this.id}\r\n      }\r\n      componentWillReceiveProps(nextProps) {\r\n        const nextName = getPropNames(nextProps.withName)\r\n        const currentName = getPropNames(this.props.withName)\r\n        if (JSON.stringify(nextName) !== JSON.stringify(currentName)) {\r\n          MirrorBackend.updateStore(this.id, {\r\n            requesting: ['$state', '$props'],\r\n            identifiers: [...name, ...nextName, Mirror.__COMPONENT_IDENTIFIER__],\r\n            metadata: {instance: this}\r\n          })\r\n        }\r\n        this.onReceivedProps(nextProps)\r\n      }\r\n      shouldComponentUpdate(nextProps, nextState) {\r\n        return nextState.updateCount > this.state.updateCount\r\n      }\r\n      componentWillUnmount() {\r\n        MirrorBackend.removeStore(this.id)\r\n      }\r\n      render() {\r\n        if (this.state.updateCount === 0 && state) {\r\n          return null\r\n        }\r\n\r\n        const props = {\r\n          ...this.state.propsState,\r\n          dispatch: this.dispatch\r\n        }\r\n        if (!stateless) props.ref = ref => (this.wrappedInstance = ref)\r\n\r\n        return React.createElement(WrappedComponent, props)\r\n      }\r\n    }\r\n\r\n    Mirror.displayName = `Mirror(${_name})`\r\n    Mirror.contextTypes = {id() {}}\r\n    Mirror.childContextTypes = {id() {}}\r\n    Mirror.__COMPONENT_IDENTIFIER__ = Mirror\r\n\r\n    const createStaticCursors = () => {\r\n      delete Mirror.mirror\r\n      delete Mirror.dispatch\r\n      if (Mirror !== Mirror.__COMPONENT_IDENTIFIER__) {\r\n        Mirror.mirror = Mirror.__COMPONENT_IDENTIFIER__.mirror\r\n        Mirror.dispatch = Mirror.__COMPONENT_IDENTIFIER__.dispatch\r\n        return\r\n      }\r\n\r\n      const {mirror, dispatch} = MirrorBackend.addStore(null, {\r\n        identifiers: ['MIRROR/static', `MIRROR/static/${_name}`],\r\n        metadata: {\r\n          static: Mirror\r\n        }\r\n      })\r\n\r\n      Object.assign(Mirror, {\r\n        mirror: mirror.all(Mirror),\r\n        dispatch: dispatch.all(Mirror)\r\n      })\r\n    }\r\n\r\n    Object.defineProperties(Mirror, {\r\n      mirror: {get: () => (createStaticCursors(), Mirror.mirror)},\r\n      dispatch: {get: () => (createStaticCursors(), Mirror.dispatch)}\r\n    })\r\n\r\n    Mirror.__WITH_NAME_CACHE__ = Mirror.__COMPONENT_IDENTIFIER__.__WITH_NAME_CACHE__ || {}\r\n\r\n    Mirror.withName = function withName(...withName) {\r\n      withName = name.concat(...withName)\r\n      const key = JSON.stringify(withName.sort())\r\n      const cachedComponent = Mirror.__WITH_NAME_CACHE__[key]\r\n      if (cachedComponent) return cachedComponent\r\n\r\n      const renamedComponent = createMirrorDecorator({\r\n        ...config,\r\n        name: withName\r\n      })(WrappedComponent)\r\n      renamedComponent.__COMPONENT_IDENTIFIER__ = Mirror.__COMPONENT_IDENTIFIER__\r\n      if (withName.length) Mirror.__WITH_NAME_CACHE__[key] = renamedComponent\r\n      return renamedComponent\r\n    }\r\n\r\n    return Mirror\r\n  }\r\n}\r\n\r\nexport default createMirrorDecorator\r\n","const isAction = action => {\r\n  if (\r\n    action &&\r\n    typeof action.type === 'string' &&\r\n    action.hasOwnProperty('payload') &&\r\n    typeof action.store === 'string'\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst findAction = args => {\r\n  let i = args.length\r\n  while (i--) {\r\n    if (isAction(args[i])) return args[i]\r\n    if (args[i] && isAction(args[i].action)) return args[i].action\r\n  }\r\n  return null\r\n}\r\n\r\nconst handleActions = (handlers, initialState) => (...args) => {\r\n  let action = findAction(args)\r\n  const state = args[0] === undefined ? initialState : args[0]\r\n\r\n  if (!action || !handlers[action.type]) return state\r\n  if (initialState !== undefined) return handlers[action.type](state, action)\r\n  return handlers[action.type](action)\r\n}\r\n\r\nexport default handleActions\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport Enum from '../Enum'\r\n\r\nconst combine = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  invariant(\r\n    streams.every($stream => $stream && $stream.subscribe),\r\n    '`combine` only accepts streams'\r\n  )\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        result[key] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combine\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\n\r\nconst SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst combineEventsWithDefault = (eventStream, otherStream) => {\r\n  return most\r\n    .combine((event, other) => ({event, other}))\r\n    .loop(\r\n      ({prevAction, before}, {event, other: after}) => ({\r\n        seed: {\r\n          prevAction: event,\r\n          before: prevAction === event ? SKIP_TOKEN : after\r\n        },\r\n        value: before === SKIP_TOKEN ? {before, event, after} : SKIP_TOKEN\r\n      }),\r\n      {}\r\n    )\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nconst combineEventsWithBefore = (eventStream, otherStream) => {\r\n  return eventStream.sample((event, other) => ({before: other, event}), otherStream)\r\n}\r\n\r\nconst combineEventsWithAfter = (eventStream, otherStream) => {\r\n  return combineEventsWithDefault(eventStream, otherStream).map(value => {\r\n    delete value.before\r\n    return value\r\n  })\r\n}\r\n\r\nconst combineEventsWithNothing = eventStream => {\r\n  return eventStream.map(event => ({event}))\r\n}\r\n\r\nconst combineEventsWith = (\r\n  eventStream,\r\n  otherStream,\r\n  options = {before: true, after: true}\r\n) => {\r\n  invariant(\r\n    eventStream && otherStream && eventStream.subscribe && otherStream.subscribe,\r\n    '`combineEventsWith` only accepts streams'\r\n  )\r\n  if (options.before && options.after) {\r\n    return combineEventsWithDefault(eventStream, otherStream)\r\n  } else if (options.before) {\r\n    return combineEventsWithBefore(eventStream, otherStream)\r\n  } else if (options.after) {\r\n    return combineEventsWithAfter(eventStream, otherStream)\r\n  }\r\n\r\n  return combineEventsWithNothing(eventStream)\r\n}\r\n\r\nexport default combineEventsWith\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport Enum from '../Enum'\r\n\r\nconst combineNested = streamMap => {\r\n  const keys = Object.keys(streamMap)\r\n  const streams = keys.map(key => streamMap[key])\r\n  invariant(\r\n    streams.every($stream => $stream && $stream.subscribe),\r\n    '`combine` only accepts streams'\r\n  )\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        if (!result[key]) result[key] = {}\r\n        result[key][keys[i]] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combineNested\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\n\r\nconst combineSimple = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  invariant(\r\n    streams.every($stream => $stream && $stream.subscribe),\r\n    '`combineSimple` only accepts streams'\r\n  )\r\n  return most.combineArray((...values) => [...values], streams)\r\n}\r\n\r\nexport default combineSimple\r\n","import 'regenerator-runtime/runtime'\r\nimport MirrorBackend from './backend'\r\nimport Mirror from './bindings'\r\nimport Enum from './utils/Enum'\r\nimport handleActions from './utils/handleActions'\r\nimport shallowEqual from './utils/shallowEqual'\r\nimport combine from './utils/streams/combine'\r\nimport combineEventsWith from './utils/streams/combineEventsWith'\r\nimport combineNested from './utils/streams/combineNested'\r\nimport combineSimple from './utils/streams/combineSimple'\r\nimport filterWithPrevious from './utils/streams/filterWithPrevious'\r\n\r\nconst {addStore, removeStore, updateStore, query, root, stores} = MirrorBackend\r\n\r\nexport {addStore, removeStore, updateStore, query, root, stores}\r\nexport {handleActions, Enum, shallowEqual}\r\nexport {combine, combineEventsWith, combineNested, combineSimple, filterWithPrevious}\r\nexport default Mirror\r\n"],"names":["traverse","tree","onVisit","q","length","node","shift","push","Object","values","children","getChildren","getParents","parents","parent","testFilter","filter","id","component","identifiers","includes","runQuery","originIds","query","operator","op","originNodes","result","map","getMatches","matches","slice","maxStores","concat","Array","from","Set","createCursorBackend","prevTree","origin","results","queries","createCursorAPI","enhancer","cursorMethods","newQuery","Infinity","__COMPONENT_IDENTIFIER__","ALPHABET","counter","generateStoreId","i","unshift","char","join","couldBeStoreId","RegExp","prototype","test","bind","Enum","obj","keys","key","defineProperty","value","fill","v","forEach","f","index","arr","every","find","findIndex","some","reduce","prev","reduceRight","SKIP_TOKEN","combineEnum","streams","ids","most","$start","until","$stream","eventSource","eventGenerator","buffer","next","event","setResolve","resolve","reject","Promise","filterWithPreviousBase","reverse","loop","prevValue","include","seed","undefined","filterUnchanged","filterWithPrevious","keyArrayEqual","keyArray","oldKeyArray","oldKeySet","has","filterUnchangedKeyArrays","isEqual","createMirrorBackend","root","storeMap","cursorBackend","createEventSource","onStoreUpdated","$storeUpdated","$queryResults","store","updateNode","path","multicast","updateStore","requesting","metadata","assign","$storeDeleted","ADD_STREAMS_ASYNC","mirror","cursor","streamName","queryIndex","queryTypes","queryResults","thru","stores","tails","startWith","s","switchLatest","dispatch","type","payload","retryIfSelectionEmpty","$actions","tap","take","observe","_streams","evt","backend","parentId","storeId","addStore","MirrorBackend","hasOwn","hasOwnProperty","shallowEqual","a","b","countA","countB","call","instantiseMapToProps","CALLED_ONCE","instantisedMapToProps","state","props","mapToProps","createMirrorDecorator","config","decorateWithMirror","WrappedComponent","name","pure","withName","Noop","_name","displayName","stateless","render","getPropNames","sort","Mirror","context","updateCount","onReceivedProps","$props","propsEqual","$state","subscribe","stateEqual","$propsState","propsStateEqual","setState","propsState","wrappedInstance","nextProps","nextName","currentName","JSON","stringify","instance","nextState","removeStore","ref","React","createElement","Component","contextTypes","childContextTypes","createStaticCursors","all","defineProperties","get","__WITH_NAME_CACHE__","cachedComponent","renamedComponent","isAction","action","findAction","args","handleActions","handlers","initialState","combine","enumCollection","combineEventsWithDefault","eventStream","otherStream","other","prevAction","before","after","combineEventsWithBefore","sample","combineEventsWithAfter","combineEventsWithNothing","combineEventsWith","options","combineNested","streamMap","combineSimple"],"mappings":"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"}