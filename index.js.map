{"version":3,"file":"index.js","sources":["src/cursor/cursor_naive.js","src/utils/createCursorAPI.js","src/utils/generateStoreId.js","src/utils/multicast/MulticastDisposable.js","src/utils/multicast/tryEvent.js","src/utils/multicast/dispose.js","node_modules/@most/prelude/dist/index.es.js","src/utils/multicast/MulticastSource.js","src/utils/multicast/Prioritise.js","src/utils/multicast/index.js","src/utils/Enum.js","src/utils/streams/combineValuesIntoEnum.js","src/utils/streams/eventSource.js","src/utils/streams/filterUnchangedKeyArrays.js","src/backend/backend.js","src/backend/index.js","src/bindings/scheduler.js","src/utils/shallowEqual.js","src/bindings/react.js","src/utils/handleActions.js","src/utils/streams/combineEnums.js","src/utils/streams/combineEventsWith.js","src/utils/streams/combineNested.js","src/utils/streams/combine.js","src/index.js"],"sourcesContent":["const traverse = (tree, onVisit) => {\r\n  const q = [tree]\r\n\r\n  while (q.length) {\r\n    const node = q.shift()\r\n    q.push(...Object.values(node.children))\r\n    onVisit(node)\r\n  }\r\n}\r\n\r\nconst getChildren = node => {\r\n  const children = []\r\n  traverse(node, node => children.push(node))\r\n  return children\r\n}\r\n\r\nconst getParents = node => {\r\n  const parents = []\r\n  while (node.parent) {\r\n    node = node.parent\r\n    parents.push(node)\r\n  }\r\n  return parents\r\n}\r\n\r\nconst testFilter = (node, filter) => {\r\n  if (!filter || filter === node.id || node.identifiers.includes(filter)) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst runQuery = (tree, originIds, query) => {\r\n  if (!query.length) return originIds\r\n\r\n  let operator\r\n  ;[operator, ...query] = query\r\n\r\n  if (operator.op === 'root') return runQuery(tree, [tree.id], query)\r\n\r\n  const originNodes = []\r\n  traverse(tree, node => {\r\n    if (originIds.includes(node.id)) {\r\n      originNodes.push(node)\r\n    }\r\n  })\r\n\r\n  const result = (() => {\r\n    let result = originNodes.map(node => {\r\n      const getMatches = operator.op === 'children' ? getChildren : getParents\r\n      let matches = getMatches(node)\r\n      matches = matches.filter(node => testFilter(node, operator.filter))\r\n      matches = matches.slice(0, operator.maxStores)\r\n      matches = matches.map(node => node.id)\r\n      return matches\r\n    })\r\n    result = [].concat(...result)\r\n    result = Array.from(new Set(result))\r\n    return result\r\n  })()\r\n\r\n  return runQuery(tree, result, query)\r\n}\r\n\r\nconst createCursorBackend = () => {\r\n  let prevTree\r\n\r\n  return {\r\n    query(origin, query) {\r\n      if (!prevTree) return []\r\n      return runQuery(prevTree, [origin], query)\r\n    },\r\n    updateNode(tree, op) {\r\n      prevTree = tree\r\n      const results = {}\r\n      traverse(tree, node => {\r\n        results[node.id] = node.queries.map(query => {\r\n          return runQuery(tree, [node.id], query)\r\n        })\r\n      })\r\n      return results\r\n    }\r\n  }\r\n}\r\n\r\nexport default createCursorBackend\r\n","const createCursorAPI = (enhancer, query = []) => {\r\n  const cursorMethods = {\r\n    root() {\r\n      const newQuery = [{op: 'root'}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    parents(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'parents', filter, maxStores})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    children(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'children', filter, maxStores})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    all(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = [{op: 'root'}, {op: 'children', filter, maxStores}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    one(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = [{op: 'root'}, {op: 'children', filter, maxStores: 1}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    parent(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'parents', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    child(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'children', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    }\r\n  }\r\n  return enhancer(cursorMethods, query)\r\n}\r\n\r\nexport default createCursorAPI\r\n","/*\r\n  Store ids should:\r\n\r\n    * Be easy to read / recognise\r\n    * Not conflict with filters\r\n    * Communicate how many components have been mounted during session\r\n*/\r\nconst ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\r\n\r\nconst counter = [0, -1]\r\n\r\nconst generateStoreId = () => {\r\n  for (let i = counter.length - 1; i >= 0; i--) {\r\n    if (counter[i] === 25) {\r\n      counter[i] = 0\r\n      if (!i) counter.unshift(0)\r\n    } else {\r\n      counter[i] += 1\r\n      break\r\n    }\r\n  }\r\n  return '_' + counter.map(char => ALPHABET[char]).join('')\r\n}\r\n\r\nexport const couldBeStoreId = RegExp.prototype.test.bind(/^_[A-Z]{2,12}$/)\r\n\r\nexport default generateStoreId\r\n","export default class MulticastDisposable {\r\n  constructor (source, sink) {\r\n    this.source = source\r\n    this.sink = sink\r\n    this.disposed = false\r\n  }\r\n\r\n  dispose () {\r\n    if (this.disposed) {\r\n      return\r\n    }\r\n    this.disposed = true\r\n    const remaining = this.source.remove(this.sink)\r\n    return remaining === 0 && this.source._dispose()\r\n  }\r\n}\r\n","export function tryEvent (t, x, sink) {\r\n  try {\r\n    sink.event(t, x)\r\n  } catch (e) {\r\n    sink.error(t, e)\r\n  }\r\n}\r\n\r\nexport function tryEnd (t, x, sink) {\r\n  try {\r\n    sink.end(t, x)\r\n  } catch (e) {\r\n    sink.error(t, e)\r\n  }\r\n}\r\n","export const dispose = disposable => disposable.dispose()\r\n\r\nexport const emptyDisposable = {\r\n  dispose () {}\r\n}\r\n","/** @license MIT License (c) copyright 2010-2016 original author or authors */\n\n  // Non-mutating array operations\n\n  // cons :: a -> [a] -> [a]\n  // a with x prepended\n  function cons (x, a) {\n    var l = a.length\n    var b = new Array(l + 1)\n    b[0] = x\n    for (var i = 0; i < l; ++i) {\n      b[i + 1] = a[i]\n    }\n    return b\n  }\n\n  // append :: a -> [a] -> [a]\n  // a with x appended\n  function append (x, a) {\n    var l = a.length\n    var b = new Array(l + 1)\n    for (var i = 0; i < l; ++i) {\n      b[i] = a[i]\n    }\n\n    b[l] = x\n    return b\n  }\n\n  // drop :: Int -> [a] -> [a]\n  // drop first n elements\n  function drop (n, a) { // eslint-disable-line complexity\n    if (n < 0) {\n      throw new TypeError('n must be >= 0')\n    }\n\n    var l = a.length\n    if (n === 0 || l === 0) {\n      return a\n    }\n\n    if (n >= l) {\n      return []\n    }\n\n    return unsafeDrop(n, a, l - n)\n  }\n\n  // unsafeDrop :: Int -> [a] -> Int -> [a]\n  // Internal helper for drop\n  function unsafeDrop (n, a, l) {\n    var b = new Array(l)\n    for (var i = 0; i < l; ++i) {\n      b[i] = a[n + i]\n    }\n    return b\n  }\n\n  // tail :: [a] -> [a]\n  // drop head element\n  function tail (a) {\n    return drop(1, a)\n  }\n\n  // copy :: [a] -> [a]\n  // duplicate a (shallow duplication)\n  function copy (a) {\n    var l = a.length\n    var b = new Array(l)\n    for (var i = 0; i < l; ++i) {\n      b[i] = a[i]\n    }\n    return b\n  }\n\n  // map :: (a -> b) -> [a] -> [b]\n  // transform each element with f\n  function map (f, a) {\n    var l = a.length\n    var b = new Array(l)\n    for (var i = 0; i < l; ++i) {\n      b[i] = f(a[i])\n    }\n    return b\n  }\n\n  // reduce :: (a -> b -> a) -> a -> [b] -> a\n  // accumulate via left-fold\n  function reduce (f, z, a) {\n    var r = z\n    for (var i = 0, l = a.length; i < l; ++i) {\n      r = f(r, a[i], i)\n    }\n    return r\n  }\n\n  // replace :: a -> Int -> [a]\n  // replace element at index\n  function replace (x, i, a) { // eslint-disable-line complexity\n    if (i < 0) {\n      throw new TypeError('i must be >= 0')\n    }\n\n    var l = a.length\n    var b = new Array(l)\n    for (var j = 0; j < l; ++j) {\n      b[j] = i === j ? x : a[j]\n    }\n    return b\n  }\n\n  // remove :: Int -> [a] -> [a]\n  // remove element at index\n  function remove (i, a) {  // eslint-disable-line complexity\n    if (i < 0) {\n      throw new TypeError('i must be >= 0')\n    }\n\n    var l = a.length\n    if (l === 0 || i >= l) { // exit early if index beyond end of array\n      return a\n    }\n\n    if (l === 1) { // exit early if index in bounds and length === 1\n      return []\n    }\n\n    return unsafeRemove(i, a, l - 1)\n  }\n\n  // unsafeRemove :: Int -> [a] -> Int -> [a]\n  // Internal helper to remove element at index\n  function unsafeRemove (i, a, l) {\n    var b = new Array(l)\n    var j\n    for (j = 0; j < i; ++j) {\n      b[j] = a[j]\n    }\n    for (j = i; j < l; ++j) {\n      b[j] = a[j + 1]\n    }\n\n    return b\n  }\n\n  // removeAll :: (a -> boolean) -> [a] -> [a]\n  // remove all elements matching a predicate\n  function removeAll (f, a) {\n    var l = a.length\n    var b = new Array(l)\n    var j = 0\n    for (var x, i = 0; i < l; ++i) {\n      x = a[i]\n      if (!f(x)) {\n        b[j] = x\n        ++j\n      }\n    }\n\n    b.length = j\n    return b\n  }\n\n  // findIndex :: a -> [a] -> Int\n  // find index of x in a, from the left\n  function findIndex (x, a) {\n    for (var i = 0, l = a.length; i < l; ++i) {\n      if (x === a[i]) {\n        return i\n      }\n    }\n    return -1\n  }\n\n  // isArrayLike :: * -> boolean\n  // Return true iff x is array-like\n  function isArrayLike (x) {\n    return x != null && typeof x.length === 'number' && typeof x !== 'function'\n  }\n\n/** @license MIT License (c) copyright 2010-2016 original author or authors */\n\n  // id :: a -> a\n  var id = function (x) { return x; }\n\n  // compose :: (b -> c) -> (a -> b) -> (a -> c)\n  var compose = function (f, g) { return function (x) { return f(g(x)); }; }\n\n  // apply :: (a -> b) -> a -> b\n  var apply = function (f, x) { return f(x); }\n\n  // curry2 :: ((a, b) -> c) -> (a -> b -> c)\n  function curry2 (f) {\n    function curried (a, b) {\n      switch (arguments.length) {\n        case 0: return curried\n        case 1: return function (b) { return f(a, b); }\n        default: return f(a, b)\n      }\n    }\n    return curried\n  }\n\n  // curry3 :: ((a, b, c) -> d) -> (a -> b -> c -> d)\n  function curry3 (f) {\n    function curried (a, b, c) { // eslint-disable-line complexity\n      switch (arguments.length) {\n        case 0: return curried\n        case 1: return curry2(function (b, c) { return f(a, b, c); })\n        case 2: return function (c) { return f(a, b, c); }\n        default:return f(a, b, c)\n      }\n    }\n    return curried\n  }\n\n  // curry4 :: ((a, b, c, d) -> e) -> (a -> b -> c -> d -> e)\n  function curry4 (f) {\n    function curried (a, b, c, d) { // eslint-disable-line complexity\n      switch (arguments.length) {\n        case 0: return curried\n        case 1: return curry3(function (b, c, d) { return f(a, b, c, d); })\n        case 2: return curry2(function (c, d) { return f(a, b, c, d); })\n        case 3: return function (d) { return f(a, b, c, d); }\n        default:return f(a, b, c, d)\n      }\n    }\n    return curried\n  }\n\nexport { cons, append, drop, tail, copy, map, reduce, replace, remove, removeAll, findIndex, isArrayLike, id, compose, apply, curry2, curry3, curry4 };\n//# sourceMappingURL=index.es.js.map\n","import MulticastDisposable from './MulticastDisposable'\r\nimport { tryEvent, tryEnd } from './tryEvent'\r\nimport { dispose, emptyDisposable } from './dispose'\r\nimport { remove, findIndex } from '@most/prelude'\r\n\r\nfunction insertWhen (x, a, f) {\r\n  const l = a.length\r\n  const b = new Array(l + 1)\r\n\r\n  let i = 0\r\n  for (; i < l; ++i) {\r\n    if (f(x, a[i])) {\r\n      break\r\n    }\r\n    b[i] = a[i]\r\n  }\r\n\r\n  b[i] = x\r\n\r\n  for (; i < l; ++i) {\r\n    b[i + 1] = a[i]\r\n  }\r\n\r\n  return b\r\n}\r\n\r\nfunction comparePriority (a, b) {\r\n  return (a.priority || 0) > (b.priority || 0)\r\n}\r\n\r\nexport default class MulticastSource {\r\n  constructor (source) {\r\n    this.source = source\r\n    this.sinks = []\r\n    this._disposable = emptyDisposable\r\n  }\r\n\r\n  run (sink, scheduler) {\r\n    const n = this.add(sink)\r\n    if (n === 1) {\r\n      this._disposable = this.source.run(this, scheduler)\r\n    }\r\n    return new MulticastDisposable(this, sink)\r\n  }\r\n\r\n  _dispose () {\r\n    const disposable = this._disposable\r\n    this._disposable = emptyDisposable\r\n    return Promise.resolve(disposable).then(dispose)\r\n  }\r\n\r\n  add (sink) {\r\n    this.sinks = insertWhen(sink, this.sinks, comparePriority)\r\n    return this.sinks.length\r\n  }\r\n\r\n  remove (sink) {\r\n    const i = findIndex(sink, this.sinks)\r\n    // istanbul ignore next\r\n    if (i >= 0) {\r\n      this.sinks = remove(i, this.sinks)\r\n    }\r\n\r\n    return this.sinks.length\r\n  }\r\n\r\n  event (time, value) {\r\n    const s = this.sinks\r\n    if (s.length === 1) {\r\n      return s[0].event(time, value)\r\n    }\r\n    for (let i = 0; i < s.length; ++i) {\r\n      tryEvent(time, value, s[i])\r\n    }\r\n  }\r\n\r\n  end (time, value) {\r\n    const s = this.sinks\r\n    for (let i = 0; i < s.length; ++i) {\r\n      tryEnd(time, value, s[i])\r\n    }\r\n  }\r\n\r\n  error (time, err) {\r\n    const s = this.sinks\r\n    for (let i = 0; i < s.length; ++i) {\r\n      s[i].error(time, err)\r\n    }\r\n  }\r\n}\r\n","class Prioritise {\n  constructor (priority, source) {\n    this.source = source\n    this.priority = priority\n  }\n  run (sink, scheduler) {\n    sink.priority = this.priority\n    return this.source.run(sink, scheduler)\n  }\n}\n\nexport default Prioritise\n","import MulticastSource from './MulticastSource'\r\nimport Prioritise from './Prioritise'\r\n\r\nfunction multicast (stream) {\r\n  const source = stream.source\r\n  return source instanceof MulticastSource\r\n    ? stream\r\n    : new stream.constructor(new MulticastSource(source))\r\n}\r\n\r\nfunction prioritise (priority, stream) {\r\n  return !stream\r\n    ? prioritise.bind(this, priority)\r\n    : new stream.constructor(new Prioritise(priority, stream.source))\r\n}\r\n\r\nexport {multicast, MulticastSource, prioritise, Prioritise}\r\n","class Enum extends Array {\r\n  constructor(obj = {}) {\r\n    const keys = Object.keys(obj)\r\n    const values = keys.map(key => obj[key])\r\n    super()\r\n    super.push(...values)\r\n    Object.defineProperty(this, 'keys', {value: keys})\r\n    Object.defineProperty(this, 'indexes', {\r\n      value: new Array(values.length).fill().map((v, i) => i)\r\n    })\r\n    keys.forEach(key => Object.defineProperty(this, key, {value: obj[key]}))\r\n  }\r\n  map(f) {\r\n    const obj = {}\r\n    this.forEach(function map(value, index, key, arr) {\r\n      obj[key] = f(value, index, key, arr)\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  filter(f) {\r\n    const obj = {}\r\n    this.forEach(function filter(value, index, key, arr) {\r\n      if (f(value, index, key, arr)) {\r\n        obj[key] = value\r\n      }\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  forEach(f) {\r\n    return super.forEach(function forEach(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  every(f) {\r\n    return super.every(function every(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  find(f) {\r\n    return super.find(function find(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  findIndex(f) {\r\n    return super.findIndex(function findIndex(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  some(f) {\r\n    return super.some(function some(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduce(f) {\r\n    return super.reduce(function reduce(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduceRight(f) {\r\n    return super.reduceRight(function reduceRight(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n}\r\n\r\nexport default Enum\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\n/*\r\n  Combines streams of normal values into a stream of Enums\r\n\r\n  Emits values immediately, w/o waiting for input streams to emit their first value\r\n*/\r\nconst combineValuesIntoEnum = (streams, ids) => {\r\n  if (!streams.length) return most.of(new Enum())\r\n  return most.combineArray(\r\n    (...values) => {\r\n      const result = {}\r\n      values.forEach((value, i) => {\r\n        if (value !== SKIP_TOKEN) result[ids[i]] = value\r\n      })\r\n      return new Enum(result)\r\n    },\r\n    streams.map($stream => {\r\n      const $start = most.of(SKIP_TOKEN).until($stream)\r\n      return $start.concat($stream)\r\n    })\r\n  )\r\n}\r\n\r\nexport default combineValuesIntoEnum\r\n","import * as most from 'most'\r\n\r\nconst eventSource = () => {\r\n  let buffer = []\r\n  let next\r\n  let push = event => {\r\n    if (next) {\r\n      next(event)\r\n      next = null\r\n    } else {\r\n      buffer.push(event)\r\n    }\r\n  }\r\n  const setResolve = (resolve, reject) => (next = resolve)\r\n  function* eventGenerator() {\r\n    while (true) {\r\n      if (buffer.length) yield Promise.resolve(buffer.shift())\r\n      else yield new Promise(setResolve)\r\n    }\r\n  }\r\n  return {\r\n    push,\r\n    $stream: most.generate(eventGenerator)\r\n  }\r\n}\r\n\r\nexport default eventSource\r\n","const SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst keyArrayEqual = ({oldKeyArray, oldKeySet}, keyArray) => {\r\n  if (oldKeyArray === keyArray) return true\r\n  if (oldKeyArray === undefined) return false\r\n\r\n  for (let i in keyArray) {\r\n    if (!oldKeySet.has(keyArray[i])) return false\r\n  }\r\n\r\n  return keyArray.length === oldKeyArray.length\r\n}\r\n\r\nconst filterUnchangedKeyArrays = $stream => {\r\n  return $stream\r\n    .loop((seed, keyArray) => {\r\n      let isEqual = keyArrayEqual(seed, keyArray)\r\n      if (isEqual) return {seed, value: SKIP_TOKEN}\r\n      return {\r\n        seed: {oldKeyArray: keyArray, oldKeySet: new Set(keyArray)},\r\n        value: keyArray\r\n      }\r\n    }, {})\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nexport default filterUnchangedKeyArrays\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport warning from 'warning'\r\nimport createCursorBackend from '../cursor'\r\nimport createCursorAPI from '../utils/createCursorAPI'\r\nimport generateStoreId, {couldBeStoreId} from '../utils/generateStoreId'\r\nimport {multicast, prioritise} from '../utils/multicast'\r\nimport combineValuesIntoEnum from '../utils/streams/combineValuesIntoEnum'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport filterUnchangedKeyArrays from '../utils/streams/filterUnchangedKeyArrays'\r\n\r\nconst createMirrorBackend = () => {\r\n  let root\r\n  const storeMap = {}\r\n  const cursorBackend = createCursorBackend()\r\n\r\n  const {push: onStoreUpdated, $stream: $storeUpdated} = createEventSource()\r\n\r\n  const $queryResults = $storeUpdated\r\n    .map(({store, op}) => {\r\n      return cursorBackend.updateNode(root, {path: store.path, op})\r\n    })\r\n    .multicast()\r\n\r\n  const updateStore = (\r\n    store,\r\n    {requesting = [], streams, identifiers = [], metadata = {}}\r\n  ) => {\r\n    Object.assign(store, {identifiers, metadata})\r\n\r\n    invariant(\r\n      !identifiers.some(couldBeStoreId),\r\n      'Cannot precede all-uppercase identifiers with \"_\" (\"%s\") because they could ' +\r\n        'conflict with internally-used IDs',\r\n      identifiers.find(couldBeStoreId)\r\n    )\r\n\r\n    const $storeDeleted = $queryResults.filter(() => !storeMap[store.id]).multicast()\r\n\r\n    let ADD_STREAMS_ASYNC\r\n\r\n    store.mirror = createCursorAPI((cursorMethods, query) => {\r\n      const cursor = {}\r\n      requesting.concat('$actions').forEach(streamName => {\r\n        Object.defineProperty(cursor, streamName, {\r\n          get() {\r\n            const queryIndex = store.queries.length\r\n            store.queries.push(query)\r\n            store.queryTypes.push(streamName)\r\n            store.queryResults.push([])\r\n            if (ADD_STREAMS_ASYNC) {\r\n              warning(\r\n                false,\r\n                'Accessing \"mirror.%s\" after a store has been added is ineffcient, you ' +\r\n                  'can batch queries with `updateStore` to improve performance',\r\n                streamName\r\n              )\r\n              onStoreUpdated({store, op: 'update'})\r\n            }\r\n\r\n            const teardown = store => ({\r\n              type: 'TEARDOWN',\r\n              payload: undefined,\r\n              store\r\n            })\r\n\r\n            const $stream = $queryResults\r\n              .map(queryResults => {\r\n                return queryResults[store.id] ? queryResults[store.id][queryIndex] : []\r\n              })\r\n              .thru(filterUnchangedKeyArrays)\r\n              .map(stores => {\r\n                const prev = store.queryResults[queryIndex]\r\n                store.queryResults[queryIndex] = stores\r\n                const $stores = stores\r\n                  .map(id => {\r\n                    if (id === store.id && query.length && streamName === '$state') {\r\n                      return undefined\r\n                    }\r\n                    let $stream = storeMap[id] && storeMap[id].streams[streamName]\r\n                    if (store.id === id) $stream = $stream.thru(prioritise(-1))\r\n                    if ($stream && storeMap[id] && storeMap[id].tails[streamName]) {\r\n                      $stream = $stream.startWith(storeMap[id].tails[streamName])\r\n                    }\r\n                    return $stream\r\n                  })\r\n                  .filter(s => s)\r\n                if (streamName === '$actions') {\r\n                  const deletedStores = []\r\n                  const next = new Set(stores)\r\n                  for (const id of prev) if (!next.has(id)) deletedStores.push(id)\r\n                  return most\r\n                    .from(deletedStores.map(teardown))\r\n                    .concat(most.mergeArray($stores))\r\n                } else {\r\n                  return combineValuesIntoEnum($stores, stores)\r\n                }\r\n              })\r\n              .switchLatest()\r\n              .until($storeDeleted)\r\n\r\n            return streamName === '$actions'\r\n              ? $stream.concat(most.of(teardown(store.id)))\r\n              : $stream\r\n          }\r\n        })\r\n      })\r\n      Object.defineProperty(cursor, '$stores', {\r\n        get() {\r\n          return $queryResults\r\n            .map(() => ({\r\n              cursor: cursorBackend.query(store.id, query),\r\n              store\r\n            }))\r\n            .until($storeDeleted)\r\n        }\r\n      })\r\n      Object.assign(cursor, cursorMethods)\r\n      return cursor\r\n    })\r\n\r\n    store.dispatch = createCursorAPI((cursorMethods, query) => {\r\n      const dispatch = (type, payload, retryIfSelectionEmpty = true) => {\r\n        invariant(\r\n          storeMap[store.id],\r\n          'Cannot dispatch actions (\"%s\") from a store (\"%s\") that does not exist',\r\n          type,\r\n          store.id\r\n        )\r\n        const stores = cursorBackend.query(store.id, query)\r\n        if (stores.length || !retryIfSelectionEmpty) {\r\n          stores.forEach(id => {\r\n            storeMap[id] && storeMap[id].streams.$actions.push({type, payload, store: id})\r\n          })\r\n          return\r\n        }\r\n\r\n        $queryResults\r\n          .until(\r\n            $storeDeleted.tap(() => {\r\n              warning(\r\n                false,\r\n                'No store matched an action (\"%s\"), & the dispatcher (\"%s\") was ' +\r\n                  \"removed. We've discarded the action. You could try dispatching the \" +\r\n                  'action via a proxy.',\r\n                type,\r\n                store.id\r\n              )\r\n            })\r\n          )\r\n          .map(() => cursorBackend.query(store.id, query))\r\n          .filter(stores => stores.length)\r\n          .take(1)\r\n          .observe(stores => {\r\n            stores.forEach(id => {\r\n              if (storeMap[id]) {\r\n                storeMap[id].streams.$actions.push({type, payload, store: id})\r\n              }\r\n            })\r\n          })\r\n      }\r\n      Object.assign(dispatch, cursorMethods)\r\n      return dispatch\r\n    })\r\n\r\n    if (!store.streams.$actions) {\r\n      const {push: dispatch, $stream: $actions} = createEventSource()\r\n      const initialize = {type: 'INITIALIZE', payload: undefined, store: store.id}\r\n      store.streams.$actions = $actions\r\n        .startWith(initialize)\r\n        .until($storeDeleted)\r\n        .thru(multicast)\r\n      store.streams.$actions.push = dispatch\r\n    }\r\n\r\n    if (streams) {\r\n      const _streams = streams(store.mirror, store.dispatch)\r\n      Object.keys(_streams).forEach(streamName => {\r\n        _streams[streamName] = _streams[streamName]\r\n          .tap(evt => (store.tails[streamName] = evt))\r\n          .thru(multicast)\r\n      })\r\n      store.streams = Object.assign(_streams, {\r\n        $actions: store.streams.$actions\r\n      })\r\n    }\r\n\r\n    ADD_STREAMS_ASYNC = true\r\n  }\r\n\r\n  const backend = {\r\n    addStore(parentId, {requesting, streams, identifiers, metadata}) {\r\n      if (!parentId) parentId = root && root.id\r\n      const parent = storeMap[parentId]\r\n      invariant(\r\n        parent || !root,\r\n        'Cannot add store as a child of \"%s\", because \"%s\" does not exist',\r\n        parentId,\r\n        parentId\r\n      )\r\n\r\n      const store = {\r\n        /*\r\n          '_AAC'\r\n        */\r\n        id: generateStoreId(),\r\n        /*\r\n          ['_AA', '_BX']\r\n        */\r\n        path: root ? parent.path.concat(parentId) : [],\r\n        /* {$actions, $state, $props} */\r\n        streams: {},\r\n        /*\r\n          {\r\n            $actions: {type: 'INCREMENT', payload: 1},\r\n            $state: {value: 2},\r\n            $props: {}\r\n          }\r\n        */\r\n        tails: {},\r\n        queries: [],\r\n        queryTypes: [],\r\n        queryResults: [],\r\n        children: {},\r\n        parent\r\n      }\r\n\r\n      if (store.parent) store.parent.children[store.id] = store\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      storeMap[store.id] = store\r\n      onStoreUpdated({store, op: 'add'})\r\n\r\n      return store\r\n    },\r\n    removeStore(storeId) {\r\n      const store = storeMap[storeId]\r\n      if (!store) return\r\n      invariant(store !== root, 'Cannot remove root store')\r\n\r\n      const traverse = store => {\r\n        Object.values(store.children).forEach(traverse)\r\n        delete storeMap[store.id]\r\n        onStoreUpdated({store, op: 'remove'})\r\n      }\r\n      traverse(store)\r\n\r\n      if (store && store.parent) {\r\n        delete store.parent.children[storeId]\r\n      }\r\n    },\r\n    updateStore(storeId, {requesting, streams, identifiers, metadata}) {\r\n      const store = storeMap[storeId]\r\n      invariant(store, 'Cannot update a store (\"%s\") that does not exist', storeId)\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      onStoreUpdated({store, op: 'update'})\r\n\r\n      return store\r\n    },\r\n    query: createCursorAPI((cursorMethods, query) => {\r\n      const runQuery = id => cursorBackend.query(id || root.id, query)\r\n      Object.assign(runQuery, cursorMethods)\r\n      return runQuery\r\n    }),\r\n    stores: storeMap\r\n  }\r\n\r\n  backend.root = root = backend.addStore(null, {\r\n    identifiers: ['MIRROR/root'],\r\n    metadata: {root: true}\r\n  })\r\n\r\n  return backend\r\n}\r\n\r\nexport default createMirrorBackend\r\n","import createMirrorBackend from './backend'\r\n\r\nconst MirrorBackend = createMirrorBackend()\r\n\r\nexport default MirrorBackend\r\n","import createEventSource from '../utils/streams/eventSource'\r\n\r\nconst createScheduler = () => {\r\n  const samplers = {}\r\n  let buffer = {}\r\n  let BUFFERING = false\r\n  return {\r\n    addStream(priority, id, $stream) {\r\n      samplers[id] = createEventSource()\r\n\r\n      return $stream\r\n        .tap(evt => {\r\n          buffer[id] = evt\r\n          if (!BUFFERING) {\r\n            BUFFERING = true\r\n            setTimeout(() => {\r\n              const _samplers = []\r\n              Object.keys(buffer).forEach(id => {\r\n                if (!_samplers[priority]) _samplers[priority] = []\r\n                if (samplers[id]) _samplers[priority].push(samplers[id])\r\n              })\r\n              _samplers.forEach(samplers => {\r\n                samplers.forEach(sampler => sampler.push(true))\r\n              })\r\n              BUFFERING = false\r\n              buffer = {}\r\n            })\r\n          }\r\n        })\r\n        .sampleWith(samplers[id].$stream)\r\n    },\r\n    removeStream(id) {\r\n      delete samplers[id]\r\n      delete buffer[id]\r\n    }\r\n  }\r\n}\r\n\r\nconst scheduler = createScheduler()\r\nexport default scheduler\r\n","const hasOwn = Object.prototype.hasOwnProperty\r\n\r\nconst shallowEqual = (a, b) => {\r\n  if (a === b) return true\r\n  if (typeof a !== 'object' || typeof b !== 'object' || !a !== !b) return false\r\n\r\n  let countA = 0\r\n  let countB = 0\r\n\r\n  for (let key in a) {\r\n    if (hasOwn.call(a, key) && a[key] !== b[key]) return false\r\n    countA++\r\n  }\r\n\r\n  for (let key in b) {\r\n    if (hasOwn.call(b, key)) countB++\r\n  }\r\n\r\n  return countA === countB\r\n}\r\n\r\nexport default shallowEqual\r\n","import * as most from 'most'\r\nimport React from 'react'\r\nimport warning from 'warning'\r\nimport invariant from 'invariant'\r\nimport scheduler from './scheduler'\r\nimport MirrorBackend from '../backend'\r\nimport shallowEqual from '../utils/shallowEqual'\r\nimport createEventSource from '../utils/streams/eventSource'\r\n\r\nconst instantiseMapToProps = mapToProps => {\r\n  let CALLED_ONCE\r\n  const instantisedMapToProps = (state, props) => {\r\n    let result = mapToProps(state, props)\r\n    if (!CALLED_ONCE && typeof result === 'function') {\r\n      mapToProps = result\r\n      result = mapToProps(state, props)\r\n    }\r\n    CALLED_ONCE = true\r\n    return result\r\n  }\r\n  return instantisedMapToProps\r\n}\r\n\r\nfunction createMirrorDecorator(config = {}) {\r\n  return function decorateWithMirror(WrappedComponent) {\r\n    let {name = [], state, mapToProps, pure = true} = config\r\n    if (!(name instanceof Array)) name = [name]\r\n    if (typeof mapToProps !== 'function') {\r\n      mapToProps = (state, {withName, ...props}) => ({...props, ...state})\r\n    }\r\n    if (!pure) pure = {propsEqual() {}, stateEqual() {}, propsStateEqual() {}}\r\n    if (pure === true) pure = {}\r\n    pure = Object.assign(\r\n      {\r\n        propsEqual: shallowEqual,\r\n        stateEqual: shallowEqual,\r\n        propsStateEqual: shallowEqual\r\n      },\r\n      pure\r\n    )\r\n\r\n    if (!WrappedComponent) {\r\n      WrappedComponent = function Noop() {\r\n        return null\r\n      }\r\n    }\r\n    const _name = WrappedComponent.displayName || WrappedComponent.name || 'Component'\r\n    const stateless = !WrappedComponent.prototype.render\r\n    invariant(\r\n      name.every(name => typeof name === 'string'),\r\n      '`name` should be a string or array of strings (at \"%s\")',\r\n      _name\r\n    )\r\n\r\n    const getPropNames = (name = []) => {\r\n      if (!(name instanceof Array)) name = [name]\r\n      return name.filter(name => typeof name === 'string').sort()\r\n    }\r\n\r\n    class Mirror extends React.Component {\r\n      constructor(props, context) {\r\n        super()\r\n        this.props = props\r\n        this.state = {updateCount: 0, props: undefined}\r\n\r\n        let {push: onReceivedProps, $stream: $props} = createEventSource()\r\n        Object.assign(this, {onReceivedProps})\r\n\r\n        const {id, path, mirror, dispatch, streams} = MirrorBackend.addStore(context.id, {\r\n          requesting: ['$state', '$props'],\r\n          identifiers: [\r\n            ...name,\r\n            ...getPropNames(this.props.withName),\r\n            Mirror.__COMPONENT_IDENTIFIER__\r\n          ],\r\n          streams: (mirror, dispatch) => {\r\n            $props = $props\r\n              .startWith(props)\r\n              .skipRepeatsWith(pure.propsEqual.bind(this))\r\n              .tap(props => (this._props = props))\r\n            let $state = typeof state === 'function' && state.call(this, mirror, dispatch)\r\n            warning(\r\n              !state || ($state && $state.subscribe),\r\n              '`state` should return a stream, did you forget a \"return\" statement? (at \"%s\")',\r\n              [_name].concat(name.filter(name => typeof name === 'string').join(', '))\r\n            )\r\n            if (!state || !$state || !$state.subscribe) return {$props}\r\n            $state = $state\r\n              .skipRepeatsWith(pure.stateEqual.bind(this))\r\n              .filter(state => state !== undefined)\r\n              .tap(state => (this._state = state))\r\n            return {$state, $props}\r\n          },\r\n          metadata: {\r\n            instance: this\r\n          }\r\n        })\r\n        Object.assign(this, {id, depth: path.length, mirror, dispatch})\r\n\r\n        const $propsState = streams.$state\r\n          ? most.combine(\r\n              instantiseMapToProps(mapToProps.bind(this)),\r\n              streams.$state,\r\n              streams.$props\r\n            )\r\n          : streams.$props.map(instantiseMapToProps(mapToProps.bind(this, undefined)))\r\n\r\n        $propsState\r\n          .skipRepeatsWith(pure.propsStateEqual.bind(this))\r\n          .thru(scheduler.addStream.bind(null, this.depth, id))\r\n          .observe(propsState => {\r\n            this._propsState = propsState\r\n            if (this._unmounted) return\r\n            this.setState(({updateCount}) => ({updateCount: updateCount + 1, propsState}))\r\n          })\r\n          .then(scheduler.removeStream.bind(null, id))\r\n      }\r\n      getWrappedInstance() {\r\n        invariant(\r\n          !stateless,\r\n          \"Stateless components (eg, `() => {}`) don't have refs, and therefore can't be unwrapped.\"\r\n        )\r\n        return this.wrappedInstance\r\n      }\r\n      getChildContext() {\r\n        return {id: this.id}\r\n      }\r\n      componentWillReceiveProps(nextProps) {\r\n        const nextName = getPropNames(nextProps.withName)\r\n        const currentName = getPropNames(this.props.withName)\r\n        if (JSON.stringify(nextName) !== JSON.stringify(currentName)) {\r\n          MirrorBackend.updateStore(this.id, {\r\n            requesting: ['$state', '$props'],\r\n            identifiers: [...name, ...nextName, Mirror.__COMPONENT_IDENTIFIER__],\r\n            metadata: {instance: this}\r\n          })\r\n        }\r\n        this.onReceivedProps(nextProps)\r\n      }\r\n      shouldComponentUpdate(nextProps, nextState) {\r\n        return nextState.updateCount > this.state.updateCount\r\n      }\r\n      componentWillUnmount() {\r\n        this._unmounted = true\r\n        MirrorBackend.removeStore(this.id)\r\n      }\r\n      render() {\r\n        if (this.state.updateCount === 0 && state) {\r\n          return null\r\n        }\r\n\r\n        const props = {\r\n          ...this.state.propsState,\r\n          dispatch: this.dispatch\r\n        }\r\n        if (!stateless) props.ref = ref => (this.wrappedInstance = ref)\r\n\r\n        return React.createElement(WrappedComponent, props)\r\n      }\r\n    }\r\n\r\n    Mirror.displayName = `Mirror(${_name})`\r\n    Mirror.contextTypes = {id() {}}\r\n    Mirror.childContextTypes = {id() {}}\r\n    Mirror.__COMPONENT_IDENTIFIER__ = Mirror\r\n\r\n    const createStaticCursors = () => {\r\n      delete Mirror.mirror\r\n      delete Mirror.dispatch\r\n      if (Mirror !== Mirror.__COMPONENT_IDENTIFIER__) {\r\n        Mirror.mirror = Mirror.__COMPONENT_IDENTIFIER__.mirror\r\n        Mirror.dispatch = Mirror.__COMPONENT_IDENTIFIER__.dispatch\r\n        return\r\n      }\r\n\r\n      const {mirror, dispatch} = MirrorBackend.addStore(null, {\r\n        identifiers: ['MIRROR/static', `MIRROR/static/${_name}`],\r\n        requesting: ['$props', '$state'],\r\n        metadata: {\r\n          static: Mirror\r\n        }\r\n      })\r\n\r\n      Object.assign(Mirror, {\r\n        mirror: mirror.all(Mirror),\r\n        dispatch: dispatch.all(Mirror)\r\n      })\r\n    }\r\n\r\n    Object.defineProperties(Mirror, {\r\n      mirror: {get: () => (createStaticCursors(), Mirror.mirror), configurable: true},\r\n      dispatch: {get: () => (createStaticCursors(), Mirror.dispatch), configurable: true}\r\n    })\r\n\r\n    Mirror.__WITH_NAME_CACHE__ = Mirror.__COMPONENT_IDENTIFIER__.__WITH_NAME_CACHE__ || {}\r\n\r\n    Mirror.withName = function withName(...withName) {\r\n      withName = name.concat(...withName)\r\n      const key = JSON.stringify(withName.sort())\r\n      const cachedComponent = Mirror.__WITH_NAME_CACHE__[key]\r\n      if (cachedComponent) return cachedComponent\r\n\r\n      const renamedComponent = createMirrorDecorator({\r\n        ...config,\r\n        name: withName\r\n      })(WrappedComponent)\r\n      renamedComponent.__COMPONENT_IDENTIFIER__ = Mirror.__COMPONENT_IDENTIFIER__\r\n      if (withName.length) Mirror.__WITH_NAME_CACHE__[key] = renamedComponent\r\n      return renamedComponent\r\n    }\r\n\r\n    return Mirror\r\n  }\r\n}\r\n\r\nexport default createMirrorDecorator\r\n","const isAction = action => {\r\n  if (\r\n    action &&\r\n    typeof action.type === 'string' &&\r\n    action.hasOwnProperty('payload') &&\r\n    typeof action.store === 'string'\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst findAction = args => {\r\n  let i = args.length\r\n  while (i--) {\r\n    if (isAction(args[i])) return args[i]\r\n    if (args[i] && isAction(args[i].action)) return args[i].action\r\n  }\r\n  return null\r\n}\r\n\r\nconst handleActions = (handlers, initialState) => (...args) => {\r\n  let action = findAction(args)\r\n  const state = args[0] === undefined ? initialState : args[0]\r\n\r\n  if (!action || !handlers[action.type]) return state\r\n  if (initialState !== undefined) return handlers[action.type](state, action)\r\n  return handlers[action.type](action)\r\n}\r\n\r\nexport default handleActions\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport Enum from '../Enum'\r\n\r\nconst combineEnums = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  invariant(\r\n    streams.every($stream => $stream && $stream.subscribe),\r\n    '`combineEnums` only accepts streams'\r\n  )\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        result[key] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combineEnums\r\n","import invariant from 'invariant'\r\n\r\nconst combineEventsWithDefault = (eventStream, otherStream) => {\r\n  otherStream = otherStream.scan(([, before], after) => [before, after], []).multicast()\r\n  return otherStream\r\n    .sample(\r\n      (event, [before, after]) => ({before, event, after}),\r\n      eventStream,\r\n      otherStream\r\n    )\r\n    .skipRepeatsWith((a, b) => a.event === b.event)\r\n}\r\n\r\nconst combineEventsWithBefore = (eventStream, otherStream) => {\r\n  return eventStream.sample(\r\n    (event, other) => ({before: other, event}),\r\n    eventStream,\r\n    otherStream\r\n  )\r\n}\r\n\r\nconst combineEventsWithAfter = (eventStream, otherStream) => {\r\n  return combineEventsWithDefault(eventStream, otherStream).map(value => {\r\n    delete value.before\r\n    return value\r\n  })\r\n}\r\n\r\nconst combineEventsWithNothing = eventStream => {\r\n  return eventStream.map(event => ({event}))\r\n}\r\n\r\nconst combineEventsWith = (\r\n  eventStream,\r\n  otherStream,\r\n  options = {before: true, after: true}\r\n) => {\r\n  invariant(\r\n    eventStream && otherStream && eventStream.subscribe && otherStream.subscribe,\r\n    '`combineEventsWith` only accepts streams'\r\n  )\r\n  if (options.before && options.after) {\r\n    return combineEventsWithDefault(eventStream, otherStream)\r\n  } else if (options.before) {\r\n    return combineEventsWithBefore(eventStream, otherStream)\r\n  } else if (options.after) {\r\n    return combineEventsWithAfter(eventStream, otherStream)\r\n  }\r\n\r\n  return combineEventsWithNothing(eventStream)\r\n}\r\n\r\nexport default combineEventsWith\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport Enum from '../Enum'\r\n\r\nconst combineNested = streamMap => {\r\n  const keys = Object.keys(streamMap)\r\n  const streams = keys.map(key => streamMap[key])\r\n  invariant(\r\n    streams.every($stream => $stream && $stream.subscribe),\r\n    '`combineNested` only accepts streams'\r\n  )\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        if (!result[key]) result[key] = {}\r\n        result[key][keys[i]] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combineNested\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\n\r\nconst combine = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  invariant(\r\n    streams.every($stream => $stream && $stream.subscribe),\r\n    '`combine` only accepts streams'\r\n  )\r\n  return most.combineArray((...values) => [...values], streams)\r\n}\r\n\r\nexport default combine\r\n","import 'regenerator-runtime/runtime'\r\nimport MirrorBackend from './backend'\r\nimport Mirror from './bindings'\r\nimport Enum from './utils/Enum'\r\nimport handleActions from './utils/handleActions'\r\nimport shallowEqual from './utils/shallowEqual'\r\nimport combineEnums from './utils/streams/combineEnums'\r\nimport combineEventsWith from './utils/streams/combineEventsWith'\r\nimport combineNested from './utils/streams/combineNested'\r\nimport combine from './utils/streams/combine'\r\n\r\nconst {addStore, removeStore, updateStore, query, root, stores} = MirrorBackend\r\n\r\nexport {addStore, removeStore, updateStore, query, root, stores}\r\nexport {handleActions, Enum, shallowEqual}\r\nexport {combineEnums, combineEventsWith, combineNested, combine}\r\nexport default Mirror\r\n"],"names":["traverse","tree","onVisit","q","length","node","shift","push","Object","values","children","getChildren","getParents","parents","parent","testFilter","filter","id","identifiers","includes","runQuery","originIds","query","operator","op","originNodes","result","map","getMatches","matches","slice","maxStores","concat","Array","from","Set","createCursorBackend","prevTree","origin","results","queries","createCursorAPI","enhancer","cursorMethods","newQuery","Infinity","__COMPONENT_IDENTIFIER__","ALPHABET","counter","generateStoreId","i","unshift","char","join","couldBeStoreId","RegExp","prototype","test","bind","MulticastDisposable","source","sink","disposed","remaining","remove","_dispose","tryEvent","t","x","event","e","error","tryEnd","end","dispose","disposable","emptyDisposable","insertWhen","a","f","l","b","comparePriority","priority","MulticastSource","sinks","_disposable","scheduler","n","add","run","Promise","resolve","then","findIndex","time","value","s","err","Prioritise","multicast","stream","constructor","prioritise","Enum","obj","keys","key","defineProperty","fill","v","forEach","index","arr","every","find","some","reduce","prev","reduceRight","SKIP_TOKEN","combineValuesIntoEnum","streams","ids","most","$start","until","$stream","eventSource","eventGenerator","buffer","next","setResolve","reject","keyArrayEqual","keyArray","oldKeyArray","oldKeySet","undefined","has","filterUnchangedKeyArrays","loop","seed","isEqual","createMirrorBackend","root","storeMap","cursorBackend","createEventSource","onStoreUpdated","$storeUpdated","$queryResults","store","updateNode","path","updateStore","requesting","metadata","assign","$storeDeleted","ADD_STREAMS_ASYNC","mirror","cursor","streamName","queryIndex","queryTypes","queryResults","teardown","thru","stores","$stores","tails","startWith","deletedStores","switchLatest","dispatch","type","payload","retryIfSelectionEmpty","$actions","tap","take","observe","initialize","_streams","evt","backend","parentId","storeId","addStore","MirrorBackend","createScheduler","samplers","BUFFERING","_samplers","sampler","sampleWith","hasOwn","hasOwnProperty","shallowEqual","countA","countB","call","instantiseMapToProps","CALLED_ONCE","instantisedMapToProps","state","props","mapToProps","createMirrorDecorator","config","decorateWithMirror","WrappedComponent","name","pure","withName","Noop","_name","displayName","stateless","render","getPropNames","sort","Mirror","context","updateCount","onReceivedProps","$props","skipRepeatsWith","propsEqual","_props","$state","subscribe","stateEqual","_state","depth","$propsState","propsStateEqual","addStream","_propsState","propsState","_unmounted","setState","removeStream","wrappedInstance","nextProps","nextName","currentName","JSON","stringify","instance","nextState","removeStore","ref","React","createElement","Component","contextTypes","childContextTypes","createStaticCursors","all","defineProperties","get","configurable","__WITH_NAME_CACHE__","cachedComponent","renamedComponent","isAction","action","findAction","args","handleActions","handlers","initialState","combineEnums","enumCollection","combineEventsWithDefault","eventStream","otherStream","scan","after","before","sample","combineEventsWithBefore","other","combineEventsWithAfter","combineEventsWithNothing","combineEventsWith","options","combineNested","streamMap","combine"],"mappings":"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"}