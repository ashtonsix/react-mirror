{"version":3,"file":"index.js","sources":["src/cursor/cursor_naive.js","src/utils/createCursorAPI.js","src/utils/generateStoreId.js","src/utils/Enum.js","src/utils/streams/combine.js","src/utils/streams/eventSource.js","src/utils/streams/filterUnchanged.js","src/backend/backend.js","src/backend/index.js","src/utils/shallowEqual.js","src/bindings/react.js","src/utils/handleActions.js","src/utils/streams/combineActionsWith.js","src/utils/streams/combineNested.js","src/utils/streams/combineSimple.js","src/index.js"],"sourcesContent":["const traverse = (tree, onVisit) => {\r\n  const q = [tree]\r\n\r\n  while (q.length) {\r\n    const node = q.shift()\r\n    q.push(...Object.values(node.children))\r\n    onVisit(node)\r\n  }\r\n}\r\n\r\nconst getChildren = node => {\r\n  const children = []\r\n  traverse(node, node => children.push(node))\r\n  return children\r\n}\r\n\r\nconst getParents = node => {\r\n  const parents = []\r\n  while (node.parent) {\r\n    node = node.parent\r\n    parents.push(node)\r\n  }\r\n  return parents\r\n}\r\n\r\nconst testFilter = (node, filter) => {\r\n  if (\r\n    !filter ||\r\n    filter === node.id ||\r\n    filter === node.component ||\r\n    node.identifiers.includes(filter)\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst runQuery = (tree, originIds, query) => {\r\n  if (!query.length) return originIds\r\n\r\n  let operator\r\n  ;[operator, ...query] = query\r\n\r\n  if (operator.op === 'root') return runQuery(tree, [tree.id], query)\r\n\r\n  const originNodes = []\r\n  traverse(tree, node => {\r\n    if (originIds.includes(node.id)) {\r\n      originNodes.push(node)\r\n    }\r\n  })\r\n\r\n  const result = (() => {\r\n    let result = originNodes.map(node => {\r\n      const getMatches = operator.op === 'children' ? getChildren : getParents\r\n      let matches = getMatches(node)\r\n      matches = matches.filter(node => testFilter(node, operator.filter))\r\n      matches = matches.slice(0, operator.maxStores)\r\n      matches = matches.map(node => node.id)\r\n      return matches\r\n    })\r\n    result = [].concat(...result)\r\n    result = Array.from(new Set(result))\r\n    return result\r\n  })()\r\n\r\n  return runQuery(tree, result, query.slice(1))\r\n}\r\n\r\nconst createCursorBackend = () => {\r\n  let prevTree\r\n\r\n  return {\r\n    query(origin, query) {\r\n      return runQuery(prevTree, [origin], query)\r\n    },\r\n    updateNode(tree, op) {\r\n      prevTree = tree\r\n      const results = {}\r\n      traverse(tree, node => {\r\n        results[node.id] = node.queries.map(query => {\r\n          return runQuery(tree, [node.id], query)\r\n        })\r\n      })\r\n      return results\r\n    }\r\n  }\r\n}\r\n\r\nexport default createCursorBackend\r\n","const createCursorAPI = (enhancer, query = []) => {\r\n  const cursorMethods = {\r\n    root() {\r\n      query = [{op: 'root'}]\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    parents(filter = null, maxStores = Infinity) {\r\n      query = query.concat({op: 'parents', filter, maxStores})\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    children(filter = null, maxStores = Infinity) {\r\n      query = query.concat({op: 'children', filter, maxStores})\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    all(filter = null, maxStores = Infinity) {\r\n      query = [{op: 'root'}, {op: 'children', filter, maxStores}]\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    one(filter = null) {\r\n      query = [{op: 'root'}, {op: 'children', filter, maxStores: 1}]\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    parent(filter = null) {\r\n      query = query.concat({op: 'parents', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, query)\r\n    },\r\n    child(filter = null) {\r\n      query = query.concat({op: 'children', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, query)\r\n    }\r\n  }\r\n  return enhancer(cursorMethods, query)\r\n}\r\n\r\nexport default createCursorAPI\r\n","/*\r\n  Store ids should:\r\n\r\n    * Be easy to read / recognise\r\n    * Not conflict with filters\r\n    * Communicate how many components have been mounted during session\r\n*/\r\nconst ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\r\n\r\nconst counter = [0, -1]\r\n\r\nconst generateStoreId = () => {\r\n  for (let i = counter.length - 1; i >= 0; i--) {\r\n    if (counter[i] === 25) {\r\n      counter[i] = 0\r\n      if (!i) counter.unshift(0)\r\n    } else {\r\n      counter[i] += 1\r\n      break\r\n    }\r\n  }\r\n  return counter.map(char => ALPHABET[char]).join('')\r\n}\r\n\r\nexport const couldBeStoreId = RegExp.prototype.test.bind(/^[A-Z]{2,12}$/)\r\n\r\nexport default generateStoreId\r\n","class Enum extends Array {\r\n  constructor(obj) {\r\n    const keys = Object.keys(obj)\r\n    const values = keys.map(key => obj[key])\r\n    super(...values)\r\n    this.keys = keys\r\n    keys.forEach(key => (this[key] = obj[key]))\r\n  }\r\n  map(f) {\r\n    const obj = {}\r\n    this.forEach(function map(value, index, key, arr) {\r\n      obj[key] = f(value, index, key, arr)\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  filter(f) {\r\n    const obj = {}\r\n    this.forEach(function filter(value, index, key, arr) {\r\n      if (f(value, index, key, arr)) {\r\n        obj[key] = value\r\n      }\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  forEach(f) {\r\n    return super.forEach(function forEach(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  every(f) {\r\n    return super.every(function every(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  find(f) {\r\n    return super.find(function find(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  findIndex(f) {\r\n    return super.findIndex(function findIndex(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  some(f) {\r\n    return super.some(function some(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduce(f) {\r\n    return super.reduce(function reduce(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduceRight(f) {\r\n    return super.reduceRight(function reduceRight(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n}\r\n\r\nexport default Enum\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst combine = (...streams) => {\r\n  return most.combine((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        result[key] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, ...streams)\r\n}\r\n\r\nexport default combine\r\n","import * as most from 'most'\r\n\r\nconst eventSource = () => {\r\n  let syncBuffer = []\r\n  let push = event => syncBuffer.push(event)\r\n  function* eventGenerator() {\r\n    while (syncBuffer.length) {\r\n      yield Promise.resolve(syncBuffer.shift())\r\n    }\r\n    const setPush = resolve => (push = resolve)\r\n    while (true) {\r\n      yield new Promise(setPush)\r\n    }\r\n  }\r\n  return {\r\n    push: event => push(event),\r\n    end: () => eventGenerator.return(),\r\n    $stream: most.generate(eventGenerator)\r\n  }\r\n}\r\n\r\nexport default eventSource\r\n","const SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst filterUnchanged = (equalityCheck, $stream) => {\r\n  return $stream\r\n    .loop((prevValue, value) => {\r\n      const isEqual = equalityCheck(prevValue, value)\r\n      if (isEqual) return {seed: value, value: SKIP_TOKEN}\r\n      return {seed: value, value}\r\n    }, undefined)\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nconst keyArrayEqual = ({oldKeyArray, oldKeySet}, keyArray) => {\r\n  if (oldKeyArray === keyArray) return true\r\n\r\n  for (let i in keyArray) {\r\n    if (!oldKeySet.has(keyArray[i])) return false\r\n  }\r\n\r\n  return keyArray.length === oldKeyArray.length\r\n}\r\n\r\nexport const filterUnchangedKeyArrays = $stream => {\r\n  return $stream\r\n    .loop(\r\n      (seed, keyArray) => {\r\n        let isEqual = keyArrayEqual(seed, keyArray)\r\n        if (isEqual) return {seed, value: SKIP_TOKEN}\r\n        return {\r\n          seed: {oldKeyArray: keyArray, oldKeySet: new Set(keyArray)},\r\n          value: keyArray\r\n        }\r\n      },\r\n      {oldKeyArray: [], oldKeySet: new Set()}\r\n    )\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nexport default filterUnchanged\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport warning from 'warning'\r\nimport createCursorBackend from '../cursor'\r\nimport createCursorAPI from '../utils/createCursorAPI'\r\nimport generateStoreId, {couldBeStoreId} from '../utils/generateStoreId'\r\nimport combine from '../utils/streams/combine'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport {filterUnchangedKeyArrays} from '../utils/streams/filterUnchanged'\r\n\r\nconst createMirrorBackend = () => {\r\n  let root\r\n  const storeMap = {}\r\n  const cursorBackend = createCursorBackend()\r\n\r\n  const {push: onStoreUpdated, $stream: $storeUpdated} = createEventSource()\r\n\r\n  const $queryResults = $storeUpdated.map(({store, op}) => {\r\n    return cursorBackend.updateNode(root, {path: store.path, op})\r\n  })\r\n\r\n  const updateStore = (\r\n    store,\r\n    {requesting = [], streams, identifiers = [], metadata = {}}\r\n  ) => {\r\n    Object.assign(store, {identifiers, metadata})\r\n\r\n    invariant(\r\n      !identifiers.some(couldBeStoreId),\r\n      'Identifiers cannot conflict with store IDs (all uppercase & alphabetical) %s',\r\n      JSON.stringify(identifiers.filter(couldBeStoreId))\r\n    )\r\n\r\n    const $storeDeleted = $queryResults.filter(() => !storeMap[store.id])\r\n\r\n    let ADD_STREAMS_ASYNC\r\n\r\n    store.mirror = createCursorAPI((cursorMethods, query) => {\r\n      const cursor = {}\r\n      requesting.concat('$actions').forEach(streamName => {\r\n        Object.defineProperty(cursor, streamName, {\r\n          get() {\r\n            const queryIndex = store.queries.length\r\n            store.queries.push(query)\r\n            if (ADD_STREAMS_ASYNC) {\r\n              onStoreUpdated({store, op: 'update'})\r\n            }\r\n\r\n            // TODO: startWith last value emitted\r\n            return $queryResults\r\n              .map(queryResults => {\r\n                return queryResults[store.id] ? queryResults[store.id][queryIndex] : []\r\n              })\r\n              .thru(filterUnchangedKeyArrays)\r\n              .map(stores => {\r\n                return (streamName === '$actions' ? most.mergeArray : combine)(\r\n                  stores\r\n                    .map(id => {\r\n                      if (id === store.id && query.length && streamName === '$state') {\r\n                        return undefined\r\n                      }\r\n                      return storeMap[id] && storeMap[id].streams[streamName]\r\n                    })\r\n                    .filter(s => s)\r\n                )\r\n              })\r\n              .switchLatest()\r\n          }\r\n        })\r\n      })\r\n      Object.defineProperty(cursor, '$stores', {\r\n        get() {\r\n          return $queryResults\r\n            .map(() => ({\r\n              cursor: cursorBackend.query(store.id, query),\r\n              store\r\n            }))\r\n            .until($storeDeleted)\r\n        }\r\n      })\r\n      Object.assign(cursor, cursorMethods)\r\n      return cursor\r\n    })\r\n\r\n    store.dispatch = createCursorAPI((cursorMethods, query) => {\r\n      const dispatch = (type, payload, retryIfSelectionEmpty = true) => {\r\n        invariant(\r\n          storeMap[store.id],\r\n          \"dispatching from a store that doesn't exist, hasn't been added yet, or was removed [%s]\",\r\n          store.id\r\n        )\r\n        const stores = cursorBackend.query(store.id, query)\r\n        if (stores.length || !retryIfSelectionEmpty) {\r\n          stores.forEach(id => {\r\n            storeMap[id] && storeMap[id].streams.$actions.push({type, payload, store: id})\r\n          })\r\n          return\r\n        }\r\n\r\n        $queryResults\r\n          .until(\r\n            $storeDeleted.tap(() => {\r\n              warning(\r\n                false,\r\n                \"No stores matched dispatch query. While waiting for a match the store which dispatched the action unmounted, so we've had to discard the action. You could try dispatching to an action proxy? [%s]\",\r\n                JSON.stringify({type, payload})\r\n              )\r\n            })\r\n          )\r\n          .map(() => cursorBackend.query(store.id, query))\r\n          .filter(stores => stores.length)\r\n          .take(1)\r\n          .observe(stores => {\r\n            stores.forEach(id => {\r\n              if (storeMap[id]) {\r\n                storeMap[id].streams.$actions.push({type, payload, store: id})\r\n              }\r\n            })\r\n          })\r\n      }\r\n      Object.assign(dispatch, cursorMethods)\r\n      return dispatch\r\n    })\r\n\r\n    if (!store.streams.$actions) {\r\n      const {push: dispatch, $stream: $actions} = createEventSource()\r\n      store.streams.$actions = $actions.until($storeDeleted)\r\n      store.streams.$actions.push = dispatch\r\n    }\r\n\r\n    if (streams) {\r\n      const $actions = store.streams.$actions\r\n      store.streams = streams(store.mirror, store.dispatch)\r\n      store.streams.$actions = $actions\r\n    }\r\n\r\n    ADD_STREAMS_ASYNC = true\r\n  }\r\n\r\n  const backend = {\r\n    addStore(parentId, {requesting, streams, identifiers, metadata}) {\r\n      if (!parentId) parentId = root && root.id\r\n      const parent = storeMap[parentId]\r\n      invariant(parent || !root, 'Cannot add store: parent not found [%s]', parentId)\r\n\r\n      const store = {\r\n        id: generateStoreId(),\r\n        path: root ? parent.path.concat(parentId) : [],\r\n        streams: {},\r\n        queries: [],\r\n        children: {},\r\n        parent\r\n      }\r\n\r\n      if (store.parent) store.parent.children[store.id] = store\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      storeMap[store.id] = store\r\n      onStoreUpdated({store, op: 'add'})\r\n      store.dispatch('INITIALIZE')\r\n\r\n      return store\r\n    },\r\n    removeStore(storeId) {\r\n      const store = storeMap[storeId]\r\n      invariant(store, \"Trying to remove store that doesn't exist [%s]\", storeId)\r\n      invariant(store !== root, 'Cannot remove root store')\r\n\r\n      const traverse = store => {\r\n        store.children.forEach(traverse)\r\n        // TODO: test dispatch in response to TEARDOWN\r\n        store.dispatch('TEARDOWN')\r\n        delete storeMap[store.id]\r\n        onStoreUpdated({store, op: 'remove'})\r\n      }\r\n      traverse(store)\r\n\r\n      if (store && store.parent) {\r\n        delete store.parent.children[storeId]\r\n      }\r\n    },\r\n    updateStore(storeId, {requesting, streams, identifiers, metadata}) {\r\n      const store = storeMap[storeId]\r\n      invariant(store, 'Trying to update store that does not exist [%s]', storeId)\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      onStoreUpdated({store, op: 'update'})\r\n\r\n      return store\r\n    }\r\n  }\r\n\r\n  root = backend.addStore(null, {identifiers: ['MIRROR/root'], metadata: {root: true}})\r\n\r\n  return backend\r\n}\r\n\r\nexport default createMirrorBackend\r\n","import createMirrorBackend from './backend'\r\n\r\nconst MirrorBackend = createMirrorBackend()\r\n\r\nexport default MirrorBackend\r\n","const hasOwn = Object.prototype.hasOwnProperty\r\n\r\nconst shallowEqual = (a, b) => {\r\n  if (a === b) return true\r\n\r\n  let countA = 0\r\n  let countB = 0\r\n\r\n  for (let key in a) {\r\n    if (hasOwn.call(a, key) && a[key] !== b[key]) return false\r\n    countA++\r\n  }\r\n\r\n  for (let key in b) {\r\n    if (hasOwn.call(b, key)) countB++\r\n  }\r\n\r\n  return countA === countB\r\n}\r\n\r\nexport default shallowEqual\r\n","import * as most from 'most'\r\nimport React from 'react'\r\nimport warning from 'warning'\r\nimport MirrorBackend from '../backend'\r\nimport shallowEqual from '../utils/shallowEqual'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport filterUnchanged from '../utils/streams/filterUnchanged'\r\n\r\nconst instantiseMapToProps = mapToProps => {\r\n  let CALLED_ONCE\r\n  const instantisedMapToProps = (state, props) => {\r\n    let result = mapToProps(state, props)\r\n    if (!CALLED_ONCE && typeof result === 'function') {\r\n      mapToProps = result\r\n      result = mapToProps(state, props)\r\n    }\r\n    CALLED_ONCE = true\r\n    return result\r\n  }\r\n  return instantisedMapToProps\r\n}\r\n\r\nfunction createMirrorDecorator(config = {}) {\r\n  return function decorateWithMirror(WrappedComponent) {\r\n    let {name = [], state, mapToProps, pure} = config\r\n    if (!(name instanceof Array)) name = [name]\r\n    if (typeof mapToProps !== 'function') {\r\n      mapToProps = (state, props) => ({...props, ...state})\r\n    }\r\n    if (!pure) pure = {propsEqual() {}, stateEqual() {}, propsStateEqual() {}}\r\n    if (pure === true) pure = {}\r\n    Object.assign(\r\n      {\r\n        propsEqual: shallowEqual,\r\n        shallowEqual: shallowEqual,\r\n        propsStateEqual: shallowEqual\r\n      },\r\n      pure\r\n    )\r\n\r\n    if (!WrappedComponent) {\r\n      WrappedComponent = function Noop() {\r\n        return null\r\n      }\r\n    }\r\n\r\n    class Mirror extends React.Component {\r\n      constructor(props, context) {\r\n        super()\r\n        this.state = {updateCount: 0, props: undefined}\r\n\r\n        let {\r\n          push: onReceivedProps,\r\n          end: endReceivedPropsEventSource,\r\n          $stream: $props\r\n        } = createEventSource()\r\n        Object.assign(this, {onReceivedProps, endReceivedPropsEventSource})\r\n        const $stateEnd = most.fromPromise(\r\n          new Promise(resolve => (this.onStateEnd = resolve))\r\n        )\r\n\r\n        const {id, mirror, dispatch, streams} = MirrorBackend.addStore(context.id, {\r\n          requesting: ['$state', '$props'],\r\n          identifiers: [...name, Mirror.__COMPONENT_IDENTIFIER__],\r\n          streams: (mirror, dispatch) => {\r\n            $props = filterUnchanged(pure.propsEqual.bind(this), $props.startWith(props))\r\n            let $state = state && state.call(this, mirror, dispatch)\r\n            warning(\r\n              !state || ($state && $state.subscribe),\r\n              'state should return a stream, did you forget a \"return\" statement? %s',\r\n              JSON.stringify(name)\r\n            )\r\n            if (!state || !$state) return {$props}\r\n            $state = filterUnchanged(pure.stateEqual.bind(this), $state)\r\n              .skipWhile(state => state === undefined)\r\n              .until($stateEnd)\r\n            return {$state, $props}\r\n          },\r\n          metadata: {\r\n            instance: this\r\n          }\r\n        })\r\n        Object.assign(this, {id, mirror, dispatch})\r\n\r\n        filterUnchanged(\r\n          pure.propsStateEqual.bind(this),\r\n          most.combine(\r\n            instantiseMapToProps(mapToProps).bind(this),\r\n            streams.$state,\r\n            streams.$props\r\n          )\r\n        ).observe(propsState => {\r\n          this.setState(({updateCount}) => ({updateCount: updateCount + 1, propsState}))\r\n        })\r\n      }\r\n      getWrappedInstance() {\r\n        return this.wrappedInstance\r\n      }\r\n      getChildContext() {\r\n        return {id: this.id}\r\n      }\r\n      componentWillReceiveProps(nextProps) {\r\n        this.onReceivedProps(nextProps)\r\n      }\r\n      shouldComponentUpdate(nextProps, nextState) {\r\n        return nextState.updateCount > this.state.updateCount\r\n      }\r\n      componentWillUnmount() {\r\n        this.endReceivedPropsEventSource()\r\n        this.onStateEnd()\r\n        MirrorBackend.removeStore(this.id)\r\n      }\r\n      render() {\r\n        if (this.state.updateCount === 0 && state) {\r\n          return null\r\n        }\r\n\r\n        return React.createElement(WrappedComponent, {\r\n          ...this.state.propsState,\r\n          ref: ref => (this.wrappedInstance = ref),\r\n          dispatch: this.dispatch\r\n        })\r\n      }\r\n    }\r\n\r\n    const _name = WrappedComponent.displayName || WrappedComponent.name || 'Component'\r\n    Mirror.displayName = `Mirror(${_name})`\r\n    Mirror.contextTypes = {id() {}}\r\n    Mirror.childContextTypes = {id() {}}\r\n    Mirror.__COMPONENT_IDENTIFIER__ = Mirror\r\n\r\n    const createStaticCursors = () => {\r\n      delete Mirror.mirror\r\n      delete Mirror.dispatch\r\n      if (Mirror !== Mirror.__COMPONENT_IDENTIFIER__) {\r\n        Mirror.mirror = Mirror.__COMPONENT_IDENTIFIER__.mirror\r\n        Mirror.dispatch = Mirror.__COMPONENT_IDENTIFIER__.dispatch\r\n        return\r\n      }\r\n\r\n      const {mirror, dispatch} = MirrorBackend.addStore(null, {\r\n        identifiers: ['MIRROR/static', `MIRROR/static/${_name}`],\r\n        metadata: {\r\n          static: Mirror\r\n        }\r\n      })\r\n\r\n      Object.assign(Mirror, {\r\n        mirror: mirror.all(Mirror),\r\n        dispatch: dispatch.all(Mirror)\r\n      })\r\n    }\r\n\r\n    Object.defineProperties(Mirror, {\r\n      mirror: {get: () => (createStaticCursors(), Mirror.mirror)},\r\n      dispatch: {get: () => (createStaticCursors(), Mirror.dispatch)}\r\n    })\r\n\r\n    Mirror.__WITH_NAME_CACHE__ = {}\r\n    const withNameCache = Mirror.__COMPONENT_IDENTIFIER__.__WITH_NAME_CACHE__\r\n    Mirror.withName = function withName(...withName) {\r\n      withName = [].concat(...withName, ...name).sort()\r\n      const key = JSON.stringify(name) // TODO: support non-string names\r\n      if (withNameCache[key]) return withNameCache[key]\r\n\r\n      const renamedComponent = createMirrorDecorator({...config, name})(WrappedComponent)\r\n      renamedComponent.__COMPONENT_IDENTIFIER__ = Mirror.__COMPONENT_IDENTIFIER__\r\n      withNameCache[key] = renamedComponent\r\n      return renamedComponent\r\n    }\r\n\r\n    return Mirror\r\n  }\r\n}\r\n\r\nexport default createMirrorDecorator\r\n","const isAction = action => {\r\n  if (\r\n    action &&\r\n    typeof action.type === 'string' &&\r\n    action.hasOwnProperty('payload') &&\r\n    typeof action.store === 'string'\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst findAction = args => {\r\n  let i = args.length\r\n  while (i--) {\r\n    if (isAction(args[i])) return args[i]\r\n    if (args[i] && isAction(args[i].action)) return args[i].action\r\n  }\r\n  return null\r\n}\r\n\r\nconst handleActions = (handlers, initialState) => (...args) => {\r\n  let action = findAction(args)\r\n  const state = args[0] === undefined ? initialState : args[0]\r\n\r\n  if (!action || !handlers[action.type]) return state\r\n  if (initialState) return handlers[action.type](state, action)\r\n  return handlers[action.type](action)\r\n}\r\n\r\nexport default handleActions\r\n","import * as most from 'most'\r\n\r\nconst SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst combineActionsWithDefault = (actionStream, otherStream) => {\r\n  return most\r\n    .combine((action, other) => ({action, other}))\r\n    .loop(\r\n      ({prevAction, before}, {action, other: after}) => ({\r\n        seed: {\r\n          prevAction: action,\r\n          before: prevAction === action ? SKIP_TOKEN : after\r\n        },\r\n        value: before === SKIP_TOKEN ? {before, action, after} : SKIP_TOKEN\r\n      }),\r\n      {}\r\n    )\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nconst combineActionsWithBefore = (actionStream, otherStream) => {\r\n  return actionStream.sample((action, other) => ({before: other, action}), otherStream)\r\n}\r\n\r\nconst combineActionsWithAfter = (actionStream, otherStream) => {\r\n  return combineActionsWithDefault(actionStream, otherStream).map(value => {\r\n    delete value.before\r\n    return value\r\n  })\r\n}\r\n\r\nconst combineActionsWithNothing = actionStream => {\r\n  return actionStream.map(action => ({action}))\r\n}\r\n\r\nconst combineActionsWith = (\r\n  actionStream,\r\n  otherStream,\r\n  options = {before: true, after: true}\r\n) => {\r\n  if (options.before && options.after) {\r\n    return combineActionsWithDefault(actionStream, otherStream)\r\n  } else if (options.before) {\r\n    return combineActionsWithBefore(actionStream, otherStream)\r\n  } else if (options.after) {\r\n    return combineActionsWithAfter(actionStream, otherStream)\r\n  }\r\n\r\n  return combineActionsWithNothing(actionStream)\r\n}\r\n\r\nexport default combineActionsWith\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst combineNested = streamMap => {\r\n  const keys = Object.keys(streamMap)\r\n  const streams = keys.map(key => streamMap[key])\r\n  return most.combine((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        if (!result[key]) result[key] = result[key]\r\n        result[key][keys[i]] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, ...streams)\r\n}\r\n\r\nexport default combineNested\r\n","import * as most from 'most'\r\n\r\nconst combineSimple = (...streams) => most.combineArray(values => [...values], streams)\r\n\r\nexport default combineSimple\r\n","import 'regenerator-runtime/runtime'\r\nimport MirrorBackend from './backend'\r\nimport Mirror from './bindings'\r\nimport Enum from './utils/Enum'\r\nimport handleActions from './utils/handleActions'\r\nimport shallowEqual from './utils/shallowEqual'\r\nimport combine from './utils/streams/combine'\r\nimport combineActionsWith from './utils/streams/combineActionsWith'\r\nimport combineNested from './utils/streams/combineNested'\r\nimport combineSimple from './utils/streams/combineSimple'\r\nimport filterUnchanged from './utils/streams/filterUnchanged'\r\n\r\nconst {addStore, removeStore, updateStore} = MirrorBackend\r\n\r\nexport {addStore, removeStore, updateStore}\r\nexport {handleActions, Enum, shallowEqual}\r\nexport {combine, combineActionsWith, combineNested, combineSimple, filterUnchanged}\r\nexport default Mirror\r\n"],"names":["traverse","tree","onVisit","q","length","node","shift","push","Object","values","children","getChildren","getParents","parents","parent","testFilter","filter","id","component","identifiers","includes","runQuery","originIds","query","operator","op","originNodes","result","map","getMatches","matches","slice","maxStores","concat","Array","from","Set","createCursorBackend","prevTree","origin","results","queries","createCursorAPI","enhancer","cursorMethods","Infinity","ALPHABET","counter","generateStoreId","i","unshift","char","join","couldBeStoreId","RegExp","prototype","test","bind","Enum","obj","keys","key","forEach","f","value","index","arr","every","find","findIndex","some","reduce","prev","reduceRight","combine","streams","most","enumCollection","eventSource","eventGenerator","syncBuffer","event","Promise","resolve","setPush","return","SKIP_TOKEN","filterUnchanged","equalityCheck","$stream","loop","prevValue","isEqual","seed","undefined","keyArrayEqual","keyArray","oldKeyArray","oldKeySet","has","filterUnchangedKeyArrays","createMirrorBackend","root","storeMap","cursorBackend","createEventSource","onStoreUpdated","$storeUpdated","$queryResults","store","updateNode","path","updateStore","requesting","metadata","assign","JSON","stringify","$storeDeleted","ADD_STREAMS_ASYNC","mirror","cursor","defineProperty","streamName","queryIndex","queryResults","thru","stores","s","switchLatest","until","dispatch","type","payload","retryIfSelectionEmpty","$actions","tap","take","observe","backend","parentId","storeId","addStore","MirrorBackend","hasOwn","hasOwnProperty","shallowEqual","a","b","countA","countB","call","instantiseMapToProps","CALLED_ONCE","instantisedMapToProps","state","props","mapToProps","createMirrorDecorator","config","decorateWithMirror","WrappedComponent","name","pure","Noop","Mirror","context","updateCount","onReceivedProps","endReceivedPropsEventSource","end","$props","$stateEnd","onStateEnd","__COMPONENT_IDENTIFIER__","propsEqual","startWith","$state","subscribe","stateEqual","skipWhile","propsStateEqual","setState","propsState","wrappedInstance","nextProps","nextState","removeStore","React","createElement","ref","Component","_name","displayName","contextTypes","childContextTypes","createStaticCursors","all","defineProperties","get","__WITH_NAME_CACHE__","withNameCache","withName","sort","renamedComponent","isAction","action","findAction","args","handleActions","handlers","initialState","combineActionsWithDefault","actionStream","otherStream","other","prevAction","before","after","combineActionsWithBefore","sample","combineActionsWithAfter","combineActionsWithNothing","combineActionsWith","options","combineNested","streamMap","combineSimple"],"mappings":"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"}