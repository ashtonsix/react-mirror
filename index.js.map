{"version":3,"file":"index.js","sources":["src/cursor/cursor_naive.js","src/utils/createCursorAPI.js","src/utils/generateStoreId.js","src/utils/Enum.js","src/utils/streams/combineEnum.js","src/utils/streams/eventSource.js","src/utils/streams/filterUnchanged.js","src/backend/backend.js","src/backend/index.js","src/utils/shallowEqual.js","src/bindings/react.js","src/utils/handleActions.js","src/utils/streams/combine.js","src/utils/streams/combineActionsWith.js","src/utils/streams/combineNested.js","src/utils/streams/combineSimple.js","src/index.js"],"sourcesContent":["const traverse = (tree, onVisit) => {\r\n  const q = [tree]\r\n\r\n  while (q.length) {\r\n    const node = q.shift()\r\n    q.push(...Object.values(node.children))\r\n    onVisit(node)\r\n  }\r\n}\r\n\r\nconst getChildren = node => {\r\n  const children = []\r\n  traverse(node, node => children.push(node))\r\n  return children\r\n}\r\n\r\nconst getParents = node => {\r\n  const parents = []\r\n  while (node.parent) {\r\n    node = node.parent\r\n    parents.push(node)\r\n  }\r\n  return parents\r\n}\r\n\r\nconst testFilter = (node, filter) => {\r\n  if (\r\n    !filter ||\r\n    filter === node.id ||\r\n    filter === node.component ||\r\n    node.identifiers.includes(filter)\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst runQuery = (tree, originIds, query) => {\r\n  if (!query.length) return originIds\r\n\r\n  let operator\r\n  ;[operator, ...query] = query\r\n\r\n  if (operator.op === 'root') return runQuery(tree, [tree.id], query)\r\n\r\n  const originNodes = []\r\n  traverse(tree, node => {\r\n    if (originIds.includes(node.id)) {\r\n      originNodes.push(node)\r\n    }\r\n  })\r\n\r\n  const result = (() => {\r\n    let result = originNodes.map(node => {\r\n      const getMatches = operator.op === 'children' ? getChildren : getParents\r\n      let matches = getMatches(node)\r\n      matches = matches.filter(node => testFilter(node, operator.filter))\r\n      matches = matches.slice(0, operator.maxStores)\r\n      matches = matches.map(node => node.id)\r\n      return matches\r\n    })\r\n    result = [].concat(...result)\r\n    result = Array.from(new Set(result))\r\n    return result\r\n  })()\r\n\r\n  return runQuery(tree, result, query.slice(1))\r\n}\r\n\r\nconst createCursorBackend = () => {\r\n  let prevTree\r\n\r\n  return {\r\n    query(origin, query) {\r\n      return runQuery(prevTree, [origin], query)\r\n    },\r\n    updateNode(tree, op) {\r\n      prevTree = tree\r\n      const results = {}\r\n      traverse(tree, node => {\r\n        results[node.id] = node.queries.map(query => {\r\n          return runQuery(tree, [node.id], query)\r\n        })\r\n      })\r\n      return results\r\n    }\r\n  }\r\n}\r\n\r\nexport default createCursorBackend\r\n","const createCursorAPI = (enhancer, query = []) => {\r\n  const cursorMethods = {\r\n    root() {\r\n      const newQuery = [{op: 'root'}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    parents(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'parents', filter, maxStores})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    children(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'children', filter, maxStores})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    all(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = [{op: 'root'}, {op: 'children', filter, maxStores}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    one(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = [{op: 'root'}, {op: 'children', filter, maxStores: 1}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    parent(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'parents', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    child(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'children', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    }\r\n  }\r\n  return enhancer(cursorMethods, query)\r\n}\r\n\r\nexport default createCursorAPI\r\n","/*\r\n  Store ids should:\r\n\r\n    * Be easy to read / recognise\r\n    * Not conflict with filters\r\n    * Communicate how many components have been mounted during session\r\n*/\r\nconst ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\r\n\r\nconst counter = [0, -1]\r\n\r\nconst generateStoreId = () => {\r\n  for (let i = counter.length - 1; i >= 0; i--) {\r\n    if (counter[i] === 25) {\r\n      counter[i] = 0\r\n      if (!i) counter.unshift(0)\r\n    } else {\r\n      counter[i] += 1\r\n      break\r\n    }\r\n  }\r\n  return counter.map(char => ALPHABET[char]).join('')\r\n}\r\n\r\nexport const couldBeStoreId = RegExp.prototype.test.bind(/^[A-Z]{2,12}$/)\r\n\r\nexport default generateStoreId\r\n","class Enum extends Array {\r\n  constructor(obj = {}) {\r\n    const keys = Object.keys(obj)\r\n    const values = keys.map(key => obj[key])\r\n    super()\r\n    super.push(...values)\r\n    Object.defineProperty(this, 'keys', {value: keys})\r\n    keys.forEach(key => Object.defineProperty(this, key, {value: obj[key]}))\r\n  }\r\n  map(f) {\r\n    const obj = {}\r\n    this.forEach(function map(value, index, key, arr) {\r\n      obj[key] = f(value, index, key, arr)\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  filter(f) {\r\n    const obj = {}\r\n    this.forEach(function filter(value, index, key, arr) {\r\n      if (f(value, index, key, arr)) {\r\n        obj[key] = value\r\n      }\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  forEach(f) {\r\n    return super.forEach(function forEach(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  every(f) {\r\n    return super.every(function every(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  find(f) {\r\n    return super.find(function find(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  findIndex(f) {\r\n    return super.findIndex(function findIndex(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  some(f) {\r\n    return super.some(function some(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduce(f) {\r\n    return super.reduce(function reduce(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduceRight(f) {\r\n    return super.reduceRight(function reduceRight(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n}\r\n\r\nexport default Enum\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\n/*\r\n  Combines streams of normal values into a stream of Enums\r\n\r\n  Emits values immediately, w/o waiting for input streams to emit their first value\r\n*/\r\nconst combineEnum = (streams, ids) => {\r\n  if (!streams.length) return most.of(new Enum())\r\n  return most.combineArray(\r\n    (...values) => {\r\n      const result = {}\r\n      values.forEach((value, i) => {\r\n        if (value !== SKIP_TOKEN) result[ids[i]] = value\r\n      })\r\n      return new Enum(result)\r\n    },\r\n    streams.map($stream => {\r\n      const $start = most.of(SKIP_TOKEN).until($stream)\r\n      return $start.concat($stream)\r\n    })\r\n  )\r\n}\r\n\r\nexport default combineEnum\r\n","import * as most from 'most'\r\n\r\nconst eventSource = () => {\r\n  let buffer = []\r\n  let next\r\n  let push = event => {\r\n    if (next) {\r\n      next(event)\r\n      next = null\r\n    } else {\r\n      buffer.push(event)\r\n    }\r\n  }\r\n  const setResolve = (resolve, reject) => (next = resolve)\r\n  function* eventGenerator() {\r\n    while (true) {\r\n      if (buffer.length) yield Promise.resolve(buffer.shift())\r\n      else yield new Promise(setResolve)\r\n    }\r\n  }\r\n  return {\r\n    push,\r\n    $stream: most.generate(eventGenerator)\r\n  }\r\n}\r\n\r\nexport default eventSource\r\n","const SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst filterUnchanged = (equalityCheck, $stream) => {\r\n  return $stream\r\n    .loop((prevValue, value) => {\r\n      const isEqual = equalityCheck(prevValue, value)\r\n      if (isEqual) return {seed: value, value: SKIP_TOKEN}\r\n      return {seed: value, value}\r\n    }, undefined)\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nconst keyArrayEqual = ({oldKeyArray, oldKeySet}, keyArray) => {\r\n  if (oldKeyArray === keyArray) return true\r\n  if (oldKeyArray === undefined) return false\r\n\r\n  for (let i in keyArray) {\r\n    if (!oldKeySet.has(keyArray[i])) return false\r\n  }\r\n\r\n  return keyArray.length === oldKeyArray.length\r\n}\r\n\r\nexport const filterUnchangedKeyArrays = $stream => {\r\n  return $stream\r\n    .loop((seed, keyArray) => {\r\n      let isEqual = keyArrayEqual(seed, keyArray)\r\n      if (isEqual) return {seed, value: SKIP_TOKEN}\r\n      return {\r\n        seed: {oldKeyArray: keyArray, oldKeySet: new Set(keyArray)},\r\n        value: keyArray\r\n      }\r\n    }, {})\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nexport default filterUnchanged\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport warning from 'warning'\r\nimport createCursorBackend from '../cursor'\r\nimport createCursorAPI from '../utils/createCursorAPI'\r\nimport generateStoreId, {couldBeStoreId} from '../utils/generateStoreId'\r\nimport combineEnum from '../utils/streams/combineEnum'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport {filterUnchangedKeyArrays} from '../utils/streams/filterUnchanged'\r\n\r\nconst createMirrorBackend = () => {\r\n  let root\r\n  const storeMap = {}\r\n  const cursorBackend = createCursorBackend()\r\n\r\n  const {push: onStoreUpdated, $stream: $storeUpdated} = createEventSource()\r\n\r\n  const $queryResults = $storeUpdated\r\n    .map(({store, op}) => {\r\n      return cursorBackend.updateNode(root, {path: store.path, op})\r\n    })\r\n    .multicast()\r\n\r\n  const updateStore = (\r\n    store,\r\n    {requesting = [], streams, identifiers = [], metadata = {}}\r\n  ) => {\r\n    Object.assign(store, {identifiers, metadata})\r\n\r\n    invariant(\r\n      !identifiers.some(couldBeStoreId),\r\n      'Cannot use all-uppercase identifiers (\"%s\") because they could conflict with internally-used IDs',\r\n      identifiers.find(couldBeStoreId)\r\n    )\r\n\r\n    const $storeDeleted = $queryResults.filter(() => !storeMap[store.id])\r\n\r\n    let ADD_STREAMS_ASYNC\r\n\r\n    store.mirror = createCursorAPI((cursorMethods, query) => {\r\n      const cursor = {}\r\n      requesting.concat('$actions').forEach(streamName => {\r\n        Object.defineProperty(cursor, streamName, {\r\n          get() {\r\n            const queryIndex = store.queries.length\r\n            store.queries.push(query)\r\n            store.queryTypes.push(streamName)\r\n            store.queryResults.push([])\r\n            if (ADD_STREAMS_ASYNC) {\r\n              warning(\r\n                false,\r\n                'Accessing \"mirror.%s\" after a store has been added is ineffcient, you can batch queries with `updateStore` to improve performance',\r\n                streamName\r\n              )\r\n              onStoreUpdated({store, op: 'update'})\r\n            }\r\n\r\n            return $queryResults\r\n              .map(queryResults => {\r\n                return queryResults[store.id] ? queryResults[store.id][queryIndex] : []\r\n              })\r\n              .thru(filterUnchangedKeyArrays)\r\n              .map(stores => {\r\n                store.queryResults[queryIndex] = stores\r\n                return (streamName === '$actions' ? most.mergeArray : combineEnum)(\r\n                  stores\r\n                    .map(id => {\r\n                      if (id === store.id && query.length && streamName === '$state') {\r\n                        return undefined\r\n                      }\r\n                      let $stream = storeMap[id] && storeMap[id].streams[streamName]\r\n                      if ($stream && storeMap[id] && storeMap[id].tails[streamName]) {\r\n                        $stream = $stream.startWith(storeMap[id].tails[streamName])\r\n                      }\r\n                      return $stream\r\n                    })\r\n                    .filter(s => s),\r\n                  stores\r\n                )\r\n              })\r\n              .switchLatest()\r\n              .until($storeDeleted)\r\n          }\r\n        })\r\n      })\r\n      Object.defineProperty(cursor, '$stores', {\r\n        get() {\r\n          return $queryResults\r\n            .map(() => ({\r\n              cursor: cursorBackend.query(store.id, query),\r\n              store\r\n            }))\r\n            .until($storeDeleted)\r\n        }\r\n      })\r\n      Object.assign(cursor, cursorMethods)\r\n      return cursor\r\n    })\r\n\r\n    store.dispatch = createCursorAPI((cursorMethods, query) => {\r\n      const dispatch = (type, payload, retryIfSelectionEmpty = true) => {\r\n        invariant(\r\n          storeMap[store.id],\r\n          'Cannot dispatch actions (\"%s\") from a store (\"%s\") that does not exist',\r\n          type,\r\n          store.id\r\n        )\r\n        const stores = cursorBackend.query(store.id, query)\r\n        if (stores.length || !retryIfSelectionEmpty) {\r\n          stores.forEach(id => {\r\n            storeMap[id] && storeMap[id].streams.$actions.push({type, payload, store: id})\r\n          })\r\n          return\r\n        }\r\n\r\n        $queryResults\r\n          .until(\r\n            $storeDeleted.tap(() => {\r\n              warning(\r\n                false,\r\n                'No store matched an action (\"%s\"), & the dispatcher (\"%s\") was removed. We\\'ve discarded the action. You could try dispatching the action via a proxy.',\r\n                type,\r\n                store.id\r\n              )\r\n            })\r\n          )\r\n          .map(() => cursorBackend.query(store.id, query))\r\n          .filter(stores => stores.length)\r\n          .take(1)\r\n          .observe(stores => {\r\n            stores.forEach(id => {\r\n              if (storeMap[id]) {\r\n                storeMap[id].streams.$actions.push({type, payload, store: id})\r\n              }\r\n            })\r\n          })\r\n      }\r\n      Object.assign(dispatch, cursorMethods)\r\n      return dispatch\r\n    })\r\n\r\n    if (!store.streams.$actions) {\r\n      const {push: dispatch, $stream: $actions} = createEventSource()\r\n      store.streams.$actions = $actions.until($storeDeleted).multicast()\r\n      store.streams.$actions.push = dispatch\r\n    }\r\n\r\n    if (streams) {\r\n      const _streams = streams(store.mirror, store.dispatch)\r\n      Object.keys(_streams).forEach(streamName => {\r\n        _streams[streamName] = _streams[streamName]\r\n          .tap(evt => (store.tails[streamName] = evt))\r\n          .multicast()\r\n      })\r\n      store.streams = Object.assign(_streams, {\r\n        $actions: store.streams.$actions\r\n      })\r\n    }\r\n\r\n    ADD_STREAMS_ASYNC = true\r\n  }\r\n\r\n  const backend = {\r\n    addStore(parentId, {requesting, streams, identifiers, metadata}) {\r\n      if (!parentId) parentId = root && root.id\r\n      const parent = storeMap[parentId]\r\n      invariant(\r\n        parent || !root,\r\n        'Cannot add store as a child of \"%s\", because \"%s\" does not exist',\r\n        parentId,\r\n        parentId\r\n      )\r\n\r\n      const store = {\r\n        id: generateStoreId(),\r\n        path: root ? parent.path.concat(parentId) : [],\r\n        streams: {},\r\n        tails: {},\r\n        queries: [],\r\n        queryTypes: [],\r\n        queryResults: [],\r\n        children: {},\r\n        parent\r\n      }\r\n\r\n      if (store.parent) store.parent.children[store.id] = store\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      storeMap[store.id] = store\r\n      onStoreUpdated({store, op: 'add'})\r\n      store.dispatch('INITIALIZE')\r\n\r\n      return store\r\n    },\r\n    removeStore(storeId) {\r\n      const store = storeMap[storeId]\r\n      if (!store) return\r\n      invariant(store !== root, 'Cannot remove root store')\r\n\r\n      const traverse = store => {\r\n        Object.values(store.children).forEach(traverse)\r\n        store.dispatch('TEARDOWN')\r\n        delete storeMap[store.id]\r\n        onStoreUpdated({store, op: 'remove'})\r\n      }\r\n      traverse(store)\r\n\r\n      if (store && store.parent) {\r\n        delete store.parent.children[storeId]\r\n      }\r\n    },\r\n    updateStore(storeId, {requesting, streams, identifiers, metadata}) {\r\n      const store = storeMap[storeId]\r\n      invariant(store, 'Cannot update a store (\"%s\") that does not exist', storeId)\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      onStoreUpdated({store, op: 'update'})\r\n\r\n      return store\r\n    },\r\n    query: createCursorAPI((cursorMethods, query) => {\r\n      const runQuery = () => cursorBackend.query(root.id, query)\r\n      Object.assign(runQuery, cursorMethods)\r\n      return runQuery\r\n    }),\r\n    stores: storeMap\r\n  }\r\n\r\n  backend.root = root = backend.addStore(null, {\r\n    identifiers: ['MIRROR/root'],\r\n    metadata: {root: true}\r\n  })\r\n\r\n  return backend\r\n}\r\n\r\nexport default createMirrorBackend\r\n","import createMirrorBackend from './backend'\r\n\r\nconst MirrorBackend = createMirrorBackend()\r\n\r\nexport default MirrorBackend\r\n","const hasOwn = Object.prototype.hasOwnProperty\r\n\r\nconst shallowEqual = (a, b) => {\r\n  if (a === b) return true\r\n  if (typeof a !== 'object' || typeof b !== 'object' || !a !== !b) return false\r\n\r\n  let countA = 0\r\n  let countB = 0\r\n\r\n  for (let key in a) {\r\n    if (hasOwn.call(a, key) && a[key] !== b[key]) return false\r\n    countA++\r\n  }\r\n\r\n  for (let key in b) {\r\n    if (hasOwn.call(b, key)) countB++\r\n  }\r\n\r\n  return countA === countB\r\n}\r\n\r\nexport default shallowEqual\r\n","import * as most from 'most'\r\nimport React from 'react'\r\nimport warning from 'warning'\r\nimport invariant from 'invariant'\r\nimport MirrorBackend from '../backend'\r\nimport shallowEqual from '../utils/shallowEqual'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport filterUnchanged from '../utils/streams/filterUnchanged'\r\n\r\nconst instantiseMapToProps = mapToProps => {\r\n  let CALLED_ONCE\r\n  const instantisedMapToProps = (state, props) => {\r\n    let result = mapToProps(state, props)\r\n    if (!CALLED_ONCE && typeof result === 'function') {\r\n      mapToProps = result\r\n      result = mapToProps(state, props)\r\n    }\r\n    CALLED_ONCE = true\r\n    return result\r\n  }\r\n  return instantisedMapToProps\r\n}\r\n\r\nfunction createMirrorDecorator(config = {}) {\r\n  return function decorateWithMirror(WrappedComponent) {\r\n    let {name = [], state, mapToProps, pure = true} = config\r\n    if (!(name instanceof Array)) name = [name]\r\n    if (typeof mapToProps !== 'function') {\r\n      mapToProps = (state, props) => ({...props, ...state})\r\n    }\r\n    if (!pure) pure = {propsEqual() {}, stateEqual() {}, propsStateEqual() {}}\r\n    if (pure === true) pure = {}\r\n    pure = Object.assign(\r\n      {\r\n        propsEqual: shallowEqual,\r\n        stateEqual: shallowEqual,\r\n        propsStateEqual: shallowEqual\r\n      },\r\n      pure\r\n    )\r\n\r\n    if (!WrappedComponent) {\r\n      WrappedComponent = function Noop() {\r\n        return null\r\n      }\r\n    }\r\n    const _name = WrappedComponent.displayName || WrappedComponent.name || 'Component'\r\n    invariant(\r\n      name.every(name => typeof name === 'string'),\r\n      '`name` should be a string or array of strings (at \"%s\")',\r\n      _name\r\n    )\r\n\r\n    class Mirror extends React.Component {\r\n      constructor(props, context) {\r\n        super()\r\n        this.props = props\r\n        this.state = {updateCount: 0, props: undefined}\r\n\r\n        let {push: onReceivedProps, $stream: $props} = createEventSource()\r\n        Object.assign(this, {onReceivedProps})\r\n\r\n        const {id, mirror, dispatch, streams} = MirrorBackend.addStore(context.id, {\r\n          requesting: ['$state', '$props'],\r\n          identifiers: [...name, Mirror.__COMPONENT_IDENTIFIER__],\r\n          streams: (mirror, dispatch) => {\r\n            $props = filterUnchanged(pure.propsEqual.bind(this), $props.startWith(props))\r\n            let $state = state && state.call(this, mirror, dispatch)\r\n            warning(\r\n              !state || ($state && $state.subscribe),\r\n              '`state` should return a stream, did you forget a \"return\" statement? (at \"%s\")',\r\n              [_name].concat(name.filter(name => typeof name === 'string').join(', '))\r\n            )\r\n            if (!state || !$state) return {$props}\r\n            $state = filterUnchanged(pure.stateEqual.bind(this), $state).filter(\r\n              state => state !== undefined\r\n            )\r\n            return {$state, $props}\r\n          },\r\n          metadata: {\r\n            instance: this\r\n          }\r\n        })\r\n        Object.assign(this, {id, mirror, dispatch})\r\n\r\n        filterUnchanged(\r\n          pure.propsStateEqual.bind(this),\r\n          most.combine(\r\n            instantiseMapToProps(mapToProps).bind(this),\r\n            streams.$state,\r\n            streams.$props\r\n          )\r\n        ).observe(propsState => {\r\n          this.setState(({updateCount}) => ({updateCount: updateCount + 1, propsState}))\r\n        })\r\n      }\r\n      getWrappedInstance() {\r\n        return this.wrappedInstance\r\n      }\r\n      getChildContext() {\r\n        return {id: this.id}\r\n      }\r\n      componentWillReceiveProps(nextProps) {\r\n        this.onReceivedProps(nextProps)\r\n      }\r\n      shouldComponentUpdate(nextProps, nextState) {\r\n        return nextState.updateCount > this.state.updateCount\r\n      }\r\n      componentWillUnmount() {\r\n        MirrorBackend.removeStore(this.id)\r\n      }\r\n      render() {\r\n        if (this.state.updateCount === 0 && state) {\r\n          return null\r\n        }\r\n\r\n        return React.createElement(WrappedComponent, {\r\n          ...this.state.propsState,\r\n          ref: ref => (this.wrappedInstance = ref),\r\n          dispatch: this.dispatch\r\n        })\r\n      }\r\n    }\r\n\r\n    Mirror.displayName = `Mirror(${_name})`\r\n    Mirror.contextTypes = {id() {}}\r\n    Mirror.childContextTypes = {id() {}}\r\n    Mirror.__COMPONENT_IDENTIFIER__ = Mirror\r\n\r\n    const createStaticCursors = () => {\r\n      delete Mirror.mirror\r\n      delete Mirror.dispatch\r\n      if (Mirror !== Mirror.__COMPONENT_IDENTIFIER__) {\r\n        Mirror.mirror = Mirror.__COMPONENT_IDENTIFIER__.mirror\r\n        Mirror.dispatch = Mirror.__COMPONENT_IDENTIFIER__.dispatch\r\n        return\r\n      }\r\n\r\n      const {mirror, dispatch} = MirrorBackend.addStore(null, {\r\n        identifiers: ['MIRROR/static', `MIRROR/static/${_name}`],\r\n        metadata: {\r\n          static: Mirror\r\n        }\r\n      })\r\n\r\n      Object.assign(Mirror, {\r\n        mirror: mirror.all(Mirror),\r\n        dispatch: dispatch.all(Mirror)\r\n      })\r\n    }\r\n\r\n    Object.defineProperties(Mirror, {\r\n      mirror: {get: () => (createStaticCursors(), Mirror.mirror)},\r\n      dispatch: {get: () => (createStaticCursors(), Mirror.dispatch)}\r\n    })\r\n\r\n    Mirror.__WITH_NAME_CACHE__ = Mirror.__COMPONENT_IDENTIFIER__.__WITH_NAME_CACHE__ || {}\r\n\r\n    Mirror.withName = function withName(...withName) {\r\n      withName = name.concat(...withName)\r\n      const key = JSON.stringify(withName.sort())\r\n      const cachedComponent = Mirror.__WITH_NAME_CACHE__[key]\r\n      if (cachedComponent) return cachedComponent\r\n\r\n      const renamedComponent = createMirrorDecorator({\r\n        ...config,\r\n        name: withName\r\n      })(WrappedComponent)\r\n      renamedComponent.__COMPONENT_IDENTIFIER__ = Mirror.__COMPONENT_IDENTIFIER__\r\n      if (withName.length) Mirror.__WITH_NAME_CACHE__[key] = renamedComponent\r\n      return renamedComponent\r\n    }\r\n\r\n    return Mirror\r\n  }\r\n}\r\n\r\nexport default createMirrorDecorator\r\n","const isAction = action => {\r\n  if (\r\n    action &&\r\n    typeof action.type === 'string' &&\r\n    action.hasOwnProperty('payload') &&\r\n    typeof action.store === 'string'\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst findAction = args => {\r\n  let i = args.length\r\n  while (i--) {\r\n    if (isAction(args[i])) return args[i]\r\n    if (args[i] && isAction(args[i].action)) return args[i].action\r\n  }\r\n  return null\r\n}\r\n\r\nconst handleActions = (handlers, initialState) => (...args) => {\r\n  let action = findAction(args)\r\n  const state = args[0] === undefined ? initialState : args[0]\r\n\r\n  if (!action || !handlers[action.type]) return state\r\n  if (initialState !== undefined) return handlers[action.type](state, action)\r\n  return handlers[action.type](action)\r\n}\r\n\r\nexport default handleActions\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst combine = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        result[key] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combine\r\n","import * as most from 'most'\r\n\r\nconst SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst combineActionsWithDefault = (actionStream, otherStream) => {\r\n  return most\r\n    .combine((action, other) => ({action, other}))\r\n    .loop(\r\n      ({prevAction, before}, {action, other: after}) => ({\r\n        seed: {\r\n          prevAction: action,\r\n          before: prevAction === action ? SKIP_TOKEN : after\r\n        },\r\n        value: before === SKIP_TOKEN ? {before, action, after} : SKIP_TOKEN\r\n      }),\r\n      {}\r\n    )\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nconst combineActionsWithBefore = (actionStream, otherStream) => {\r\n  return actionStream.sample((action, other) => ({before: other, action}), otherStream)\r\n}\r\n\r\nconst combineActionsWithAfter = (actionStream, otherStream) => {\r\n  return combineActionsWithDefault(actionStream, otherStream).map(value => {\r\n    delete value.before\r\n    return value\r\n  })\r\n}\r\n\r\nconst combineActionsWithNothing = actionStream => {\r\n  return actionStream.map(action => ({action}))\r\n}\r\n\r\nconst combineActionsWith = (\r\n  actionStream,\r\n  otherStream,\r\n  options = {before: true, after: true}\r\n) => {\r\n  if (options.before && options.after) {\r\n    return combineActionsWithDefault(actionStream, otherStream)\r\n  } else if (options.before) {\r\n    return combineActionsWithBefore(actionStream, otherStream)\r\n  } else if (options.after) {\r\n    return combineActionsWithAfter(actionStream, otherStream)\r\n  }\r\n\r\n  return combineActionsWithNothing(actionStream)\r\n}\r\n\r\nexport default combineActionsWith\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst combineNested = streamMap => {\r\n  const keys = Object.keys(streamMap)\r\n  const streams = keys.map(key => streamMap[key])\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        if (!result[key]) result[key] = result[key]\r\n        result[key][keys[i]] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combineNested\r\n","import * as most from 'most'\r\n\r\nconst combineSimple = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  return most.combineArray((...values) => [...values], streams)\r\n}\r\n\r\nexport default combineSimple\r\n","import 'regenerator-runtime/runtime'\r\nimport MirrorBackend from './backend'\r\nimport Mirror from './bindings'\r\nimport Enum from './utils/Enum'\r\nimport handleActions from './utils/handleActions'\r\nimport shallowEqual from './utils/shallowEqual'\r\nimport combine from './utils/streams/combine'\r\nimport combineActionsWith from './utils/streams/combineActionsWith'\r\nimport combineNested from './utils/streams/combineNested'\r\nimport combineSimple from './utils/streams/combineSimple'\r\nimport filterUnchanged from './utils/streams/filterUnchanged'\r\n\r\nconst {addStore, removeStore, updateStore, query, root, stores} = MirrorBackend\r\n\r\nexport {addStore, removeStore, updateStore, query, root, stores}\r\nexport {handleActions, Enum, shallowEqual}\r\nexport {combine, combineActionsWith, combineNested, combineSimple, filterUnchanged}\r\nexport default Mirror\r\n"],"names":["traverse","tree","onVisit","q","length","node","shift","push","Object","values","children","getChildren","getParents","parents","parent","testFilter","filter","id","component","identifiers","includes","runQuery","originIds","query","operator","op","originNodes","result","map","getMatches","matches","slice","maxStores","concat","Array","from","Set","createCursorBackend","prevTree","origin","results","queries","createCursorAPI","enhancer","cursorMethods","newQuery","Infinity","__COMPONENT_IDENTIFIER__","ALPHABET","counter","generateStoreId","i","unshift","char","join","couldBeStoreId","RegExp","prototype","test","bind","Enum","obj","keys","key","defineProperty","value","forEach","f","index","arr","every","find","findIndex","some","reduce","prev","reduceRight","SKIP_TOKEN","combineEnum","streams","ids","most","$start","until","$stream","eventSource","eventGenerator","buffer","next","event","setResolve","resolve","reject","Promise","filterUnchanged","equalityCheck","loop","prevValue","isEqual","seed","undefined","keyArrayEqual","keyArray","oldKeyArray","oldKeySet","has","filterUnchangedKeyArrays","createMirrorBackend","root","storeMap","cursorBackend","createEventSource","onStoreUpdated","$storeUpdated","$queryResults","store","updateNode","path","multicast","updateStore","requesting","metadata","assign","$storeDeleted","ADD_STREAMS_ASYNC","mirror","cursor","streamName","queryIndex","queryTypes","queryResults","thru","stores","tails","startWith","s","switchLatest","dispatch","type","payload","retryIfSelectionEmpty","$actions","tap","take","observe","_streams","evt","backend","parentId","storeId","addStore","MirrorBackend","hasOwn","hasOwnProperty","shallowEqual","a","b","countA","countB","call","instantiseMapToProps","CALLED_ONCE","instantisedMapToProps","state","props","mapToProps","createMirrorDecorator","config","decorateWithMirror","WrappedComponent","name","pure","Noop","_name","displayName","Mirror","context","updateCount","onReceivedProps","$props","propsEqual","$state","subscribe","stateEqual","propsStateEqual","setState","propsState","wrappedInstance","nextProps","nextState","removeStore","React","createElement","ref","Component","contextTypes","childContextTypes","createStaticCursors","all","defineProperties","get","__WITH_NAME_CACHE__","withName","JSON","stringify","sort","cachedComponent","renamedComponent","isAction","action","findAction","args","handleActions","handlers","initialState","combine","enumCollection","combineActionsWithDefault","actionStream","otherStream","other","prevAction","before","after","combineActionsWithBefore","sample","combineActionsWithAfter","combineActionsWithNothing","combineActionsWith","options","combineNested","streamMap","combineSimple"],"mappings":"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"}