{"version":3,"file":"index.js","sources":["src/cursor/cursor_naive.js","src/utils/createCursorAPI.js","src/utils/generateStoreId.js","src/utils/Enum.js","src/utils/streams/combineValuesIntoEnum.js","src/utils/streams/eventSource.js","src/utils/streams/filterUnchangedKeyArrays.js","src/backend/backend.js","src/backend/index.js","src/bindings/scheduler.js","src/utils/shallowEqual.js","src/bindings/react.js","src/utils/handleActions.js","src/utils/streams/combineEnums.js","src/utils/streams/combineEventsWith.js","src/utils/streams/combineNested.js","src/utils/streams/combine.js","src/index.js"],"sourcesContent":["const traverse = (tree, onVisit) => {\r\n  const q = [tree]\r\n\r\n  while (q.length) {\r\n    const node = q.shift()\r\n    q.push(...Object.values(node.children))\r\n    onVisit(node)\r\n  }\r\n}\r\n\r\nconst getChildren = node => {\r\n  const children = []\r\n  traverse(node, node => children.push(node))\r\n  return children\r\n}\r\n\r\nconst getParents = node => {\r\n  const parents = []\r\n  while (node.parent) {\r\n    node = node.parent\r\n    parents.push(node)\r\n  }\r\n  return parents\r\n}\r\n\r\nconst testFilter = (node, filter) => {\r\n  if (!filter || filter === node.id || node.identifiers.includes(filter)) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst runQuery = (tree, originIds, query) => {\r\n  if (!query.length) return originIds\r\n\r\n  let operator\r\n  ;[operator, ...query] = query\r\n\r\n  if (operator.op === 'root') return runQuery(tree, [tree.id], query)\r\n\r\n  const originNodes = []\r\n  traverse(tree, node => {\r\n    if (originIds.includes(node.id)) {\r\n      originNodes.push(node)\r\n    }\r\n  })\r\n\r\n  const result = (() => {\r\n    let result = originNodes.map(node => {\r\n      const getMatches = operator.op === 'children' ? getChildren : getParents\r\n      let matches = getMatches(node)\r\n      matches = matches.filter(node => testFilter(node, operator.filter))\r\n      matches = matches.slice(0, operator.maxStores)\r\n      matches = matches.map(node => node.id)\r\n      return matches\r\n    })\r\n    result = [].concat(...result)\r\n    result = Array.from(new Set(result))\r\n    return result\r\n  })()\r\n\r\n  return runQuery(tree, result, query)\r\n}\r\n\r\nconst createCursorBackend = () => {\r\n  let prevTree\r\n\r\n  return {\r\n    query(origin, query) {\r\n      if (!prevTree) return []\r\n      return runQuery(prevTree, [origin], query)\r\n    },\r\n    updateNode(tree, op) {\r\n      prevTree = tree\r\n      const results = {}\r\n      traverse(tree, node => {\r\n        results[node.id] = node.queries.map(query => {\r\n          return runQuery(tree, [node.id], query)\r\n        })\r\n      })\r\n      return results\r\n    }\r\n  }\r\n}\r\n\r\nexport default createCursorBackend\r\n","const createCursorAPI = (enhancer, query = []) => {\r\n  const cursorMethods = {\r\n    root() {\r\n      const newQuery = [{op: 'root'}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    parents(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'parents', filter, maxStores})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    children(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'children', filter, maxStores})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    all(filter = null, maxStores = Infinity) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = [{op: 'root'}, {op: 'children', filter, maxStores}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    one(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = [{op: 'root'}, {op: 'children', filter, maxStores: 1}]\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    parent(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'parents', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    },\r\n    child(filter = null) {\r\n      filter = filter && (filter.__COMPONENT_IDENTIFIER__ || filter)\r\n      const newQuery = query.concat({op: 'children', filter, maxStores: 1})\r\n      return createCursorAPI(enhancer, newQuery)\r\n    }\r\n  }\r\n  return enhancer(cursorMethods, query)\r\n}\r\n\r\nexport default createCursorAPI\r\n","/*\r\n  Store ids should:\r\n\r\n    * Be easy to read / recognise\r\n    * Not conflict with filters\r\n    * Communicate how many components have been mounted during session\r\n*/\r\nconst ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\r\n\r\nconst counter = [0, -1]\r\n\r\nconst generateStoreId = () => {\r\n  for (let i = counter.length - 1; i >= 0; i--) {\r\n    if (counter[i] === 25) {\r\n      counter[i] = 0\r\n      if (!i) counter.unshift(0)\r\n    } else {\r\n      counter[i] += 1\r\n      break\r\n    }\r\n  }\r\n  return '_' + counter.map(char => ALPHABET[char]).join('')\r\n}\r\n\r\nexport const couldBeStoreId = RegExp.prototype.test.bind(/^_[A-Z]{2,12}$/)\r\n\r\nexport default generateStoreId\r\n","class Enum extends Array {\r\n  constructor(obj = {}) {\r\n    const keys = Object.keys(obj)\r\n    const values = keys.map(key => obj[key])\r\n    super()\r\n    super.push(...values)\r\n    Object.defineProperty(this, 'keys', {value: keys})\r\n    Object.defineProperty(this, 'indexes', {\r\n      value: new Array(values.length).fill().map((v, i) => i)\r\n    })\r\n    keys.forEach(key => Object.defineProperty(this, key, {value: obj[key]}))\r\n  }\r\n  map(f) {\r\n    const obj = {}\r\n    this.forEach(function map(value, index, key, arr) {\r\n      obj[key] = f(value, index, key, arr)\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  filter(f) {\r\n    const obj = {}\r\n    this.forEach(function filter(value, index, key, arr) {\r\n      if (f(value, index, key, arr)) {\r\n        obj[key] = value\r\n      }\r\n    })\r\n    return new Enum(obj)\r\n  }\r\n  forEach(f) {\r\n    return super.forEach(function forEach(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  every(f) {\r\n    return super.every(function every(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  find(f) {\r\n    return super.find(function find(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  findIndex(f) {\r\n    return super.findIndex(function findIndex(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  some(f) {\r\n    return super.some(function some(value, index, arr) {\r\n      return f(value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduce(f) {\r\n    return super.reduce(function reduce(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n  reduceRight(f) {\r\n    return super.reduceRight(function reduceRight(prev, value, index, arr) {\r\n      return f(prev, value, index, this.keys[index], arr)\r\n    })\r\n  }\r\n}\r\n\r\nexport default Enum\r\n","import * as most from 'most'\r\nimport Enum from '../Enum'\r\n\r\nconst SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\n/*\r\n  Combines streams of normal values into a stream of Enums\r\n\r\n  Emits values immediately, w/o waiting for input streams to emit their first value\r\n*/\r\nconst combineValuesIntoEnum = (streams, ids) => {\r\n  if (!streams.length) return most.of(new Enum())\r\n  return most.combineArray(\r\n    (...values) => {\r\n      const result = {}\r\n      values.forEach((value, i) => {\r\n        if (value !== SKIP_TOKEN) result[ids[i]] = value\r\n      })\r\n      return new Enum(result)\r\n    },\r\n    streams.map($stream => {\r\n      const $start = most.of(SKIP_TOKEN).until($stream)\r\n      return $start.concat($stream)\r\n    })\r\n  )\r\n}\r\n\r\nexport default combineValuesIntoEnum\r\n","import * as most from 'most'\r\n\r\nconst eventSource = () => {\r\n  let buffer = []\r\n  let next\r\n  let push = event => {\r\n    if (next) {\r\n      next(event)\r\n      next = null\r\n    } else {\r\n      buffer.push(event)\r\n    }\r\n  }\r\n  const setResolve = (resolve, reject) => (next = resolve)\r\n  function* eventGenerator() {\r\n    while (true) {\r\n      if (buffer.length) yield Promise.resolve(buffer.shift())\r\n      else yield new Promise(setResolve)\r\n    }\r\n  }\r\n  return {\r\n    push,\r\n    $stream: most.generate(eventGenerator)\r\n  }\r\n}\r\n\r\nexport default eventSource\r\n","const SKIP_TOKEN = '__MIRROR_SKIP_TOKEN__'\r\n\r\nconst keyArrayEqual = ({oldKeyArray, oldKeySet}, keyArray) => {\r\n  if (oldKeyArray === keyArray) return true\r\n  if (oldKeyArray === undefined) return false\r\n\r\n  for (let i in keyArray) {\r\n    if (!oldKeySet.has(keyArray[i])) return false\r\n  }\r\n\r\n  return keyArray.length === oldKeyArray.length\r\n}\r\n\r\nconst filterUnchangedKeyArrays = $stream => {\r\n  return $stream\r\n    .loop((seed, keyArray) => {\r\n      let isEqual = keyArrayEqual(seed, keyArray)\r\n      if (isEqual) return {seed, value: SKIP_TOKEN}\r\n      return {\r\n        seed: {oldKeyArray: keyArray, oldKeySet: new Set(keyArray)},\r\n        value: keyArray\r\n      }\r\n    }, {})\r\n    .filter(value => value !== SKIP_TOKEN)\r\n}\r\n\r\nexport default filterUnchangedKeyArrays\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport warning from 'warning'\r\nimport createCursorBackend from '../cursor'\r\nimport createCursorAPI from '../utils/createCursorAPI'\r\nimport generateStoreId, {couldBeStoreId} from '../utils/generateStoreId'\r\nimport combineValuesIntoEnum from '../utils/streams/combineValuesIntoEnum'\r\nimport createEventSource from '../utils/streams/eventSource'\r\nimport filterUnchangedKeyArrays from '../utils/streams/filterUnchangedKeyArrays'\r\n\r\nconst createMirrorBackend = () => {\r\n  let root\r\n  const storeMap = {}\r\n  const cursorBackend = createCursorBackend()\r\n\r\n  const {push: onStoreUpdated, $stream: $storeUpdated} = createEventSource()\r\n\r\n  const $queryResults = $storeUpdated\r\n    .map(({store, op}) => {\r\n      return cursorBackend.updateNode(root, {path: store.path, op})\r\n    })\r\n    .multicast()\r\n\r\n  const updateStore = (\r\n    store,\r\n    {requesting = [], streams, identifiers = [], metadata = {}}\r\n  ) => {\r\n    Object.assign(store, {identifiers, metadata})\r\n\r\n    invariant(\r\n      !identifiers.some(couldBeStoreId),\r\n      'Cannot precede all-uppercase identifiers with \"_\" (\"%s\") because they could ' +\r\n        'conflict with internally-used IDs',\r\n      identifiers.find(couldBeStoreId)\r\n    )\r\n\r\n    const $storeDeleted = $queryResults.filter(() => !storeMap[store.id]).multicast()\r\n\r\n    let ADD_STREAMS_ASYNC\r\n\r\n    store.mirror = createCursorAPI((cursorMethods, query) => {\r\n      const cursor = {}\r\n      requesting.concat('$actions').forEach(streamName => {\r\n        Object.defineProperty(cursor, streamName, {\r\n          get() {\r\n            const queryIndex = store.queries.length\r\n            store.queries.push(query)\r\n            store.queryTypes.push(streamName)\r\n            store.queryResults.push([])\r\n            if (ADD_STREAMS_ASYNC) {\r\n              warning(\r\n                false,\r\n                'Accessing \"mirror.%s\" after a store has been added is ineffcient, you ' +\r\n                  'can batch queries with `updateStore` to improve performance',\r\n                streamName\r\n              )\r\n              onStoreUpdated({store, op: 'update'})\r\n            }\r\n\r\n            return $queryResults\r\n              .map(queryResults => {\r\n                return queryResults[store.id] ? queryResults[store.id][queryIndex] : []\r\n              })\r\n              .thru(filterUnchangedKeyArrays)\r\n              .map(stores => {\r\n                store.queryResults[queryIndex] = stores\r\n                return (streamName === '$actions'\r\n                  ? most.mergeArray\r\n                  : combineValuesIntoEnum)(\r\n                  stores\r\n                    .map(id => {\r\n                      if (id === store.id && query.length && streamName === '$state') {\r\n                        return undefined\r\n                      }\r\n                      let $stream = storeMap[id] && storeMap[id].streams[streamName]\r\n                      if ($stream && storeMap[id] && storeMap[id].tails[streamName]) {\r\n                        $stream = $stream.startWith(storeMap[id].tails[streamName])\r\n                      }\r\n                      return $stream\r\n                    })\r\n                    .filter(s => s),\r\n                  stores\r\n                )\r\n              })\r\n              .switchLatest()\r\n              .until($storeDeleted)\r\n          }\r\n        })\r\n      })\r\n      Object.defineProperty(cursor, '$stores', {\r\n        get() {\r\n          return $queryResults\r\n            .map(() => ({\r\n              cursor: cursorBackend.query(store.id, query),\r\n              store\r\n            }))\r\n            .until($storeDeleted)\r\n        }\r\n      })\r\n      Object.assign(cursor, cursorMethods)\r\n      return cursor\r\n    })\r\n\r\n    store.dispatch = createCursorAPI((cursorMethods, query) => {\r\n      const dispatch = (type, payload, retryIfSelectionEmpty = true) => {\r\n        invariant(\r\n          storeMap[store.id],\r\n          'Cannot dispatch actions (\"%s\") from a store (\"%s\") that does not exist',\r\n          type,\r\n          store.id\r\n        )\r\n        const stores = cursorBackend.query(store.id, query)\r\n        if (stores.length || !retryIfSelectionEmpty) {\r\n          stores.forEach(id => {\r\n            storeMap[id] && storeMap[id].streams.$actions.push({type, payload, store: id})\r\n          })\r\n          return\r\n        }\r\n\r\n        $queryResults\r\n          .until(\r\n            $storeDeleted.tap(() => {\r\n              warning(\r\n                false,\r\n                'No store matched an action (\"%s\"), & the dispatcher (\"%s\") was ' +\r\n                  \"removed. We've discarded the action. You could try dispatching the \" +\r\n                  'action via a proxy.',\r\n                type,\r\n                store.id\r\n              )\r\n            })\r\n          )\r\n          .map(() => cursorBackend.query(store.id, query))\r\n          .filter(stores => stores.length)\r\n          .take(1)\r\n          .observe(stores => {\r\n            stores.forEach(id => {\r\n              if (storeMap[id]) {\r\n                storeMap[id].streams.$actions.push({type, payload, store: id})\r\n              }\r\n            })\r\n          })\r\n      }\r\n      Object.assign(dispatch, cursorMethods)\r\n      return dispatch\r\n    })\r\n\r\n    if (!store.streams.$actions) {\r\n      const {push: dispatch, $stream: $actions} = createEventSource()\r\n      store.streams.$actions = $actions.until($storeDeleted).multicast()\r\n      store.streams.$actions.push = dispatch\r\n    }\r\n\r\n    if (streams) {\r\n      const _streams = streams(store.mirror, store.dispatch)\r\n      Object.keys(_streams).forEach(streamName => {\r\n        _streams[streamName] = _streams[streamName]\r\n          .tap(evt => (store.tails[streamName] = evt))\r\n          .multicast()\r\n      })\r\n      store.streams = Object.assign(_streams, {\r\n        $actions: store.streams.$actions\r\n      })\r\n    }\r\n\r\n    ADD_STREAMS_ASYNC = true\r\n  }\r\n\r\n  const backend = {\r\n    addStore(parentId, {requesting, streams, identifiers, metadata}) {\r\n      if (!parentId) parentId = root && root.id\r\n      const parent = storeMap[parentId]\r\n      invariant(\r\n        parent || !root,\r\n        'Cannot add store as a child of \"%s\", because \"%s\" does not exist',\r\n        parentId,\r\n        parentId\r\n      )\r\n\r\n      const store = {\r\n        /*\r\n          '_AAC'\r\n        */\r\n        id: generateStoreId(),\r\n        /*\r\n          ['_AA', '_BX']\r\n        */\r\n        path: root ? parent.path.concat(parentId) : [],\r\n        /* {$actions, $state, $props} */\r\n        streams: {},\r\n        /*\r\n          {\r\n            $actions: {type: 'INCREMENT', payload: 1},\r\n            $state: {value: 2},\r\n            $props: {}\r\n          }\r\n        */\r\n        tails: {},\r\n        queries: [],\r\n        queryTypes: [],\r\n        queryResults: [],\r\n        children: {},\r\n        parent\r\n      }\r\n\r\n      if (store.parent) store.parent.children[store.id] = store\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      storeMap[store.id] = store\r\n      onStoreUpdated({store, op: 'add'})\r\n      store.dispatch('INITIALIZE')\r\n\r\n      return store\r\n    },\r\n    removeStore(storeId) {\r\n      const store = storeMap[storeId]\r\n      if (!store) return\r\n      invariant(store !== root, 'Cannot remove root store')\r\n\r\n      const traverse = store => {\r\n        Object.values(store.children).forEach(traverse)\r\n        store.dispatch('TEARDOWN')\r\n        delete storeMap[store.id]\r\n        onStoreUpdated({store, op: 'remove'})\r\n      }\r\n      traverse(store)\r\n\r\n      if (store && store.parent) {\r\n        delete store.parent.children[storeId]\r\n      }\r\n    },\r\n    updateStore(storeId, {requesting, streams, identifiers, metadata}) {\r\n      const store = storeMap[storeId]\r\n      invariant(store, 'Cannot update a store (\"%s\") that does not exist', storeId)\r\n\r\n      updateStore(store, {requesting, streams, identifiers, metadata})\r\n      onStoreUpdated({store, op: 'update'})\r\n\r\n      return store\r\n    },\r\n    query: createCursorAPI((cursorMethods, query) => {\r\n      const runQuery = id => cursorBackend.query(id || root.id, query)\r\n      Object.assign(runQuery, cursorMethods)\r\n      return runQuery\r\n    }),\r\n    stores: storeMap\r\n  }\r\n\r\n  backend.root = root = backend.addStore(null, {\r\n    identifiers: ['MIRROR/root'],\r\n    metadata: {root: true}\r\n  })\r\n\r\n  return backend\r\n}\r\n\r\nexport default createMirrorBackend\r\n","import createMirrorBackend from './backend'\r\n\r\nconst MirrorBackend = createMirrorBackend()\r\n\r\nexport default MirrorBackend\r\n","import createEventSource from '../utils/streams/eventSource'\r\n\r\nconst createScheduler = () => {\r\n  const samplers = {}\r\n  let buffer = {}\r\n  let BUFFERING = false\r\n  return {\r\n    addStream(priority, id, $stream) {\r\n      samplers[id] = createEventSource()\r\n\r\n      return $stream\r\n        .tap(evt => {\r\n          buffer[id] = evt\r\n          if (!BUFFERING) {\r\n            BUFFERING = true\r\n            setTimeout(() => {\r\n              const _samplers = []\r\n              Object.keys(buffer).forEach(id => {\r\n                if (!_samplers[priority]) _samplers[priority] = []\r\n                if (samplers[id]) _samplers[priority].push(samplers[id])\r\n              })\r\n              _samplers.forEach(samplers => {\r\n                samplers.forEach(sampler => sampler.push(true))\r\n              })\r\n              BUFFERING = false\r\n              buffer = {}\r\n            })\r\n          }\r\n        })\r\n        .sampleWith(samplers[id].$stream)\r\n    },\r\n    removeStream(id) {\r\n      delete samplers[id]\r\n      delete buffer[id]\r\n    }\r\n  }\r\n}\r\n\r\nconst scheduler = createScheduler()\r\nexport default scheduler\r\n","const hasOwn = Object.prototype.hasOwnProperty\r\n\r\nconst shallowEqual = (a, b) => {\r\n  if (a === b) return true\r\n  if (typeof a !== 'object' || typeof b !== 'object' || !a !== !b) return false\r\n\r\n  let countA = 0\r\n  let countB = 0\r\n\r\n  for (let key in a) {\r\n    if (hasOwn.call(a, key) && a[key] !== b[key]) return false\r\n    countA++\r\n  }\r\n\r\n  for (let key in b) {\r\n    if (hasOwn.call(b, key)) countB++\r\n  }\r\n\r\n  return countA === countB\r\n}\r\n\r\nexport default shallowEqual\r\n","import * as most from 'most'\r\nimport React from 'react'\r\nimport warning from 'warning'\r\nimport invariant from 'invariant'\r\nimport scheduler from './scheduler'\r\nimport MirrorBackend from '../backend'\r\nimport shallowEqual from '../utils/shallowEqual'\r\nimport createEventSource from '../utils/streams/eventSource'\r\n\r\nconst instantiseMapToProps = mapToProps => {\r\n  let CALLED_ONCE\r\n  const instantisedMapToProps = (state, props) => {\r\n    let result = mapToProps(state, props)\r\n    if (!CALLED_ONCE && typeof result === 'function') {\r\n      mapToProps = result\r\n      result = mapToProps(state, props)\r\n    }\r\n    CALLED_ONCE = true\r\n    return result\r\n  }\r\n  return instantisedMapToProps\r\n}\r\n\r\nfunction createMirrorDecorator(config = {}) {\r\n  return function decorateWithMirror(WrappedComponent) {\r\n    let {name = [], state, mapToProps, pure = true} = config\r\n    if (!(name instanceof Array)) name = [name]\r\n    if (typeof mapToProps !== 'function') {\r\n      mapToProps = (state, {withName, ...props}) => ({...props, ...state})\r\n    }\r\n    if (!pure) pure = {propsEqual() {}, stateEqual() {}, propsStateEqual() {}}\r\n    if (pure === true) pure = {}\r\n    pure = Object.assign(\r\n      {\r\n        propsEqual: shallowEqual,\r\n        stateEqual: shallowEqual,\r\n        propsStateEqual: shallowEqual\r\n      },\r\n      pure\r\n    )\r\n\r\n    if (!WrappedComponent) {\r\n      WrappedComponent = function Noop() {\r\n        return null\r\n      }\r\n    }\r\n    const _name = WrappedComponent.displayName || WrappedComponent.name || 'Component'\r\n    const stateless = !WrappedComponent.prototype.render\r\n    invariant(\r\n      name.every(name => typeof name === 'string'),\r\n      '`name` should be a string or array of strings (at \"%s\")',\r\n      _name\r\n    )\r\n\r\n    const getPropNames = (name = []) => {\r\n      if (!(name instanceof Array)) name = [name]\r\n      return name.filter(name => typeof name === 'string').sort()\r\n    }\r\n\r\n    class Mirror extends React.Component {\r\n      constructor(props, context) {\r\n        super()\r\n        this.props = props\r\n        this.state = {updateCount: 0, props: undefined}\r\n\r\n        let {push: onReceivedProps, $stream: $props} = createEventSource()\r\n        Object.assign(this, {onReceivedProps})\r\n\r\n        const {id, path, mirror, dispatch, streams} = MirrorBackend.addStore(context.id, {\r\n          requesting: ['$state', '$props'],\r\n          identifiers: [\r\n            ...name,\r\n            ...getPropNames(this.props.withName),\r\n            Mirror.__COMPONENT_IDENTIFIER__\r\n          ],\r\n          streams: (mirror, dispatch) => {\r\n            $props = $props\r\n              .startWith(props)\r\n              .skipRepeatsWith(pure.propsEqual.bind(this))\r\n              .tap(props => (this._props = props))\r\n            let $state = typeof state === 'function' && state.call(this, mirror, dispatch)\r\n            warning(\r\n              !state || ($state && $state.subscribe),\r\n              '`state` should return a stream, did you forget a \"return\" statement? (at \"%s\")',\r\n              [_name].concat(name.filter(name => typeof name === 'string').join(', '))\r\n            )\r\n            if (!state || !$state || !$state.subscribe) return {$props}\r\n            $state = $state\r\n              .skipRepeatsWith(pure.stateEqual.bind(this))\r\n              .filter(state => state !== undefined)\r\n              .tap(state => (this._state = state))\r\n            return {$state, $props}\r\n          },\r\n          metadata: {\r\n            instance: this\r\n          }\r\n        })\r\n        Object.assign(this, {id, depth: path.length, mirror, dispatch})\r\n\r\n        const $propsState = streams.$state\r\n          ? most.combine(\r\n              instantiseMapToProps(mapToProps.bind(this)),\r\n              streams.$state,\r\n              streams.$props\r\n            )\r\n          : streams.$props.map(instantiseMapToProps(mapToProps.bind(this, undefined)))\r\n\r\n        $propsState\r\n          .skipRepeatsWith(pure.propsStateEqual.bind(this))\r\n          .thru(scheduler.addStream.bind(null, this.depth, id))\r\n          .observe(propsState => {\r\n            this._propsState = propsState\r\n            this.setState(({updateCount}) => ({updateCount: updateCount + 1, propsState}))\r\n          })\r\n          .then(scheduler.removeStream.bind(null, id))\r\n      }\r\n      getWrappedInstance() {\r\n        invariant(\r\n          !stateless,\r\n          \"Stateless components (eg, `() => {}`) don't have refs, and therefore can't be unwrapped.\"\r\n        )\r\n        return this.wrappedInstance\r\n      }\r\n      getChildContext() {\r\n        return {id: this.id}\r\n      }\r\n      componentWillReceiveProps(nextProps) {\r\n        const nextName = getPropNames(nextProps.withName)\r\n        const currentName = getPropNames(this.props.withName)\r\n        if (JSON.stringify(nextName) !== JSON.stringify(currentName)) {\r\n          MirrorBackend.updateStore(this.id, {\r\n            requesting: ['$state', '$props'],\r\n            identifiers: [...name, ...nextName, Mirror.__COMPONENT_IDENTIFIER__],\r\n            metadata: {instance: this}\r\n          })\r\n        }\r\n        this.onReceivedProps(nextProps)\r\n      }\r\n      shouldComponentUpdate(nextProps, nextState) {\r\n        return nextState.updateCount > this.state.updateCount\r\n      }\r\n      componentWillUnmount() {\r\n        MirrorBackend.removeStore(this.id)\r\n      }\r\n      render() {\r\n        if (this.state.updateCount === 0 && state) {\r\n          return null\r\n        }\r\n\r\n        const props = {\r\n          ...this.state.propsState,\r\n          dispatch: this.dispatch\r\n        }\r\n        if (!stateless) props.ref = ref => (this.wrappedInstance = ref)\r\n\r\n        return React.createElement(WrappedComponent, props)\r\n      }\r\n    }\r\n\r\n    Mirror.displayName = `Mirror(${_name})`\r\n    Mirror.contextTypes = {id() {}}\r\n    Mirror.childContextTypes = {id() {}}\r\n    Mirror.__COMPONENT_IDENTIFIER__ = Mirror\r\n\r\n    const createStaticCursors = () => {\r\n      delete Mirror.mirror\r\n      delete Mirror.dispatch\r\n      if (Mirror !== Mirror.__COMPONENT_IDENTIFIER__) {\r\n        Mirror.mirror = Mirror.__COMPONENT_IDENTIFIER__.mirror\r\n        Mirror.dispatch = Mirror.__COMPONENT_IDENTIFIER__.dispatch\r\n        return\r\n      }\r\n\r\n      const {mirror, dispatch} = MirrorBackend.addStore(null, {\r\n        identifiers: ['MIRROR/static', `MIRROR/static/${_name}`],\r\n        requesting: ['$props', '$state'],\r\n        metadata: {\r\n          static: Mirror\r\n        }\r\n      })\r\n\r\n      Object.assign(Mirror, {\r\n        mirror: mirror.all(Mirror),\r\n        dispatch: dispatch.all(Mirror)\r\n      })\r\n    }\r\n\r\n    Object.defineProperties(Mirror, {\r\n      mirror: {get: () => (createStaticCursors(), Mirror.mirror), configurable: true},\r\n      dispatch: {get: () => (createStaticCursors(), Mirror.dispatch), configurable: true}\r\n    })\r\n\r\n    Mirror.__WITH_NAME_CACHE__ = Mirror.__COMPONENT_IDENTIFIER__.__WITH_NAME_CACHE__ || {}\r\n\r\n    Mirror.withName = function withName(...withName) {\r\n      withName = name.concat(...withName)\r\n      const key = JSON.stringify(withName.sort())\r\n      const cachedComponent = Mirror.__WITH_NAME_CACHE__[key]\r\n      if (cachedComponent) return cachedComponent\r\n\r\n      const renamedComponent = createMirrorDecorator({\r\n        ...config,\r\n        name: withName\r\n      })(WrappedComponent)\r\n      renamedComponent.__COMPONENT_IDENTIFIER__ = Mirror.__COMPONENT_IDENTIFIER__\r\n      if (withName.length) Mirror.__WITH_NAME_CACHE__[key] = renamedComponent\r\n      return renamedComponent\r\n    }\r\n\r\n    return Mirror\r\n  }\r\n}\r\n\r\nexport default createMirrorDecorator\r\n","const isAction = action => {\r\n  if (\r\n    action &&\r\n    typeof action.type === 'string' &&\r\n    action.hasOwnProperty('payload') &&\r\n    typeof action.store === 'string'\r\n  ) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst findAction = args => {\r\n  let i = args.length\r\n  while (i--) {\r\n    if (isAction(args[i])) return args[i]\r\n    if (args[i] && isAction(args[i].action)) return args[i].action\r\n  }\r\n  return null\r\n}\r\n\r\nconst handleActions = (handlers, initialState) => (...args) => {\r\n  let action = findAction(args)\r\n  const state = args[0] === undefined ? initialState : args[0]\r\n\r\n  if (!action || !handlers[action.type]) return state\r\n  if (initialState !== undefined) return handlers[action.type](state, action)\r\n  return handlers[action.type](action)\r\n}\r\n\r\nexport default handleActions\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport Enum from '../Enum'\r\n\r\nconst combineEnums = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  invariant(\r\n    streams.every($stream => $stream && $stream.subscribe),\r\n    '`combineEnums` only accepts streams'\r\n  )\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        result[key] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combineEnums\r\n","import invariant from 'invariant'\r\n\r\nconst combineEventsWithDefault = (eventStream, otherStream) => {\r\n  otherStream = otherStream.scan(([, before], after) => [before, after], []).multicast()\r\n  return otherStream\r\n    .sample(\r\n      (event, [before, after]) => ({before, event, after}),\r\n      eventStream,\r\n      otherStream\r\n    )\r\n    .skipRepeatsWith((a, b) => a.event === b.event)\r\n}\r\n\r\nconst combineEventsWithBefore = (eventStream, otherStream) => {\r\n  return eventStream.sample(\r\n    (event, other) => ({before: other, event}),\r\n    eventStream,\r\n    otherStream\r\n  )\r\n}\r\n\r\nconst combineEventsWithAfter = (eventStream, otherStream) => {\r\n  return combineEventsWithDefault(eventStream, otherStream).map(value => {\r\n    delete value.before\r\n    return value\r\n  })\r\n}\r\n\r\nconst combineEventsWithNothing = eventStream => {\r\n  return eventStream.map(event => ({event}))\r\n}\r\n\r\nconst combineEventsWith = (\r\n  eventStream,\r\n  otherStream,\r\n  options = {before: true, after: true}\r\n) => {\r\n  invariant(\r\n    eventStream && otherStream && eventStream.subscribe && otherStream.subscribe,\r\n    '`combineEventsWith` only accepts streams'\r\n  )\r\n  if (options.before && options.after) {\r\n    return combineEventsWithDefault(eventStream, otherStream)\r\n  } else if (options.before) {\r\n    return combineEventsWithBefore(eventStream, otherStream)\r\n  } else if (options.after) {\r\n    return combineEventsWithAfter(eventStream, otherStream)\r\n  }\r\n\r\n  return combineEventsWithNothing(eventStream)\r\n}\r\n\r\nexport default combineEventsWith\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\nimport Enum from '../Enum'\r\n\r\nconst combineNested = streamMap => {\r\n  const keys = Object.keys(streamMap)\r\n  const streams = keys.map(key => streamMap[key])\r\n  invariant(\r\n    streams.every($stream => $stream && $stream.subscribe),\r\n    '`combineNested` only accepts streams'\r\n  )\r\n  return most.combineArray((...enumCollection) => {\r\n    const result = {}\r\n    enumCollection.forEach(_enum_ => {\r\n      _enum_.forEach((value, i, key) => {\r\n        if (!result[key]) result[key] = {}\r\n        result[key][keys[i]] = value\r\n      })\r\n    })\r\n    return new Enum(result)\r\n  }, streams)\r\n}\r\n\r\nexport default combineNested\r\n","import * as most from 'most'\r\nimport invariant from 'invariant'\r\n\r\nconst combine = (...streams) => {\r\n  if (streams[0] instanceof Array) streams = streams[0]\r\n  invariant(\r\n    streams.every($stream => $stream && $stream.subscribe),\r\n    '`combine` only accepts streams'\r\n  )\r\n  return most.combineArray((...values) => [...values], streams)\r\n}\r\n\r\nexport default combine\r\n","import 'regenerator-runtime/runtime'\r\nimport MirrorBackend from './backend'\r\nimport Mirror from './bindings'\r\nimport Enum from './utils/Enum'\r\nimport handleActions from './utils/handleActions'\r\nimport shallowEqual from './utils/shallowEqual'\r\nimport combineEnums from './utils/streams/combineEnums'\r\nimport combineEventsWith from './utils/streams/combineEventsWith'\r\nimport combineNested from './utils/streams/combineNested'\r\nimport combine from './utils/streams/combine'\r\n\r\nconst {addStore, removeStore, updateStore, query, root, stores} = MirrorBackend\r\n\r\nexport {addStore, removeStore, updateStore, query, root, stores}\r\nexport {handleActions, Enum, shallowEqual}\r\nexport {combineEnums, combineEventsWith, combineNested, combine}\r\nexport default Mirror\r\n"],"names":["traverse","tree","onVisit","q","length","node","shift","push","Object","values","children","getChildren","getParents","parents","parent","testFilter","filter","id","identifiers","includes","runQuery","originIds","query","operator","op","originNodes","result","map","getMatches","matches","slice","maxStores","concat","Array","from","Set","createCursorBackend","prevTree","origin","results","queries","createCursorAPI","enhancer","cursorMethods","newQuery","Infinity","__COMPONENT_IDENTIFIER__","ALPHABET","counter","generateStoreId","i","unshift","char","join","couldBeStoreId","RegExp","prototype","test","bind","Enum","obj","keys","key","defineProperty","value","fill","v","forEach","f","index","arr","every","find","findIndex","some","reduce","prev","reduceRight","SKIP_TOKEN","combineValuesIntoEnum","streams","ids","most","$start","until","$stream","eventSource","eventGenerator","buffer","next","event","setResolve","resolve","reject","Promise","keyArrayEqual","keyArray","oldKeyArray","oldKeySet","undefined","has","filterUnchangedKeyArrays","loop","seed","isEqual","createMirrorBackend","root","storeMap","cursorBackend","createEventSource","onStoreUpdated","$storeUpdated","$queryResults","store","updateNode","path","multicast","updateStore","requesting","metadata","assign","$storeDeleted","ADD_STREAMS_ASYNC","mirror","cursor","streamName","queryIndex","queryTypes","queryResults","thru","stores","tails","startWith","s","switchLatest","dispatch","type","payload","retryIfSelectionEmpty","$actions","tap","take","observe","_streams","evt","backend","parentId","storeId","addStore","MirrorBackend","createScheduler","samplers","BUFFERING","priority","_samplers","sampler","sampleWith","scheduler","hasOwn","hasOwnProperty","shallowEqual","a","b","countA","countB","call","instantiseMapToProps","CALLED_ONCE","instantisedMapToProps","state","props","mapToProps","createMirrorDecorator","config","decorateWithMirror","WrappedComponent","name","pure","withName","Noop","_name","displayName","stateless","render","getPropNames","sort","Mirror","context","updateCount","onReceivedProps","$props","skipRepeatsWith","propsEqual","_props","$state","subscribe","stateEqual","_state","depth","$propsState","propsStateEqual","addStream","_propsState","propsState","setState","then","removeStream","wrappedInstance","nextProps","nextName","currentName","JSON","stringify","instance","nextState","removeStore","ref","React","createElement","Component","contextTypes","childContextTypes","createStaticCursors","all","defineProperties","get","configurable","__WITH_NAME_CACHE__","cachedComponent","renamedComponent","isAction","action","findAction","args","handleActions","handlers","initialState","combineEnums","enumCollection","combineEventsWithDefault","eventStream","otherStream","scan","after","before","sample","combineEventsWithBefore","other","combineEventsWithAfter","combineEventsWithNothing","combineEventsWith","options","combineNested","streamMap","combine"],"mappings":"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"}